<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"minminmsn.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="MinMinMsn">
<meta property="og:url" content="https://minminmsn.github.io/page/4/index.html">
<meta property="og:site_name" content="MinMinMsn">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Jerry Min">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://minminmsn.github.io/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>MinMinMsn</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">MinMinMsn</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2021/03/23/2021/03/2021-03-23-%E7%AD%89%E4%BF%9D%E4%BA%8C%E7%BA%A7%E4%B8%8E%E4%B8%89%E7%BA%A7%E5%8C%BA%E5%88%AB/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/23/2021/03/2021-03-23-%E7%AD%89%E4%BF%9D%E4%BA%8C%E7%BA%A7%E4%B8%8E%E4%B8%89%E7%BA%A7%E5%8C%BA%E5%88%AB/index/" class="post-title-link" itemprop="url">等保2.0标准介绍</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-03-23 08:00:00" itemprop="dateCreated datePublished" datetime="2021-03-23T08:00:00+08:00">2021-03-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:35" itemprop="dateModified" datetime="2023-05-26T15:06:35+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/security/" itemprop="url" rel="index"><span itemprop="name">security</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="等保2-0概述"><a href="#等保2-0概述" class="headerlink" title="等保2.0概述"></a><strong>等保2.0概述</strong></h2><p>2019年5月13日，国家市场监督管理总局、国家标准化管理委员会召开新闻发布会，等保2.0相关的《信息安全技术网络安全等级保护基本要求》、《信息安全技术网络安全等级保护测评要求》、《信息安全技术网络安全等级保护安全设计技术要求》等国家标准正式发布，将于2019年12月1日开始实施。</p>
<h2 id="等保安全级别"><a href="#等保安全级别" class="headerlink" title="等保安全级别"></a><strong>等保安全级别</strong></h2><p>信息安全等级保护广义上为涉及到该工作的标准、产品、系统、信息等均依据等级保护思想的安全工作；狭义上一般指信息系统安全等级保护。 信息系统安全等级保护分为五级，一级防护水平最低，最高等保为五级。</p>
<p><strong>第一级（自主保护级）</strong>：一般适用于小型私营、个体企业、中小学，乡镇所属信息系统、县级单位中一般的信息统 信息系统受到破坏后，会对公民、法人和其他组织的合法权益造成损害，但不损害国家安全、社会秩序和公共利益。</p>
<p><strong>第二级（指导保护级）</strong>：一般适用于县级其些单位中的重要信息系统；地市级以上国家机关、企事业单位内部一般的信息系统。例如非涉及工作秘密、商业秘密、敏感信息的办公系统和管理系统等。 信息系统受到破坏后，会对公民、法人和其他组织的合法权益产生严重损害，或者对社会秩序和公共利益造成损害，但不损害国家安全。</p>
<p><strong>第三级（监督保护级）</strong>：一般适用于地市级以上国家机关、企业、事业单位内部重要的信息系统，例如涉及工作秘密、商业秘密、敏感信息的办公系统和管理系统。 跨省或全国联网运行的用于生产、调度、管理、指挥、作业、控制等方面的重要信息系统以及这类系统在省、地市的分支系统；中央各部委、省（区、市）门户网站和重要网站；跨省连接的网络系统等。 信息系统受到破坏后，会对社会秩序和公共利益造成严重损害，或者对国家安全造成损害。</p>
<p><strong>第四级（强制保护级）</strong>：一般适用于国家重要领域、重要部门中的特别重要系统以及核心系统。例如电力、电信、广电、铁路、民航、银行、税务等重要、部门的生产、调度、指挥等涉及国家安全、国计民生的核心系统。 信息系统受到破坏后，会对社会秩序和公共利益造成特别严重损害，或者对国家安全造成严重损害。</p>
<p><strong>第五级（专控保护级）</strong>：一般适用于国家重要领域、重要部门中的极端重要系统。 信息系统受到破坏后，会对国家安全造成特别严重损害。</p>
<h2 id="关于三级等保的技术要求"><a href="#关于三级等保的技术要求" class="headerlink" title="关于三级等保的技术要求"></a><strong>关于三级等保的技术要求</strong></h2><p>GBT22239-2019等保2.0基本要求分技术要求与管理要求。其中技术要求分为：物理和环境安全，网络通信安全，设备和计算安全，应用和数据安全；管理要求分安全管理机构，安全管理制度，人员安全管理，系统建设管理，系统运维管理。</p>
<p>第三级安全保护能力：应能够在统一安全策略下防护免受来自外部有组织的团体、拥有较为丰富资源的威胁源发起的恶意攻击、较为严重的自然灾害，以及其他相当危害程度的威胁所造成的主要资源损害，能够及时发现、监测攻击行为和处置安全事件，在自身遭到损害后，能够较快恢复绝大部分功能。</p>
<p>以下加粗字段为等保三级与二级的区别，需重点关注。</p>
<h3 id="1安全通用要求"><a href="#1安全通用要求" class="headerlink" title="1安全通用要求"></a><strong>1安全通用要求</strong></h3><h4 id="1-1安全物理环境"><a href="#1-1安全物理环境" class="headerlink" title="1.1安全物理环境"></a><strong>1.1安全物理环境</strong></h4><p><strong>1.1.1物理位置选择</strong> 本项要求包括: a）机房场地应选择在具有防震、防风和防雨等能力的建筑内； b）机房场地应避免设在建筑物的顶层或地下室，否则应加强防水和防潮措施。</p>
<p><strong>1.1.2物理访问控制</strong> 机房出入口应<strong>配置电子门禁系统</strong>，控制、鉴别和记录进入的人员。</p>
<p><strong>1.1.3防盗窃和防破坏</strong> 本项要求包括： a）应将设备或主要部件进行固定，并设置明显的不易去除的标识； b）应将通信线缆铺设在隐蔽安全处； <strong>c）应设置机房防盗报警系统或设置有专人值守的视频监控系统。</strong></p>
<p><strong>1.1.4防雷击</strong> 本项要求包括： a）应将各类机柜、设施和设备等通过接地系统安全接地； <strong>b）应采取措施防止感应雷，例如设置防雷保安器或过压保护装置等。</strong></p>
<p><strong>1.1.5 防火</strong> 本项要求包括： a）机房应设置火灾自动消防系统，能够自动检测火情、自动报警，并自动灭火； b）机房及相关的工作房间和辅助房应采用具有耐火等级的建筑材料； <strong>c）应对机房划分区域进行管理，区域和区域之间设置隔离防火措施。</strong></p>
<p><strong>1.1.6防水和防潮</strong> 本项要求包括： a）应采取措施防止雨水通过机房窗户、屋顶和墙壁渗透； b）应采取措施防止机房内水蒸气结露和地下积水的转移与渗透； <strong>c）应安装对水敏感的检测仪表或元件，对机房进行防水检测和报警。</strong></p>
<p><strong>1.1.7防静电</strong> 本项要求包括： a）应采用防静电地板或地面并采用必要的接地防静电措施； <strong>b）应采取措施防止静电的产生，例如釆用静电消除器、佩戴防静电手环等。</strong></p>
<p><strong>1.1.8温湿度控制</strong> 应设置温湿度自动调节设施，使机房温湿度的变化在设备运行所允许的范围之内。</p>
<p><strong>1.1.9电力供应</strong> 本项要求包括： a）应在机房供电线路上配置稳压器和过电压防护设备； b）应提供短期的备用电力供应，至少满足设备在断电情况下的正常运行要求； <strong>c）应设置冗余或并行的电力电缆线路为计算机系统供电。</strong></p>
<p><strong>1.1.10电磁防护</strong> 本项要求包括： a）电源线和通信线缆应隔离铺设，避免互相干扰； <strong>b）应对关键设备实施电磁屏蔽。</strong></p>
<h4 id="1-2安全通信网络"><a href="#1-2安全通信网络" class="headerlink" title="1.2安全通信网络"></a><strong>1.2安全通信网络</strong></h4><p><strong>1.2.1网络架构</strong> 本项要求包括: <strong>a）应保证网络设备的业务处理能力满足业务高峰期需要；</strong> <strong>b）应保证网络各个部分的带宽满足业务高峰期需要；</strong> c）应划分不同的网络区域，并按照方便管理和控制的原则为各网络区域分配地址； d）应避免将重要网络区域部署在边界处，重要网络区域与其他网络区域之间应釆取可靠的技术隔离手段； <strong>e）应提供通信线路、关键网络设备和关键计算设备的硬件冗余，保证系统的可用性。</strong></p>
<p><strong>1.2.2通信传输</strong> 本项要求包括： a）应采用校验技术或密码技术保证通信过程中数据的完整性； <strong>b）应釆用密码技术保证通信过程中数据的保密性。</strong></p>
<p>1.2.3可信验证 可基于可信根对通信设备的系统引导程序、系统程序、重要配置参数和通信应用程序等进行可信验证，<strong>并在应用程序的关键执行环节进行动态可信验证</strong>，在检测到其可信性受到破坏后进行报警，并将验证结果形成审计记录送至安全管理中心。</p>
<h4 id="1-3安全区域边界"><a href="#1-3安全区域边界" class="headerlink" title="1.3安全区域边界"></a><strong>1.3安全区域边界</strong></h4><p><strong>1.3.1边界防护</strong> 本项要求包括： a）应保证跨越边界的访问和数据流通过边界设备提供的受控接口进行通信； <strong>b）应能够对非授权设备私自联到内部网络的行为进行检査或限制；</strong> <strong>c）应能够对内部用户非授权联到外部网络的行为进行检查或限制；</strong> <strong>d）应限制无线网络的使用，保证无线网络通过受控的边界设备接入内部网络。</strong></p>
<p><strong>1.3.2访问控制</strong> 本项要求包括： a）应在网络边界或区域之间根据访问控制策略设置访问控制规则，默认情况下除允许通信外受 控接口拒绝所有通信； b）应删除多余或无效的访问控制规则，优化访问控制列表，并保证访问控制规则数量最小化； c）应对源地址、目的地址、源端口、目的端口和协议等进行检査，以允许&#x2F;拒绝数据包进出； d）应能根据会话状态信息为进出数据流提供明确的允许&#x2F;拒绝访问的能力； <strong>e）应对进出网络的数据流实现基于应用协议和应用内容的访问控制。</strong></p>
<p><strong>1.3.3入侵防范</strong> 本项要求包括： <strong>a）应在关键网络节点处检测、防止或限制从外部发起的网络攻击行为； b）应在关键网络节点处检测、防止或限制从内部发起的网络攻击行为； c）应采取技术措施对网络行为进行分析，实现对网络攻击特别是新型网络攻击行为的分析； d）当检测到攻击行为时，记录攻击源IP、攻击类型、攻击目标、攻击事件，在发生严重入侵事件时应提供报警。</strong></p>
<p><strong>1.3.4恶意代码和垃圾邮件防范</strong> 本项要求包括： a）应在关键网络节点处对恶意代码进行检测和清楚，并维护恶意代码防护机制的升级和更新； <strong>b）应在关键网络节点处对垃圾邮件进行检测和防护，并维护垃圾邮件防护机制的升级和更新。</strong></p>
<p><strong>1.3.5安全审计</strong> 本项要求包括： a）应在网络边界、重要网络节点进行安全审计，审计覆盖到每个用户，对重要的用户行为和重要的安全事件进行审计； b）审计记录应包括事件的日期和时间、用户、事件类型、事件是否成功以及其他与审计相关的信息； c）应对审计记录进行保护，定期备份，避免受到未预期的删除、修改或覆盖等； <strong>d）应能对远程访问的用户行为、访问互联网的用户行为等单独进行行为审计和数据分析。</strong></p>
<p><strong>1.3.6 可信验证</strong> 可基于可信根对边界设备的系统引导程序、系统程序、重要配置参数和边界防护应用程序等进行可信验证，<strong>并在应用程序的关键执行环节进行动态可信验证，</strong> 在检测到其可信性受到破坏后进行报警，并将验证结果形成审计记录送至安全管理中心。</p>
<h4 id="1-4安全计算环境"><a href="#1-4安全计算环境" class="headerlink" title="1.4安全计算环境"></a>1.4安全计算环境</h4><p><strong>1.4.1身份鉴别</strong> 本项要求包括： a）应对登录的用户进行身份标识和鉴别，身份标识具有唯一性，身份鉴别信息具有复杂度要求并定期更换； b）应具有登录失败处理功能，应配置并启用结束会话、限制非法登录次数和当登录连接超时自动退出等相关措施； c）当进行远程管理时，应采取必要措施防止鉴别信息在网络传输过程中被窃听； <strong>d）应釆用口令、密码技术、生物技术等两种或两种以上组合的鉴别技术对用户进行身份鉴别，且其中一种鉴别技术至少应使用密码技术来实现。</strong></p>
<p><strong>1.4.2访问控制</strong> 本项要求包括： a）应对登录的用户分配账户和权限； b）应重命名或删除默认账户，修改默认账户的默认口令； c）应及时删除或停用多余的、过期的账户，避免共享账户的存在； d）应授予管理用户所需的最小权限,实现管理用户的权限分离； <strong>e）应由授权主体配置访问控制策略，访问控制策略规定主体对客体的访问规则； f）访问控制的粒度应达到主体为用户级或进程级，客体为文件、数据库表级； g）应对重要主体和客体设置安全标记，并控制主体对有安全标记信息资源的访问。</strong></p>
<p><strong>1.4.3 安全审计</strong> 本项要求包括: a）应启用安全审计功能，审计覆盖到每个用户，对重要的用户行为和重要安全事件进行审计； b）审计记录应包括事件的日期和时间、用户、事件类型、事件是否成功及其他与审计相关的信息； c）应对审计记录进行保护，定期备份，避免受到未预期的删除、修改或覆盖等； <strong>d）应对审计进程进行保护，防止未经授权的中断。</strong></p>
<p><strong>1.4.4入侵防范</strong> 本项要求包括： a）应遵循最小安装的原则，仅安装需要的组件和应用程序； b）应关闭不需要的系统服务、默认共享和高危端口； c）应通过设定终端接入方式或网络地址范围对通过网络进行管理的管理终端进行限制； d）应提供数据有效性检验功能，保证通过人机接口输入或通过通信接口输入的内容符合系统设 定要求； e）应能发现可能存在的已知漏洞，并在经过充分测试评估后，及时修补漏洞； <strong>f）应能够检测到对重要节点进行入侵的行为，并在发生严重入侵事件时提供报警。</strong></p>
<p><strong>1.4.5恶意代码防范</strong> <strong>应采用免受恶意代码攻击的技术措施或主动免疫可信验证机制及时识别入侵和病毒行为，并将其有效阻断。</strong></p>
<p><strong>1.4.6可信验证</strong> 可基于可信根对计算设备的系统引导程序、系统程序、重要配置参数和应用程序等进行可信验证, <strong>并在应用程序的关键执行环节进行动态可信验证，</strong> 在检测到其可信性受到破坏后进行报警，并将验证结果形成审计记录送至安全管理中心。</p>
<p><strong>1.4.7数据完整性</strong> 本项要求包括： a）应采用校验技术或密码技术保证重要数据在传输过程中的完整性，<strong>包括但不限于鉴别数据、重要业务数据、重要审计数据、重要配置数据、重要视频数据和重要个人信息等；</strong> <strong>b）应采用校验技术或密码技术保证重要数据在存储过程中的完整性，包括但不限于鉴别数据、重要业务数据、重要审计数据、重要配置数据、重要视频数据和重要个人信息等。</strong></p>
<p><strong>1.4.8数据保密性</strong> 本项要求包括： <strong>a）应釆用密码技术保证重要数据在传输过程中的保密性，包括但不限于鉴别数据、重要业务数据和重要个人信息等； b）应采用密码技术保证重要数据在存储过程中的保密性，包括但不限于鉴别数据、重要业务数据和重要个人信息等。</strong></p>
<p><strong>1.4.9数据备份恢复</strong> 本项要求包括： a）应提供重要数据的本地数据备份与恢复功能； b）应提供异地<strong>实时备份功能</strong>,利用通信网络将重要数据<strong>实时备份至备份场地</strong>； <strong>c）应提供重要数据处理系统的热冗余，保证系统的高可用性。</strong></p>
<p><strong>1.4.10剩余信息保护</strong> 本项要求包括： a）应保证鉴别信息所在的存储空间被释放或重新分配前得到完全清除； <strong>b）应保证存有敏感数据的存储空间被释放或重新分配前得到完全清除。</strong></p>
<p><strong>1.4.11个人信息保护</strong> 本项要求包括： a）应仅采集和保存业务必需的用户个人信息； b）应禁止未授权访问和非法使用用户个人信息。</p>
<h4 id="1-5安全管理中心"><a href="#1-5安全管理中心" class="headerlink" title="1.5安全管理中心"></a><strong>1.5安全管理中心</strong></h4><p><strong>1.5.1系统管理</strong> 本项要求包括： a）应对系统管理员进行身份鉴别，只允许其通过特定的命令或操作界面进行系统管理操作，并对这些操作进行审计； b）应通过系统管理员对系统的资源和运行进行配置、控制和管理，包括用户身份、系统资源配置、 系统加载和启动、系统运行的异常处理、数据和设备的备份与恢复等。</p>
<p><strong>1.5.2审计管理</strong> 本项要求包括： a）应对审计管理员进行身份鉴别，只允许其通过特定的命令或操作界面进行安全审计操作，并对这些操作进行审计； b）应通过审计管理员对审计记录应进行分析，并根据分析结果进行处理，包括根据安全审计策略对审计记录进行存储、管理和査询等。</p>
<p><strong>1.5.3安全管理</strong> 本项要求包括： <strong>a）应对安全管理员进行身份鉴别，只允许其通过特定的命令或操作界面进行安全管理操作，并对这些操作进行审计； b）应通过安全管理员对系统中的安全策略进行配置，包括安全参数的设置，主体、客体进行统一 安全标记，对主体进行授权，配置可信验证策略等。</strong></p>
<p><strong>1.5.4集中管控</strong> 本项要求包括： <strong>a）应划分出特定的管理区域，对分布在网络中的安全设备或安全组件进行管控； b）应能够建立一条安全的信息传输路径，对网络中的安全设备或安全组件进行管理； c）应对网络链路、安全设备、网络设备和服务器等的运行状况进行集中监测； d）应对分散在各个设备上的审计数据进行收集汇总和集中分析，并保证审计记录的留存时间符 合法律法规要求； e）应对安全策略、恶意代码、补丁升级等安全相关事项进行集中管理； f）应能对网络中发生的各类安全事件进行识别、报警和分析。</strong></p>
<h4 id="1-6安全管理制度"><a href="#1-6安全管理制度" class="headerlink" title="1.6安全管理制度"></a><strong>1.6安全管理制度</strong></h4><p><strong>1.6.1安全策略</strong> 应制定网络安全工作的总体方针和安全策略，阐明机构安全工作的总体目标、范围、原则和安全框架等。</p>
<p><strong>1.6.2管理制度</strong> 本项要求包括： a）应对安全管理活动中的各类管理内容建立安全管理制度； b）应对管理人员或操作人员执行的日常管理操作建立操作规程； <strong>c）应形成由安全策略、管理制度、操作规程、记录表単等构成的全面的安全管理制度体系。</strong></p>
<p><strong>1.6.3制定和发布</strong> 本项要求包括： a）应指定或授权专门的部门或人员负责安全管理制度的制定； b）安全管理制度应通过正式、有效的方式发布，并进行版本控制。</p>
<p><strong>1.6.4评审和修订</strong> 应定期对安全管理制度的合理性和适用性进行论证和审定，对存在不足或需要改进的安全管理制度进行修订。</p>
<h4 id="1-7安全管理机构"><a href="#1-7安全管理机构" class="headerlink" title="1.7安全管理机构"></a><strong>1.7安全管理机构</strong></h4><p><strong>1.7.1岗位设置</strong> 本项要求包括： <strong>a）应成立指导和管理网络安全工作的委员会或领导小组，其最高领导由单位主管领导担任或授权；</strong> b）应设立网络安全管理工作的职能部门，设立安全主管、安全管理各个方面的负责人岗位，并定义各负责人的职责； c）应设立系统管理员、审计管理员和安全管理员等岗位，并定义部门及各个工作岗位的职责。</p>
<p><strong>1.7.2人员配备</strong> 本项要求包括： a）应配备一定数量的系统管理员、审计管理员和安全管理员等； <strong>b）应配备专职安全管理员，不可兼任。</strong></p>
<p><strong>1.7.3授权和审批</strong> 本项要求包括： a）应根据各个部门和岗位的职责明确授权审批事项、审批部门和批准人等； b）应针对系统变更、重要操作、物理访问和系统接入等事项建立审批程序，按照审批程序执行审批过程，<strong>对重要活动建立逐级审批制度；</strong> <strong>c）应定期审查审批事项，及时更新需授权和审批的项目、审批部门和审批人等信息。</strong></p>
<p><strong>1.7.4沟通和合作</strong> 本项要求包括： a）应加强各类管理人员、组织内部机构和网络安全管理部门之间的合作与沟通，定期召开协调会议，共同协作处理网络安全问题； b）应加强与网络安全职能部门、各类供应商、业界专家及安全组织的合作与沟通； c）应建立外联单位联系列表，包括外联单位名称、合作内容、联系人和联系方式等信息。</p>
<p><strong>1.7.5审核和检查</strong> 本项要求包括： a）应定期进行常规安全检查,检查内容包括系统日常运行、系统漏洞和数据备份等情况； b）应定期进行全面安全检査，检査内容包括现有安全技术措施的有效性、安全配置与安全策略的一致性、安全管理制度的执行情况等； c）应制定安全检査表格实施安全检查，汇总安全检查数据，形成安全检查报告，并对安全检查结果进行通报。</p>
<p><strong>1.8安全管理人员</strong> <strong>1.8.1人员录用</strong> 本项要求包括： a）应指定或授权专门的部门或人员负责人员录用； b）应对被录用人员的身份、安全背景、专业资格或资质等进行审查，<strong>对其所具有的技术技能进行考核；</strong> <strong>c）应与被录用人员签署保密协议，与关键岗位人员签署岗位责任协议。</strong></p>
<p><strong>1.8.2人员离岗</strong> 本项要求包括： a）应及时终止离岗人员的所有访问权限，取回各种身份证件、钥匙、徽章等以及机构提供的软硬件设备； <strong>b）应办理严格的调离手续，并承诺调离后的保密义务后方可离开。</strong></p>
<p><strong>1.8.3安全意识教育和培训</strong> 本项要求包括： a）应对各类人员进行安全意识教育和岗位技能培训，并告知相关的安全责任和惩戒措施； <strong>b）应针对不同岗位制定不同的培训计划，对安全基础知识、岗位操作规程等进行培训； c）应定期对不同岗位的人员进行技能考核。</strong></p>
<p><strong>1.8.4外部人员访问管理</strong> 本项要求包括： a）应在外部人员物理访问受控区域前先提出书面申请，批准后由专人全程陪同，并登记备案； b）应在外部人员接入受控网络访问系统前先提出书面申请，批准后由专人开设账户、分配权限，并登记备案； c）外部人员离场后应及时清除其所有的访问权限； <strong>d）获得系统访问授权的外部人员应签署保密协议,不得进行非授权操作，不得复制和泄露任何敏感信息。</strong></p>
<h4 id="1-9安全建设管理"><a href="#1-9安全建设管理" class="headerlink" title="1.9安全建设管理"></a><strong>1.9安全建设管理</strong></h4><p><strong>1.9.1定级和备案</strong> 本项要求包括： a）应以书面的形式说明保护对象的安全保护等级及确定等级的方法和理由； b）应组织相关部门和有关安全技术专家对定级结果的合理性和正确性进行论证和审定； c）应保证定级结果经过相关部门的批准； d）应将备案材料报主管部门和相应公安机关备案。</p>
<p><strong>1.9.2安全方案设计</strong> 本项要求包括： a）应根据安全保护等级选择基本安全措施，依据风险分析的结果补充和调整安全措施； <strong>b）应根据保护对象的安全保护等级及与其他级别保护对象的关系进行安全整体规划和安全方案设计，设计内容应包含密码技术相关内容，并形成配套文件； c）应组织相关部门和有关安全专家对安全整体规划及其配套文件的合理性和正确性进行论证和审定，经过批准后才能正式实施。</strong></p>
<p><strong>1.9.3产品釆购和使用</strong> 本项要求包括： a）应确保网络安全产品釆购和使用符合国家的有关规定； b）应确保密码产品与服务的采购和使用符合国家密码管理主管部门的要求； <strong>c）应预先对产品进行选型测试，确定产品的候选范围，并定期审定和更新候选产品名单。</strong></p>
<p><strong>1.9.4自行软件开发</strong> 本项要求包括： a）应将开发环境与实际运行环境物理分开，测试数据和测试结果受到控制； <strong>b）应制定软件开发管理制度，明确说明开发过程的控制方法和人员行为准则； c）应制定代码编写安全规范，要求开发人员参照规范编写代码； d）应具备软件设计的相关文档和使用指南，并对文档使用进行控制；</strong> e）应保证在软件开发过程中对安全性进行测试，在软件安装前对可能存在的恶意代码进行检测； <strong>f）应对程序资源库的修改、更新、发布进行授权和批准，并严格进行版本控制； g）应保证开发人员未专职人员，开发人员的开发活动受到控制、监视和审查。</strong></p>
<p><strong>1.9.5外包软件开发</strong> 本项要求包括： a）应在软件交付前检测其中可能存在的恶意代码； b）应保证开发单位提供软件设计文档和使用指南； <strong>c）应保证开发单位提供软件源代码，并审查软件中可能存在的后门和隐蔽信道</strong></p>
<p><strong>1.9.6工程实施</strong> 本项要求包括： a）应指定或授权专门的部门或人员负责工程实施过程的管理； b）应制定安全工程实施方案控制工程实施过程； <strong>c）应通过第三方工程监理控制项目的实施过程。</strong></p>
<p><strong>1.9.7测试验收</strong> 本项要求包括： a）应制订测试验收方案，并依据测试验收方案实施测试验收，形成测试验收报告； b）应进行上线前的安全性测试，并出具安全测试报告，<strong>安全测试报告应包含密码应用安全性测试相关内容。</strong></p>
<p><strong>1.9.8系统交付</strong> 本项要求包括： a）应制定交付清单，并根据交付清单对所交接的设备、软件和文档等进行清点； b）应对负责运行维护的技术人员进行相应的技能培训； c）应提供建设过程文档和运行维护文档。</p>
<p><strong>1.9.9等级测评</strong> 本项要求包括： a）应定期进行等级测评，发现不符合相应等级保护标准要求的及时整改； b）应在发生重大变更或级别发生变化时进行等级测评； c）应确保测评机构的选择符合国家有关规定。</p>
<p><strong>1.9.10服务供应商选择</strong> 本项要求包括： a）应确保服务供应商的选择符合国家的有关规定； b）应与选定的服务供应商签订相关协议，明确整个服务供应链各方需履行的网络安全相关义务； c）应定期监督、评审和审核服务供应商提供的服务，并对其变更服务内容加以控制。</p>
<h4 id="1-10-安全运维管理"><a href="#1-10-安全运维管理" class="headerlink" title="1.10 安全运维管理"></a><strong>1.10 安全运维管理</strong></h4><p><strong>1.10.1环境管理</strong> 本项要求包括： a）应指定专门的部门或人员负责机房安全,对机房出入进行管理，定期对机房供配电、空调、温湿度控制、消防等设施进行维护管理； <strong>b）应建立机房安全管理制度，对有关物理访问、物品带进出和环境安全等方面的管理作出规定；</strong> c）应不在重要区域接待来访人员，不随意放置含有敏感信息的纸档文件和移动介质等。</p>
<p><strong>1.10.2资产管理</strong> 本项要求包括： a）应编制并保存与保护对象相关的资产清单，包括资产责任部门、重要程度和所处位置等内容； <strong>b）应根据资产的重要程度对资产进行标识管理，根据资产的价值选择相应的管理措施； c）应对信息分类与标识方法作出规定，并对信息的使用、传输和存储等进行规范化管理。</strong></p>
<p><strong>1.10.3介质管理</strong> 本项要求包括： a）应将介质存放在安全的环境中，对各类介质进行控制和保护，实行存储环境专人管理，并根据存档介质的目录清单定期盘点； b）应对介质在物理传输过程中的人员选择、打包、交付等情况进行控制，并对介质的归档和查询等进行登记记录。</p>
<p><strong>1.10.4设备维护管理</strong> 本项要求包括： a）应对各种设备（包括备份和冗余设备）、线路等指定专门的部门或人员定期进行维护管理； b）应建立配套设施、软硬件维护方面的管理制度，对其维护进行有效的管理，包括明确维护人员的责任、维修和服务的审批、维修过程的监督控制等； <strong>c）信息处理设备应经过审批才能带离机房或办公地点，含有存储介质的设备带出工作环境时其中重要数据应加密； d）含有存储介质的设备在报废或重用前，应进行完全清除或被安全覆盖，保证该设备上的敏感数据和授权软件无法被恢复重用。</strong></p>
<p><strong>1.10.5漏洞和风险管理</strong> 本项要求包括： a）应采取必要的措施识别安全漏洞和隐患，对发现的安全漏洞和隐患及时进行修补或评估可能的影响后进行修补； <strong>b）应定期开展安全测评，形成安全测评报告，采取措施应对发现的安全问题。</strong></p>
<p><strong>1.10.6网络和系统安全管理</strong> 本项要求包括： a）应划分不同的管理员角色进行网络和系统的运维管理，明确各个角色的责任和权限； b）应指定专门的部门或人员进行账户管理，对申请账户、建立账户、删除账户等进行控制； c）应建立网络和系统安全管理制度，对安全策略、账户管理、配置管理、日志管理、日常管理、日常操作、升级与打补丁、口令更新周期等方面做出规定； d）应制定重要设备的配置和操作手册，依据手册对设备进行安全配置和优化配置等； e）应详细记录运维操作日志，包括日常巡检工作、运行维护记录、参数的设置和修改等内容； <strong>f）应指定专门的部门或人员对日志、监测和报警数据等进行分析、统计，及时发现可疑行为； g）应严格控制变更性运维，经过审批后才可改变连接、安装系统组件或调整配置参数，操作过程中应保留不可更改的审计日志，操作结束后应同步更新配置信息库； h）应严格控制运维工具的使用，经过审批后才可接入进行操作，操作过程中应保留不可更改的审计日志，操作结束后应删除工具中的敏感数据； i）应严格控制远程运维的开通，经过审批后才可开通远程运维接口或通道，操作过程中应保留不可更改的审计日志，操作结束后立即关闭接口或通道； j）应保证所有与外部的连接均得到授权和批准，应定期检查违反规定无线上网及其他违反网络安全策略的行为。</strong></p>
<p><strong>1.10.7恶意代码防范管理</strong> 本项要求包括： a）提高所有用户的防恶意代码意识，对外来计算机或存储设备接入系统前进行恶意代码检查等； <strong>b）应定期验证防范恶意代码攻击的技术措施的有效性。</strong></p>
<p><strong>1.10.8配置管理</strong> 本项要求包括： a）应记录和保存基本配置信息，包括网络拓扑结构、各个设备安装的软件组件、软件组件的版本和补丁信息、各个设备或软件组件的配置参数等； <strong>b）应将基本配置信息改变纳入变更范畴，实施对配置信息改变的控制，并及时更新基本配置信息库。</strong></p>
<p><strong>1.10.9 密码管理</strong> 本项要求包括： a）应遵循密码相关国家标准和行业标准； b）应使用国家密码管理主管部门认证核准的密码技术和产品。</p>
<p><strong>1.10.10 变更管理</strong> 本项要求包括： a）应明确变更需求,变更前根据变更需求制定变更方案，变更方案经过评审、审批后方可实施； <strong>b）应建立变更的申报和审批控制程序，依据程序控制所有的变更，记录变更实施过程； c）应建立中止变更并从失败变更中恢复的程序，明确过程控制方法和人员职责。必要时对恢复过程进行演练。</strong></p>
<p><strong>1.10.11备份与恢复管理</strong> 本项要求包括： a）应识别需要定期备份的重要业务信息、系统数据及软件系统等； b）应规定备份信息的备份方式、备份频度、存储介质、保存期等； c）应根据数据的重要性和数据对系统运行的影响，制定数据的备份策略和恢复策略、备份程序和恢复程序等。</p>
<p><strong>1.10.12安全事件处置</strong> 本项要求包括： a）应及时向安全管理部门报告所发现的安全弱点和可疑事件； b）应制定安全事件报告和处置管理制度，明确不同安全事件的报告、处置和响应流程，规定安全事件的现场处理、事件报告和后期恢复的管理职责等； c）应在安全事件报告和响应处理过程中，分析和鉴定事件产生的原因，收集证据，记录处理过程，总结经验教训； d）对造成系统中断和造成信息泄漏的重大安全事件应采用不同的处理程序和报告程序。</p>
<p><strong>1.10.13应急预案管理</strong> 本项要求包括： <strong>a）应规定统一的应急预案框架，包括启动预案的条件、应急组织构成、应急资源保障、事后教育和培训等内容；</strong> b）应制定重要事件的应急预案，包括应急处理流程、系统恢复流程等内容； c）应定期对系统相关的人员进行应急预案培训，并进行应急预案的演练； <strong>d）应定期对原有的应急预案重新评估，修订完善。</strong></p>
<p><strong>1.10.14 外包运维管理</strong> 本项要求包括： a）应确保外包运维服务商的选择符合国家的有关规定； b）应与选定的外包运维服务商签订相关的协议，明确约定外包运维的范围、工作内容； <strong>c）应保证选择的外包运维服务商在技术和管理方面均应具有按照等级保护要求开展安全运维工作的能力，并将能力要求在签订的协议中明确； d）应在与外包运维服务商签订的协议中明确所有相关的安全要求，如可能涉及对敏感信息的访问、处理、存储要求，对IT基础设施中断服务的应急保障要求等。</strong></p>
<h3 id="2云计算安全扩展要求"><a href="#2云计算安全扩展要求" class="headerlink" title="2云计算安全扩展要求"></a><strong>2云计算安全扩展要求</strong></h3><h4 id="2-1安全物理环境"><a href="#2-1安全物理环境" class="headerlink" title="2.1安全物理环境"></a><strong>2.1安全物理环境</strong></h4><p><strong>2.1.1基础设施位置</strong> 应保证云计算基础设施位于中国境内。</p>
<h4 id="2-2安全通信网络"><a href="#2-2安全通信网络" class="headerlink" title="2.2安全通信网络"></a><strong>2.2安全通信网络</strong></h4><p><strong>2.2.1网络架构</strong> 本项要求包括： a）应保证云计算平台不承载高于其安全保护等级的业务应用系统； b）应实现不同云服务客户虚拟网络之间的隔离； c）应具有根据云服务客户业务需求提供通信传输、边界防护、入侵防范等安全机制的能力； d）应具有根据云服务客户业务需求自主设置安全策略的能力，包括定义访问路径、选择安全组件、配置安全策略； e）应提供开放接口或开放性安全服务，允许云服务客户接入第三方安全产品或在云计算平台选择第三方安全服务。</p>
<h4 id="2-3安全区域边界"><a href="#2-3安全区域边界" class="headerlink" title="2.3安全区域边界"></a><strong>2.3安全区域边界</strong></h4><p><strong>2.3.1访问控制</strong> 本项要求包括： a）应在虚拟化网络边界部署访问控制机制，并设置访问控制规则； b）应在不同等级的网络区域边界部署访问控制机制，设置访问控制规则。</p>
<p><strong>2.3.2入侵防范</strong> 本项要求包括： a）应能检测到云服务客户发起的网络攻击行为，并能记录攻击类型、攻击时间、攻击流量等； b）应能检测到对虚拟网络节点的网络攻击行为，并能记录攻击类型、攻击时间、攻击流量等； c）应能检测到虚拟机与宿主机、虚拟机与虚拟机之间的异常流量； <strong>d）应在检测到网络攻击行为、异常流量情况时进行告警。</strong></p>
<p><strong>2.3.3安全审计</strong> 本项要求包括： a）应对云服务商和云服务客户在远程管理时执行的特权命令进行审计，至少包括虚拟机删除、虚拟机重启； b）应保证云服务商对云服务客户系统和数据的操作可被云服务客户审计。</p>
<h4 id="2-4安全计算环境"><a href="#2-4安全计算环境" class="headerlink" title="2.4安全计算环境"></a><strong>2.4安全计算环境</strong></h4><p><strong>2.4.1身份鉴别</strong> <strong>当远程管理云计算平台中设备时,管理终端和云计算平台之间应建立双向身份验证机制。</strong></p>
<p><strong>2.4.2访问控制</strong> 本项要求包括： a）应保证当虚拟机迁移时，访问控制策略随其迁移； b）应允许云服务客户设置不同虚拟机之间的访问控制策略。</p>
<p><strong>2.4.3入侵防范</strong> 本项要求包括： <strong>a）应能检测虚拟机之间的资源隔离失效,并进行告警； b）应能检测非授权新建虚拟机或者重新启用虚拟机，并进行告警； c）应能够检测恶意代码感染及在虚拟机间蔓延的情况，并进行告警。</strong></p>
<p><strong>2.4.4镜像和快照保护</strong> 本项要求包括： a）应针对重要业务系统提供加固的操作系统镜像或操作系统安全加固服务； b）应提供虚拟机镜像、快照完整性校验功能，防止虚拟机镜像被恶意篡改； <strong>c）应采取密码技术或其他技术手段防止虚拟机镜像、快照中可能存在的敏感资源被非法访问。</strong></p>
<p><strong>2.4.5数据完整性和保密性</strong> 本项要求包括： a）应确保云服务客户数据、用户个人信息等存储于中国境内，如需岀境应遵循国家相关规定； b）应确保只有在云服务客户授权下，云服务商或第三方才具有云服务客户数据的管理权限； c）应<strong>使用校验码或密码技术</strong>确保虚拟机迁移过程中重要数据的完整性，并在检测到完整性受到破坏时釆取必要的恢复措施； <strong>d）应支持云服务客户部署密钥管理解决方案，保证云服务客户自行实现数据的加解密过程。</strong></p>
<p><strong>2.4.6数据备份恢复</strong> 本项要求包括： a）云服务客户应在本地保存其业务数据的备份； b）应提供査询云服务客户数据及备份存储位置的能力； <strong>c）云服务商的云存储服务应保证云服务客户数据存在若干个可用的副本，各副本之间的内容应保持一致；</strong> <strong>d）应为云服务客户将业务系统及数据迁移到其他云计算平台和本地系统提供技术手段，并协助完成迁移过程。</strong></p>
<p><strong>2.4.7剩余信息保护</strong> 本项要求包括： a）应保证虚拟机所使用的内存和存储空间回收时得到完全清除； b）云服务客户删除业务应用数据时，云计算平台应将云存储中所有副本删除。</p>
<h4 id="2-5安全管理中心"><a href="#2-5安全管理中心" class="headerlink" title="2.5安全管理中心"></a><strong>2.5安全管理中心</strong></h4><p><strong>2.5.1集中管控</strong> 本项要求包括： <strong>a）应能对物理资源和虚拟资源按照策略做统一管理调度与分配； b）应保证云计算平台管理流量与云服务客户业务流量分离； c）应根据云服务商和云服务客户的职责划分，收集各自控制部分的审计数据并实现各自的集中审计； d）应根据云服务商和云服务客户的职责划分，实现各自控制部分，包括虚拟化网络、虚拟机、虚拟化安全设备等的运行状况的集中监测。</strong></p>
<h4 id="2-6安全建设管理"><a href="#2-6安全建设管理" class="headerlink" title="2.6安全建设管理"></a><strong>2.6安全建设管理</strong></h4><p><strong>2.6.1云服务商选择</strong> 本项要求包括： a）应选择安全合规的云服务商，其所提供的云计算平台应为其所承载的业务应用系统提供相应等级的安全保护能力； b）应在服务水平协议中规定云服务的各项服务内容和具体技术指标； c）应在服务水平协议中规定云服务商的权限与责任，包括管理范围、职责划分、访问授权、隐私保护、行为准则、违约责任等； d）应在服务水平协议中规定服务合约到期时，完整提供云服务客户数据，并承诺相关数据在云计算平台上清除； <strong>e）应与选定的云服务商签署保密协议，要求其不得泄露云服务客户数据。</strong></p>
<p><strong>2.6.2供应链管理</strong> 本项要求包括： a）应确保供应商的选择符合国家有关规定； b）应将供应链安全事件信息或安全威胁信息及时传达到云服务客户； <strong>c）应将供应商的重要变更及时传达到云服务客户，并评估变更带来的安全风险，采取措施对风险进行控制。</strong></p>
<h4 id="2-7-安全运维管理"><a href="#2-7-安全运维管理" class="headerlink" title="2.7 安全运维管理"></a><strong>2.7 安全运维管理</strong></h4><p><strong>2.7.1云计算环境管理</strong> 云计算平台的运维地点应位于中国境内，境外对境内云计算平台实施运维操作应遵循国家相关规定。</p>
<h3 id="3移动互联安全扩展要求"><a href="#3移动互联安全扩展要求" class="headerlink" title="3移动互联安全扩展要求"></a><strong>3移动互联安全扩展要求</strong></h3><h4 id="3-1安全物理环境"><a href="#3-1安全物理环境" class="headerlink" title="3.1安全物理环境"></a><strong>3.1安全物理环境</strong></h4><p><strong>3.1.1无线接入点的物理位置</strong> 应为无线接入设备的安装选择合理位置,避免过度覆盖和电磁干扰。</p>
<h4 id="3-2安全区域边界"><a href="#3-2安全区域边界" class="headerlink" title="3.2安全区域边界"></a><strong>3.2安全区域边界</strong></h4><p><strong>3.2.1边界防护</strong> 应保证有线网络与无线网络边界之间的访问和数据流通过无线接入网关设备。</p>
<p><strong>3.2.2访问控制</strong> 无线接入设备应开启接入认证功能，并支持釆用认证服务器认证或国家密码管理机构批准的密码模块进行认证。</p>
<p><strong>3.2.3入侵防范</strong> 本项要求包括： a）应能够检测到非授权无线接入设备和非授权移动终端的接入行为； b）应能够检测到针对无线接入设备的网络扫描、DDoS攻击、密钥破解、中间人攻击和欺骗攻击等行为； c）应能够检测到无线接入设备的SSID广播、WPS等高风险功能的开启状态； d）应禁用无线接入设备和无线接入网关存在风险的功能，如:SSID广播、WEP认证等； e）应禁止多个AP使用同一个认证密钥； <strong>f）应能够阻断非授权无线接入设备或非授权移动终端。</strong></p>
<h4 id="3-3安全计算环境"><a href="#3-3安全计算环境" class="headerlink" title="3.3安全计算环境"></a><strong>3.3安全计算环境</strong></h4><p><strong>3.3.1移动终端管控</strong> 本项要求包括： a）应保证移动终端安装、注册并运行终端管理客户端软件； b）移动终端应接受移动终端管理服务端的设备生命周期管理、设备远程控制，如：远程锁定、远程擦除等。</p>
<p><strong>3.3.2移动应用管控</strong> 本项要求包括： a）应具有选择应用软件安装、运行的功能； b）应只允许指定证书签名的应用软件安装和运行； <strong>c）应具有软件白名単功能，应能根据白名单控制应用软件安装、运行。</strong></p>
<h4 id="3-4安全建设管理"><a href="#3-4安全建设管理" class="headerlink" title="3.4安全建设管理"></a><strong>3.4安全建设管理</strong></h4><p><strong>3.4.1移动应用软件采购</strong> 本项要求包括： a）应保证移动终端安装、运行的应用软件来自可靠分发渠道或使用可靠证书签名； b）应保证移动终端安装、运行的应用软件由指定的开发者开发。</p>
<p><strong>3.4.2移动应用软件开发</strong> 本项要求包括: a）应对移动业务应用软件开发者进行资格审查； b）应保证开发移动业务应用软件的签名证书合法性。</p>
<h4 id="3-5安全运维管理"><a href="#3-5安全运维管理" class="headerlink" title="3.5安全运维管理"></a><strong>3.5安全运维管理</strong></h4><p><strong>3.5.1配置管理</strong> 应建立合法无线接入设备和合法移动终端配置库，用于对非法无线接入设备和非法移动终端的识别。</p>
<h3 id="4物联网安全扩展要求"><a href="#4物联网安全扩展要求" class="headerlink" title="4物联网安全扩展要求"></a><strong>4物联网安全扩展要求</strong></h3><h4 id="4-1安全物理环境"><a href="#4-1安全物理环境" class="headerlink" title="4.1安全物理环境"></a><strong>4.1安全物理环境</strong></h4><p><strong>4.1.1感知节点设备物理防护</strong> 本项要求包括： a）感知节点设备所处的物理环境应不对感知节点设备造成物理破坏，如挤压、强振动； b）感知节点设备在工作状态所处物理环境应能正确反映环境状态（如温湿度传感器不能安装在阳光直射区域）； <strong>c）感知节点设备在工作状态所处物理环境应不对感知节点设备的正常工作造成影响，如强干扰、阻挡屏蔽等； d）关键感知节点设备应具有可供长时间工作的电力供应（关键网关节点设备应具有持久稳定的电力供应能力）。</strong></p>
<h4 id="4-2安全区域边界"><a href="#4-2安全区域边界" class="headerlink" title="4.2安全区域边界"></a><strong>4.2安全区域边界</strong></h4><p><strong>4.2.1接入控制</strong> 应保证只有授权的感知节点可以接入。</p>
<p><strong>4.2.2入侵防范</strong> 本项要求包括： a）应能够限制与感知节点通信的目标地址，以避免对陌生地址的攻击行为； b）应能够限制与网关节点通信的目标地址，以避免对陌生地址的攻击行为。</p>
<h4 id="4-3安全计算环境"><a href="#4-3安全计算环境" class="headerlink" title="4.3安全计算环境"></a><strong>4.3安全计算环境</strong></h4><p><strong>4.3.1感知节点设备安全</strong> 本项要求包括： <strong>a）应保证只有授权的用户可以对感知节点设备上的软件应用进行配置或变更； b）应具有对其连接的网关节点设备（包括读卡器）进行身份标识和鉴别的能力； c）应具有对其连接的其他感知节点设备（包括路由节点）进行身份标识和鉴别的能力。</strong></p>
<p><strong>4.3.2网关节点设备安全</strong> 本项要求包括： <strong>a）应具备对合法连接设备（包括终端节点、路由节点、数据处理中心）进行标识和鉴别的能力； b）应具备过滤非法节点和伪造节点所发送的数据的能力； c）授权用户应能够在设备使用过程中对关键密钥进行在线更新； d）授权用户应能够在设备使用过程中对关键配置参数进行在线更新。</strong></p>
<p><strong>4.3.3抗数据重放</strong> 本项要求包括： <strong>a）应能够鉴别数据的新鲜性，避免历史数据的重放攻击； b）应能够鉴别历史数据的非法修改，避免数据的修改重放攻击。</strong></p>
<p><strong>4.3.4数据融合处理</strong> <strong>应对来自传感网的数据进行数据融合处理，使不同种类的数据可以在同一个平台被使用。</strong></p>
<h4 id="4-4安全运维管理"><a href="#4-4安全运维管理" class="headerlink" title="4.4安全运维管理"></a><strong>4.4安全运维管理</strong></h4><p><strong>4.4.1感知节点管理</strong> 本项要求包括： a）应指定人员定期巡视感知节点设备、网关节点设备的部署环境，对可能影响感知节点设备、网关节点设备正常工作的环境异常进行记录和维护； b）应对感知节点设备、网关节点设备入库、存储、部署、携带、维修、丢失和报废等过程作出明确规定，并进行全程管理； <strong>c）应加强对感知节点设备、网关节点设备部署环境的保密性管理，包括负责检查和维护的人员调离工作岗位应立即交还相关检查工具和检查维护记录等。</strong></p>
<h3 id="5工业控制系统安全扩展要求"><a href="#5工业控制系统安全扩展要求" class="headerlink" title="5工业控制系统安全扩展要求"></a><strong>5工业控制系统安全扩展要求</strong></h3><h4 id="5-1安全物理环境"><a href="#5-1安全物理环境" class="headerlink" title="5.1安全物理环境"></a><strong>5.1安全物理环境</strong></h4><p><strong>5.1.1室外控制设备物理防护</strong> 本项要求包括： a）室外控制设备应放置于采用铁板或其他防火材料制作的箱体或装置中并紧固；箱体或装置具有透风、散热、防盗、防雨和防火能力等； b）室外控制设备放置应远离强电磁干扰、强热源等环境，如无法避免应及时做好应急处置及检修，保证设备正常运行。</p>
<h4 id="5-2安全通信网络"><a href="#5-2安全通信网络" class="headerlink" title="5.2安全通信网络"></a><strong>5.2安全通信网络</strong></h4><p><strong>5.2.1网络架构</strong> 本项要求包括： a）工业控制系统与企业其他系统之间应划分为两个区域，区域间应采用单向的技术隔离手段； b）工业控制系统内部应根据业务特点划分为不同的安全域，安全域之间应釆用技术隔离手段； c）涉及实时控制和数据传输的工业控制系统，应使用独立的网络设备组网，在物理层面上实现与其他数据网及外部公共信息网的安全隔离。</p>
<p><strong>5.2.2通信传输</strong> 在工业控制系统内使用广域网进行控制指令或相关数据交换的应釆用加密认证技术手段实现身份认证、访问控制和数据加密传输。</p>
<h4 id="5-3安全区域边界"><a href="#5-3安全区域边界" class="headerlink" title="5.3安全区域边界"></a><strong>5.3安全区域边界</strong></h4><p><strong>5.3.1访问控制</strong> 本项要求包括： a）应在工业控制系统与企业其他系统之间部署访问控制设备，配置访问控制策略，禁止任何穿越区域边界的E-Mail、Web、Telnet、Rlogin、FTP等通用网络服务； b）应在工业控制系统内安全域和安全域之间的边界防护机制失效时，及时进行报警。</p>
<p><strong>5.3.2拨号使用控制</strong> 本项要求包括： a）工业控制系统确需使用拨号访问服务的，应限制具有拨号访问权限的用户数量，并釆取用户身份鉴别和访问控制等措施； <strong>b）拨号服务器和客户端均应使用经安全加固的操作系统，并采取数字证书认证、传输加密和访问控制等措施。</strong></p>
<p><strong>5.3.3无线使用控制</strong> 本项要求包括： a）应对所有参与无线通信的用户（人员、软件进程或者设备）提供唯一性标识和鉴别； b）应对所有参与无线通信的用户（人员、软件进程或者设备）进行授权以及执行使用进行限制； <strong>c）应对无线通信采取传输加密的安全措施，实现传输报文的机密性保护； d）对采用无线通信技术进行控制的工业控制系统，应能识别其物理环境中发射的未经授权的无线设备，报告未经授权试图接入或干扰控制系统的行为。</strong></p>
<h4 id="5-4安全计算环境"><a href="#5-4安全计算环境" class="headerlink" title="5.4安全计算环境"></a><strong>5.4安全计算环境</strong></h4><p><strong>5.4.1控制设备安全</strong> 本项要求包括： a）控制设备自身应实现相应级别安全通用要求提出的身份鉴别、访问控制和安全审计等安全要求，如受条件限制控制设备无法实现上述要求，应由其上位控制或管理设备实现同等功能或通过管理手段控制； b）应在经过充分测试评估后，在不影响系统安全稳定运行的情况下对控制设备进行补丁更新、固件更新等工作； <strong>c）应关闭或拆除控制设备的软盘驱动、光盘驱动、USB接口、串行口或多余网口等，确需保留的应通过相关的技术措施实施严格的监控管理； d）应使用专用设备和专用软件对控制设备进行更新； e）应保证控制设备在上线前经过安全性检测，避免控制设备固件中存在恶意代码程序。</strong></p>
<h4 id="5-5安全建设管理"><a href="#5-5安全建设管理" class="headerlink" title="5.5安全建设管理"></a><strong>5.5安全建设管理</strong></h4><p><strong>5.5.1产品采购和使用</strong> 工业控制系统重要设备应通过专业机构的安全性检测后方可采购使用。</p>
<p><strong>5.5.2外包软件开发</strong> 应在外包开发合同中规定针对开发单位、供应商的约束条款，包括设备及系统在生命周期内有关保密、禁止关键技术扩散和设备行业专用等方面的内容。</p>
<p><strong>等保二级与三级区别</strong> 等保二级测评项为 135 项 等保三级测评项为 211 项（不含云计算、物联网、工控 扩展项）</p>
<p><img src="/images/dengbao.png"></p>
<h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a><strong>参考文档</strong></h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_30687051/article/details/97707147">等保2.0三级安全要求</a></p>
<p><a target="_blank" rel="noopener" href="http://www.51djbh.com/?p=949">等保需要哪些安全设备</a></p>
<p><a target="_blank" rel="noopener" href="https://www.sohu.com/a/416095013_120171895">等保2.0二级和三级的区别</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2021/03/07/2021/03/2021-03-07-python%E8%BF%90%E7%BB%B4%E7%9B%B8%E5%85%B3%E6%A8%A1%E5%9D%97%E6%B1%87%E6%80%BB/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/07/2021/03/2021-03-07-python%E8%BF%90%E7%BB%B4%E7%9B%B8%E5%85%B3%E6%A8%A1%E5%9D%97%E6%B1%87%E6%80%BB/index/" class="post-title-link" itemprop="url">Python运维相关模块汇总</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-03-07 08:00:00" itemprop="dateCreated datePublished" datetime="2021-03-07T08:00:00+08:00">2021-03-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:35" itemprop="dateModified" datetime="2023-05-26T15:06:35+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/op/" itemprop="url" rel="index"><span itemprop="name">op</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="系统性能信息模块psutil"><a href="#系统性能信息模块psutil" class="headerlink" title="系统性能信息模块psutil"></a><strong>系统性能信息模块psutil</strong></h3><p>psutil是一个跨平台库（<a target="_blank" rel="noopener" href="http://code.google.com/p/psutil/%EF%BC%89%EF%BC%8C%E8%83%BD%E5%A4%9F%E8%BD%BB%E6%9D%BE%E5%AE%9E%E7%8E%B0%E8%8E%B7%E5%8F%96%E7%B3%BB%E7%BB%9F%E8%BF%90%E8%A1%8C%E7%9A%84%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%B3%BB%E7%BB%9F%E5%88%A9%E7%94%A8%E7%8E%87%EF%BC%88%E5%8C%85%E6%8B%ACCPU%E3%80%81%E5%86%85%E5%AD%98%E3%80%81%E7%A3%81%E7%9B%98%E3%80%81%E7%BD%91%E7%BB%9C%E7%AD%89%EF%BC%89%E4%BF%A1%E6%81%AF%E3%80%82%E5%AE%83%E4%B8%BB%E8%A6%81%E5%BA%94%E7%94%A8%E4%BA%8E%E7%B3%BB%E7%BB%9F%E7%9B%91%E6%8E%A7%EF%BC%8C%E5%88%86%E6%9E%90%E5%92%8C%E9%99%90%E5%88%B6%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E5%8F%8A%E8%BF%9B%E7%A8%8B%E7%9A%84%E7%AE%A1%E7%90%86%E3%80%82%E5%AE%83%E5%AE%9E%E7%8E%B0%E4%BA%86%E5%90%8C%E7%AD%89%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7%E6%8F%90%E4%BE%9B%E7%9A%84%E5%8A%9F%E8%83%BD%EF%BC%8C%E5%A6%82ps%E3%80%81top%E3%80%81lsof%E3%80%81netstat%E3%80%81ifconfig%E3%80%81who%E3%80%81df%E3%80%81kill%E3%80%81free%E3%80%81nice%E3%80%81ionice%E3%80%81iostat%E3%80%81iotop%E3%80%81uptime%E3%80%81pidof%E3%80%81tty%E3%80%81taskset%E3%80%81pmap%E7%AD%89%E3%80%82">http://code.google.com/p/psutil/），能够轻松实现获取系统运行的进程和系统利用率（包括CPU、内存、磁盘、网络等）信息。它主要应用于系统监控，分析和限制系统资源及进程的管理。它实现了同等命令行工具提供的功能，如ps、top、lsof、netstat、ifconfig、who、df、kill、free、nice、ionice、iostat、iotop、uptime、pidof、tty、taskset、pmap等。</a></p>
<h3 id="发送电子邮件模块smtplib"><a href="#发送电子邮件模块smtplib" class="headerlink" title="发送电子邮件模块smtplib"></a><strong>发送电子邮件模块smtplib</strong></h3><p>Python的smtplib模块来实现邮件的发送功能，模拟一个smtp客户端，通过与smtp服务器交互来实现邮件发送的功能，这可以理解成Foxmail的发邮件功能，在第一次使用之前我们需要配置smtp主机地址、邮箱账号及密码等信息，Python 2.3或更高版本默认自带smtplib模块。 SMTP类定义：smtplib.SMTP([host[, port[, local_hostname[,timeout]]]])，作为SMTP的构造函数，功能是与smtp服务器建立连接，在连接成功后，就可以向服务器发送相关请求，比如登录、校验、发送、退出等。</p>
<h3 id="探测Web服务质量方法"><a href="#探测Web服务质量方法" class="headerlink" title="探测Web服务质量方法"></a><strong>探测Web服务质量方法</strong></h3><p>pycurl（<a target="_blank" rel="noopener" href="http://pycurl.sourceforge.net)是一个用c语言写的libcurl/">http://pycurl.sourceforge.net）是一个用C语言写的libcurl</a> Python实现，功能非常强大，支持的操作协议有FTP、HTTP、HTTPS、TELNET等，可以理解成Linux下curl命令功能的Python封装，简单易用。本节通过调用pycurl提供的方法，实现探测Web服务质量的情况，比如响应的HTTP状态码、请求延时、HTTP头信息、下载速度等，利用这些信息可以定位服务响应慢的具体环节。</p>
<h3 id="构建集中式的病毒扫描机制"><a href="#构建集中式的病毒扫描机制" class="headerlink" title="构建集中式的病毒扫描机制"></a><strong>构建集中式的病毒扫描机制</strong></h3><p>Clam AntiVirus（ClamAV）是一款免费而且开放源代码的防毒软件，软件与病毒库的更新皆由社区免费发布，官网地址：<a target="_blank" rel="noopener" href="http://www.clamav.net/lang/en/%E3%80%82%E7%9B%AE%E5%89%8DClamAV%E4%B8%BB%E8%A6%81%E4%B8%BALinux%E3%80%81Unix%E7%B3%BB%E7%BB%9F%E6%8F%90%E4%BE%9B%E7%97%85%E6%AF%92%E6%89%AB%E6%8F%8F%E3%80%81%E6%9F%A5%E6%9D%80%E7%AD%89%E6%9C%8D%E5%8A%A1%E3%80%82pyClamad%EF%BC%88http://xael.org/norman/python/pyclamd/%EF%BC%89%E6%98%AF%E4%B8%80%E4%B8%AAPython%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A8%A1%E5%9D%97%EF%BC%8C%E5%8F%AF%E8%AE%A9Python%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8ClamAV%E7%97%85%E6%AF%92%E6%89%AB%E6%8F%8F%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8Bclamd%EF%BC%8C%E6%9D%A5%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E9%AB%98%E6%95%88%E7%9A%84%E7%97%85%E6%AF%92%E6%A3%80%E6%B5%8B%E5%8A%9F%E8%83%BD%EF%BC%8C%E5%8F%A6%E5%A4%96%EF%BC%8CpyClamad%E6%A8%A1%E5%9D%97%E4%B9%9F%E9%9D%9E%E5%B8%B8%E5%AE%B9%E6%98%93%E6%95%B4%E5%90%88%E5%88%B0%E6%88%91%E4%BB%AC%E5%B7%B2%E6%9C%89%E7%9A%84%E5%B9%B3%E5%8F%B0%E5%BD%93%E4%B8%AD%E3%80%82">http://www.clamav.net/lang/en/。目前ClamAV主要为Linux、Unix系统提供病毒扫描、查杀等服务。pyClamad（http://xael.org/norman/python/pyclamd/）是一个Python第三方模块，可让Python直接使用ClamAV病毒扫描守护进程clamd，来实现一个高效的病毒检测功能，另外，pyClamad模块也非常容易整合到我们已有的平台当中。</a></p>
<h3 id="实现高效的端口扫描器"><a href="#实现高效的端口扫描器" class="headerlink" title="实现高效的端口扫描器"></a><strong>实现高效的端口扫描器</strong></h3><p>python-nmap模块作为nmap命令的Python封装，可以让Python很方便地操作nmap扫描器，它可以帮助管理员完成自动扫描任务和生成报告。 python-nmap模块的两个常用类，一个为PortScanner()类，实现一个nmap工具的端口扫描功能封装；另一个为PortScannerHostDict()类，实现存储与访问主机的扫描结果。</p>
<h3 id="系统批量运维管理器paramiko"><a href="#系统批量运维管理器paramiko" class="headerlink" title="系统批量运维管理器paramiko"></a><strong>系统批量运维管理器paramiko</strong></h3><p>paramiko是基于Python实现的SSH2远程安全连接，支持认证及密钥方式。可以实现远程命令执行、文件传输、中间SSH代理等功能，相对于Pexpect，封装的层次更高，更贴近SSH协议的功能，官网地址：<a target="_blank" rel="noopener" href="http://www.paramiko.org./">http://www.paramiko.org。</a> paramiko包含两个核心组件，一个为SSHClient类，另一个为SFTPClient类。 SSHClient类是SSH服务会话的高级表示，该类封装了传输（transport）、通道（channel）及SFTPClient的校验、建立的方法，通常用于执行远程命令。 SFTPClient作为一个SFTP客户端对象，根据SSH传输协议的sftp会话，实现远程文件操作，比如文件上传、下载、权限、状态等操作。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2021/02/18/2021/02/2021-02-18-%E6%91%84%E5%83%8F%E5%A4%B4%E5%B8%A6%E5%AE%BD%E4%BC%B0%E7%AE%97/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/18/2021/02/2021-02-18-%E6%91%84%E5%83%8F%E5%A4%B4%E5%B8%A6%E5%AE%BD%E4%BC%B0%E7%AE%97/index/" class="post-title-link" itemprop="url">网络摄像头带宽估算</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-18 08:00:00" itemprop="dateCreated datePublished" datetime="2021-02-18T08:00:00+08:00">2021-02-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:35" itemprop="dateModified" datetime="2023-05-26T15:06:35+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/op/" itemprop="url" rel="index"><span itemprop="name">op</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="像素"><a href="#像素" class="headerlink" title="像素"></a><strong>像素</strong></h3><p>一个像素占多大内存 多少字节取决于需要存储一个像素的多少信息，以及是否采用了压缩技术。 如果是非黑即白的二值图像，不压缩的情况下一个像素只需要1个bit。 如果是256种状态的灰度图像，不压缩的情况下一个像素需要8bit（1字节，256种状态）。 如果用256种状态标识屏幕上某种颜色的灰度，而屏幕采用三基色红绿蓝（RGB），不压缩的情况下一个像素需要占用24bit（3字节），这个就是常说的24位真彩色。</p>
<h3 id="分辨率"><a href="#分辨率" class="headerlink" title="分辨率"></a><strong>分辨率</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">720P：分辨率1280*720</span><br><span class="line">1080P：分辨率1920*1080</span><br><span class="line">2K：分辨率2048*1080</span><br><span class="line">4K：分辨率4096*2160</span><br></pre></td></tr></table></figure>

<p>其中P表示视频像素总行数，例如720P视频有720行像素数。 其中K表示视频像素总列数，例如2K表示视频有2048列像素数。 MP代表像素总数，指像素的行数（P）与列数（K)相乘后的一个结果（百万像素）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">720P分辨率为1280*720P像素，实际像素为921600，百万像素。</span><br><span class="line">1080P分辨率为1920*1080P像素，实际像素为2073600，200万像素分辨率。</span><br><span class="line">2K分辨率为2048*1080P像素，实际像素为221184600，200万像素分辨率。</span><br><span class="line">4K分辨率为4096*2160P像素，实际像素为8847360，800万像素分辨率。</span><br></pre></td></tr></table></figure>

<h3 id="视频帧率"><a href="#视频帧率" class="headerlink" title="视频帧率"></a><strong>视频帧率</strong></h3><p>帧率，FPS，全称Frames Per Second。指每秒传输的帧数，或者每秒显示的帧数，一般来说，帧率影响画面流畅度，且成正比：帧率越大，画面越流畅；帧率越小，画面越有跳动感。 一个较权威的说法：当视频帧率不低于24fps时，人眼才会觉得视频时连贯的，称为“视觉暂留”现象。因此，才有说法：尽管帧率越高越流畅，但在很多实际应用场景中24fps就可以了。</p>
<p><strong>24fps</strong> 24fps是以前将视频信号传输到胶片时被广泛使用的帧速率,也是常用的标准帧速率。现如今,大多数电影也依然采用24fps帧速率。如果您想制作短剧、短片，或者是电影视频，都可以使用24fps的帧速率。</p>
<p><strong>30fps</strong> 30fps通常是新闻、电视剧以及网络上看到的许多视频所使用的帧速率，也是比较常用的帧速率之一。如果您平时录制一些视频，想分享到网络上的，可以选择使用30fps帧速率。</p>
<p><strong>60fps</strong> 60fps可以提供更加平滑、流畅的画面运动，是现在一些高端的高清电视以及一些游戏所广泛使用的帧速率。</p>
<h3 id="视频编码"><a href="#视频编码" class="headerlink" title="视频编码"></a><strong>视频编码</strong></h3><p>所谓视频编码方式就是指通过压缩技术，将原始视频格式的文件转换成另一种视频格式文件的方式。 现在主要在用的有H.264和H.265，他们具体区别如下： - 版本 H.265是新的编码协议，也即是H.264的升级版。H.265标准保留H.264原来的某些技术，同时对一些相关的技术加以改进。新技术使用先进的技术用以改善码流、编码质量、延时和算法复杂度之间的关系，达到最优化设置；</p>
<ul>
<li><p>降码率 比起H.264&#x2F;AVC，H.265&#x2F;HEVC提供了更多不同的工具来降低码率，以编码单位来说，H.264中每个宏块（macroblock&#x2F;MB）大小都是固定的16x16像素，而H.265的编码单位可以选择从最小的8x8到最大的64x64；</p>
</li>
<li><p>采用了块的四叉树划分结构 H.265相比H.264最主要的改变是采用了块的四叉树划分结构，采用了从64x64~8x8像素的自适应块划分，并基于这种块划分结构采用一系列自适应的预测和变换等编码技术；</p>
</li>
<li><p>算法优化 H264由于算法优化，可以低于1Mbps的速度实现标清数字图像传送；H265则可以实现利用1~2Mbps的传输速度传送720P（分辨率1280*720）普通高清音视频传送；</p>
</li>
<li><p>占用的存储空间缩小 同样的画质和同样的码率，H.265比H2.64 占用的存储空间要少理论50%；</p>
</li>
</ul>
<h3 id="带宽预估"><a href="#带宽预估" class="headerlink" title="带宽预估"></a><strong>带宽预估</strong></h3><p><strong>H.264压缩</strong></p>
<table>
<thead>
<tr>
<th align="center">分辨率</th>
<th align="center">水平像素（点）</th>
<th align="center">垂直像素（点）</th>
<th align="center">图像位深bit</th>
<th align="center">单幅图像数据量Mbit</th>
<th align="center">帧率fps</th>
<th align="center">全帧码流Mbit&#x2F;S</th>
<th align="center">视频流 Mbit&#x2F;S</th>
<th align="center">网络带宽Mbit&#x2F;s</th>
</tr>
</thead>
<tbody><tr>
<td align="center">高清720P</td>
<td align="center">1280</td>
<td align="center">720</td>
<td align="center">24</td>
<td align="center">21</td>
<td align="center">24</td>
<td align="center">506</td>
<td align="center">6</td>
<td align="center">3</td>
</tr>
<tr>
<td align="center">全高清1080P</td>
<td align="center">1920</td>
<td align="center">1080</td>
<td align="center">24</td>
<td align="center">47</td>
<td align="center">24</td>
<td align="center">1139</td>
<td align="center">14</td>
<td align="center">7</td>
</tr>
<tr>
<td align="center">500万</td>
<td align="center">2560</td>
<td align="center">1920</td>
<td align="center">24</td>
<td align="center">113</td>
<td align="center">24</td>
<td align="center">2700</td>
<td align="center">34</td>
<td align="center">18</td>
</tr>
<tr>
<td align="center">4K（8百万）</td>
<td align="center">3840</td>
<td align="center">2160</td>
<td align="center">24</td>
<td align="center">190</td>
<td align="center">50</td>
<td align="center">9492</td>
<td align="center">119</td>
<td align="center">62</td>
</tr>
</tbody></table>
<p><strong>H.265压缩</strong></p>
<table>
<thead>
<tr>
<th align="center">分辨率</th>
<th align="center">水平像素（点）</th>
<th align="center">垂直像素（点）</th>
<th align="center">图像位深bit</th>
<th align="center">单幅图像数据量Mbit</th>
<th align="center">帧率fps</th>
<th align="center">全帧码流Mbit&#x2F;S</th>
<th align="center">视频流 Mbit&#x2F;S</th>
<th align="center">网络带宽Mbit&#x2F;s</th>
</tr>
</thead>
<tbody><tr>
<td align="center">高清720P</td>
<td align="center">1280</td>
<td align="center">720</td>
<td align="center">24</td>
<td align="center">21</td>
<td align="center">24</td>
<td align="center">506</td>
<td align="center">3</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">全高清1080P</td>
<td align="center">1920</td>
<td align="center">1080</td>
<td align="center">24</td>
<td align="center">47</td>
<td align="center">24</td>
<td align="center">1139</td>
<td align="center">7</td>
<td align="center">4</td>
</tr>
<tr>
<td align="center">500万</td>
<td align="center">2560</td>
<td align="center">1920</td>
<td align="center">24</td>
<td align="center">113</td>
<td align="center">24</td>
<td align="center">2700</td>
<td align="center">17</td>
<td align="center">9</td>
</tr>
<tr>
<td align="center">4K（8百万）</td>
<td align="center">3840</td>
<td align="center">2160</td>
<td align="center">24</td>
<td align="center">190</td>
<td align="center">50</td>
<td align="center">9492</td>
<td align="center">59</td>
<td align="center">31</td>
</tr>
</tbody></table>
<p><img src="/images/node.png"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2021/01/22/2021/01/2021-01-22-tcp%E5%9B%9B%E5%B1%82%E4%BB%A3%E7%90%86%E9%80%8F%E4%BC%A0%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9C%9F%E5%AE%9Eip/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/22/2021/01/2021-01-22-tcp%E5%9B%9B%E5%B1%82%E4%BB%A3%E7%90%86%E9%80%8F%E4%BC%A0%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9C%9F%E5%AE%9Eip/index/" class="post-title-link" itemprop="url">TCP四层代理透传客户端真实IP</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-01-22 08:00:00" itemprop="dateCreated datePublished" datetime="2021-01-22T08:00:00+08:00">2021-01-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:35" itemprop="dateModified" datetime="2023-05-26T15:06:35+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/middleware/" itemprop="url" rel="index"><span itemprop="name">middleware</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="缘起"><a href="#缘起" class="headerlink" title="缘起"></a><strong>缘起</strong></h3><p>最近公司准备自建邮箱，大概十年前折腾过自建邮箱的事情，感觉坑很多，这次体会了下确实很多，特别是现在管局对邮箱端口管控越来越严格的情况下，很多之前能行得通的方案需要修改下。 由于SMTP、POP3、IMAP等协议需要做四层代理且还需要能穿透客户端真实IP，硬件网络层代理软件又不能使用的情况下只能考虑软代理，下面是记录的两种解决方案。</p>
<h3 id="方案"><a href="#方案" class="headerlink" title="方案"></a><strong>方案</strong></h3><h4 id="Nginx解决方案"><a href="#Nginx解决方案" class="headerlink" title="Nginx解决方案"></a><strong>Nginx解决方案</strong></h4><p><strong>1.注意nginx编译时需要加上stream模块及stream_realip_module模块;一个用来四层负载，一个用来获取客户端真实IP</strong> <strong>2.开启透传功能proxy_protocol on，用于将连接信息从请求连接的源传递到请求连接到的目标</strong></p>
<p>具体配置如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"># /usr/local/nginx/sbin/nginx -V</span><br><span class="line">nginx version: nginx/1.16.1</span><br><span class="line">built by gcc 4.8.5 20150623 (Red Hat 4.8.5-44) (GCC) </span><br><span class="line">built with OpenSSL 1.0.2k-fips  26 Jan 2017</span><br><span class="line">TLS SNI support enabled</span><br><span class="line">configure arguments: --prefix=/usr/local/nginx  --with-stream --with-stream_realip_module</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># cat /usr/local/nginx/conf/nginx.conf</span><br><span class="line"></span><br><span class="line">user  nginx;</span><br><span class="line">worker_processes  auto;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  10240;</span><br><span class="line">    &#125;</span><br><span class="line">include tcp/*.conf;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># cat /usr/local/nginx/conf/tcp/mail.conf</span><br><span class="line"></span><br><span class="line">stream &#123;</span><br><span class="line">    log_format proxy &#x27;$remote_addr [$time_local] &#x27;</span><br><span class="line">                 &#x27;$protocol $status $bytes_sent $bytes_received &#x27;</span><br><span class="line">                 &#x27;$session_time &quot;$upstream_addr&quot; &#x27;</span><br><span class="line">                 &#x27;&quot;$upstream_bytes_sent&quot; &quot;$upstream_bytes_received&quot; &quot;$upstream_connect_time&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    access_log /usr/local/nginx/logs/mail.log proxy;</span><br><span class="line"></span><br><span class="line">    upstream mail_http &#123;</span><br><span class="line">        server 192.168.188.88:80 ;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        proxy_connect_timeout 10s;</span><br><span class="line">        proxy_timeout 30s;</span><br><span class="line">        proxy_pass mail_web;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    upstream mail_https &#123;</span><br><span class="line">        server 192.168.188.88:443 ;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 443;</span><br><span class="line">        proxy_connect_timeout 10s;</span><br><span class="line">        proxy_timeout 30s;</span><br><span class="line">        proxy_pass mail_https;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    upstream mail_smtp &#123;</span><br><span class="line">        server 192.168.188.88:25 ;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 25 ;</span><br><span class="line">        proxy_connect_timeout 10s;</span><br><span class="line">        proxy_timeout 300s;</span><br><span class="line">        proxy_protocol on ;</span><br><span class="line">        proxy_pass mail_smtp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    upstream mail_smtps &#123;</span><br><span class="line">        server 192.168.188.88:465 ;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 465;</span><br><span class="line">        proxy_connect_timeout 10s;</span><br><span class="line">        proxy_timeout 30s;</span><br><span class="line">        proxy_protocol on ;</span><br><span class="line">        proxy_pass mail_smtps;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    upstream mail_pop3 &#123;</span><br><span class="line">        server 192.168.188.88:110 ;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 110;</span><br><span class="line">        proxy_connect_timeout 10s;</span><br><span class="line">        proxy_timeout 30s;</span><br><span class="line">        proxy_protocol on ;</span><br><span class="line">        proxy_pass mail_pop3;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    upstream mail_pop3s &#123;</span><br><span class="line">        server 192.168.188.88:995 ;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 995;</span><br><span class="line">        proxy_connect_timeout 10s;</span><br><span class="line">        proxy_timeout 30s;</span><br><span class="line">        proxy_protocol on ;</span><br><span class="line">        proxy_pass mail_pop3s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    upstream mail_imap &#123;</span><br><span class="line">        server 192.168.188.88:143 ;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 143;</span><br><span class="line">        proxy_connect_timeout 10s;</span><br><span class="line">        proxy_timeout 30s;</span><br><span class="line">        proxy_protocol on ;</span><br><span class="line">        proxy_pass mail_imap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    upstream mail_imaps &#123;</span><br><span class="line">        server 192.168.188.88:993 ;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 993;</span><br><span class="line">        proxy_connect_timeout 10s;</span><br><span class="line">        proxy_timeout 30s;</span><br><span class="line">        proxy_protocol on ;</span><br><span class="line">        proxy_pass mail_imaps;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Haproxy解决方案"><a href="#Haproxy解决方案" class="headerlink" title="Haproxy解决方案"></a><strong>Haproxy解决方案</strong></h4><p><strong>1.开通tcp 模式 mode tcp 2.开启透传 send-proxy</strong> 注意：基本上haproxy参数需结合haproxy -c测试，一条条的来过才能确定最终哪个参数起作用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"># haproxy -v</span><br><span class="line">HA-Proxy version 1.5.18 2016/05/10</span><br><span class="line">Copyright 2000-2016 Willy Tarreau &lt;willy@haproxy.org&gt;</span><br><span class="line"></span><br><span class="line"># cat /etc/haproxy/haproxy.cf</span><br><span class="line">listen stats</span><br><span class="line"> mode http</span><br><span class="line"> bind 0.0.0.0:9999</span><br><span class="line"> stats enable</span><br><span class="line"> log global</span><br><span class="line"> stats uri     /haproxy-status</span><br><span class="line"> stats auth    haadmin:yourpassword</span><br><span class="line"></span><br><span class="line">listen WEB</span><br><span class="line">    bind 80</span><br><span class="line">    mode http</span><br><span class="line">    server web01 192.168.188.88:80  check </span><br><span class="line"></span><br><span class="line">listen WEBSSL</span><br><span class="line">    bind 443</span><br><span class="line">    mode tcp</span><br><span class="line">    server webssl01 192.168.188.88:443  check </span><br><span class="line"></span><br><span class="line">listen MAIL</span><br><span class="line">    bind 25</span><br><span class="line">    mode tcp</span><br><span class="line">    server mail01 192.168.188.88:25  check send-proxy</span><br><span class="line"></span><br><span class="line">listen MAILS</span><br><span class="line">    bind 465</span><br><span class="line">    mode tcp</span><br><span class="line">    server mailssl01 192.168.188.88:465  check send-proxy</span><br><span class="line"></span><br><span class="line">listen POP3</span><br><span class="line">    bind 110</span><br><span class="line">    mode tcp</span><br><span class="line">    server pop301 192.168.188.88:110  check send-proxy</span><br><span class="line"></span><br><span class="line">listen POP3S</span><br><span class="line">    bind 995 </span><br><span class="line">    mode tcp</span><br><span class="line">    server pop3ssl01 192.168.188.88:995  check send-proxy</span><br><span class="line"></span><br><span class="line">listen IMAP</span><br><span class="line">    bind 143</span><br><span class="line">    mode tcp</span><br><span class="line">    server imap01 192.168.188.88:143  check send-proxy</span><br><span class="line"></span><br><span class="line">listen IMAPS</span><br><span class="line">    bind 993</span><br><span class="line">    mode tcp</span><br><span class="line">    server imapssl01 192.168.188.88:993  check send-proxy</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="尾声"><a href="#尾声" class="headerlink" title="尾声"></a><strong>尾声</strong></h3><p>当然了，这只是自建邮件服务器其中一个小小的问题，基本上一步一个问题，所以现在自建邮箱越来越少了，基本上都被云邮箱取代了，就连Postfix 2012年的时候都停止更新维护了，估计再后来懂这门手艺的人会越来越少了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2021/01/08/2021/01/2021-01-08-docker%E5%85%B3%E9%94%AE%E7%9F%A5%E8%AF%86%E7%82%B9%E5%84%BF%E6%B1%87%E6%80%BB/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/08/2021/01/2021-01-08-docker%E5%85%B3%E9%94%AE%E7%9F%A5%E8%AF%86%E7%82%B9%E5%84%BF%E6%B1%87%E6%80%BB/index/" class="post-title-link" itemprop="url">Docker关键知识点儿汇总</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-01-08 08:00:00" itemprop="dateCreated datePublished" datetime="2021-01-08T08:00:00+08:00">2021-01-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:35" itemprop="dateModified" datetime="2023-05-26T15:06:35+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/cloud/" itemprop="url" rel="index"><span itemprop="name">cloud</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="容器"><a href="#容器" class="headerlink" title="容器"></a><strong>容器</strong></h3><p>容器&#x3D;cgroup+namespace+rootfs+容器引擎（用户态工具）</p>
<ul>
<li>Cgroup：资源控制。</li>
<li>Namespace：访问隔离。</li>
<li>rootfs：文件系统隔离。</li>
<li>容器引擎：生命周期控制。</li>
</ul>
<h3 id="容器两个核心技术"><a href="#容器两个核心技术" class="headerlink" title="容器两个核心技术"></a><strong>容器两个核心技术</strong></h3><p><strong>NameSpace</strong> Namespace又称为命名空间（也可翻译为名字空间），它是将内核的全局资源做封装，使得每个Namespace都有一份独立的资源，因此不同的进程在各自的Namespace内对同一种资源的使用不会互相干扰。</p>
<ul>
<li>IPC：隔离System V IPC和POSIX消息队列。</li>
<li>Network：隔离网络资源。</li>
<li>Mount：隔离文件系统挂载点。</li>
<li>PID：隔离进程ID。</li>
<li>UTS：隔离主机名和域名。</li>
<li>User：隔离用户ID和组ID。</li>
</ul>
<p><strong>Cgroup</strong> Cgroup是control group的简写，属于Linux内核提供的一个特性，用于限制和隔离一组进程对系统资源的使用，也就是做资源QoS，这些资源主要包括CPU、内存、block I&#x2F;O和网络带宽。</p>
<ul>
<li>devices：设备权限控制。</li>
<li>cpuset：分配指定的CPU和内存节点。</li>
<li>cpu：控制CPU占用率。</li>
<li>cpuacct：统计CPU使用情况。</li>
<li>memory：限制内存的使用上限。</li>
<li>freezer：冻结（暂停）Cgroup中的进程。</li>
<li>net_cls：配合tc（traffic controller）限制网络带宽。</li>
<li>net_prio：设置进程的网络流量优先级。</li>
<li>huge_tlb：限制HugeTLB的使用。</li>
<li>perf_event：允许Perf工具基于Cgroup分组做性能监测。</li>
</ul>
<h3 id="Docker五种网络模式"><a href="#Docker五种网络模式" class="headerlink" title="Docker五种网络模式"></a><strong>Docker五种网络模式</strong></h3><p><strong>None</strong> 不为容器配置任何网络功能。</p>
<p><strong>Container</strong> 与另一个运行中的容器共享NetworkNamespace，共享相同的网络视图。</p>
<p><strong>Host</strong> 与主机共享Root Network Namespace，容器有完整的权限可以操纵主机的协议栈、路由表和防火墙等，所以被认为是不安全的。</p>
<p><strong>Bridge</strong> Docker设计的NAT网络模型。 Docker网络的初始化动作包括：创建docker0网桥、为docker0网桥新建子网及路由、创建相应的iptables规则等。 <img src="/images/bridge.jpg"> 在桥接模式下，Docker容器与Internet的通信，以及不同容器之间的通信，都是通过iptables规则控制的。 <strong>Overlay</strong> Docker原生的跨主机多子网模型。 overlay网络模型比较复杂，底层需要类似consul或etcd的KV存储系统进行消息同步，核心是通过Linux网桥与vxlan隧道实现跨主机划分子网。 <img src="/images/overlay.jpg"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2020/12/13/2020/12/2020-12-13-site-reliability-engineering/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/13/2020/12/2020-12-13-site-reliability-engineering/index/" class="post-title-link" itemprop="url">SRE方法论</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-12-13 08:00:00" itemprop="dateCreated datePublished" datetime="2020-12-13T08:00:00+08:00">2020-12-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:34" itemprop="dateModified" datetime="2023-05-26T15:06:34+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/op/" itemprop="url" rel="index"><span itemprop="name">op</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="参考SRE-Google运维解密"><a href="#参考SRE-Google运维解密" class="headerlink" title="参考SRE:Google运维解密"></a><strong>参考SRE:Google运维解密</strong></h3><h3 id="贝特西-拜尔著-孙宇聪译"><a href="#贝特西-拜尔著-孙宇聪译" class="headerlink" title="贝特西 拜尔著 孙宇聪译"></a><strong>贝特西 拜尔著 孙宇聪译</strong></h3><p><strong>SRE职责</strong> 一般来说，SRE团队要承担以下几类职责：可用性改进，延迟优化，性能优化，效率优化，变更管理，监控，紧急事务处理以及容量规划与管理。</p>
<p><strong>运维工作50%内</strong> SRE团队的运维工作限制在50%以内，SRE团队应该将剩余时间花在研发项目上。</p>
<p><strong>On-call 准则</strong> SRE在每8～12小时的on-call 轮值期间最多只处理两个紧急事件。这个准则保证了on-call工程师有足够的时间跟进紧急事件，这样SRE可以正确地处理故障、恢复服务，并且要撰写一份事后报告。</p>
<p><strong>事后总结</strong> 事后总结应该包括以下内容：事故发生、发现、解决的全过程，事故的根本原因，预防或者优化的解决方案。</p>
<p><strong>监控系统</strong></p>
<ul>
<li><p>紧急警报（alert）</p>
</li>
<li><p>工单（ticket）</p>
</li>
<li><p>日志（logging）</p>
</li>
</ul>
<p><strong>应急事件处理</strong> 可靠性是MTTF（平均失败时间）和MTTR（平均恢复时间）的函数。评价一个团队将系统恢复到正常情况的最有效指标，就是MTTR。 任何需要人工操作的事情都只会延长恢复时间。一个可以自动恢复的系统即使有更多的故障发生，也要比事事都需要人工干预的系统可用性更高。</p>
<p><strong>变更管理</strong> SRE的经验告诉我们，大概 70% 的生产事故由某种部署的变更而触发。变更管理的最佳实践是使用自动化来完成以下几个项目：</p>
<ul>
<li><p>采用渐进式发布机制。</p>
</li>
<li><p>迅速而准确地检测到问题的发生。</p>
</li>
<li><p>当出现问题时，安全迅速地回退改动。</p>
</li>
</ul>
<p>这三点可以有效地降低变更给SRE和最终用户带来的时间成本和服务质量的下降。</p>
<p><strong>容量规划</strong> 容量规划有几个步骤是必需的：</p>
<ul>
<li><p>必须有一个准确的自然增长需求预测模型，需求预测的时间应该超过资源获取的时间。</p>
</li>
<li><p>规划中必须有准确的非自然增长的需求来源的统计。</p>
</li>
<li><p>必须有周期性压力测试，以便准确地将系统原始资源信息与业务容量对应起来。</p>
</li>
</ul>
<p><strong>资源部署</strong> 资源的部署（provisinging）是变更管理与容量规划的结合物。在我们的经验里，资源的部署和配置必须能够非常迅速地完成，而且仅仅是在必要的时候才执行，因为资源通常是非常昂贵的。而且这个部署和配置的过程必须要确保能够正确地执行完毕，否则资源就仍然处于不可用状态。</p>
<p><strong>效率与性能</strong> 高效地利用各种资源是任何赢利性服务都要关心的。因为SRE最终负责容量的部署和配置，因此SRE也必须承担起任何有关利用率的讨论及改进。因为一个服务的利用率指标通常依赖于这个服务的工作方式以及对容量的配置与部署上。如果能够通过密切关注一个服务的容量配置策略，进而改进其资源利用率，这可以非常有效地降低系统的总成本。 一个业务总体资源的使用情况是由以下几个因素驱动的：用户需求（流量）、可用容量和软件的资源使用效率。SRE 可以通过模型预测用户需求，合理部署和配置可用容量，同时可以改进软件以提升资源使用效率。通过这三个因素能够大幅度推动一个服务的效率提升（但是并非全部）。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2020/12/01/2020/12/2020-12-01-mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9F%A5%E8%AF%86%E7%82%B9%E6%B1%87%E6%80%BB/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/01/2020/12/2020-12-01-mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9F%A5%E8%AF%86%E7%82%B9%E6%B1%87%E6%80%BB/index/" class="post-title-link" itemprop="url">MySQL数据库知识点汇总</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-12-01 08:00:00" itemprop="dateCreated datePublished" datetime="2020-12-01T08:00:00+08:00">2020-12-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:34" itemprop="dateModified" datetime="2023-05-26T15:06:34+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bigdata/" itemprop="url" rel="index"><span itemprop="name">bigdata</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>innodb_buffer_pool_size</strong> 在MySQL 5.6&#x2F;MariaDB 10.1版本里，调整innodb_buffer_pool_size大小必须重启mysql进程才可以生效，而在MySQL 5.7版本里，可以直接动态设置，MySQL的InnoDB引擎中的innodb_buffer_pool_size参数可以设置为物理内存的70%～80%。</p>
<p><strong>max_connections</strong> 连接数是直接反应数据库性能好坏的关键指标，连接数过多，很可能有多种原因，比如，被一条SQL查询给堵死了，造成了后面的DML操作等待，又比如，增、删、改、查操作很频繁，磁盘I&#x2F;O遇到了瓶颈，导致无法处理繁忙的请求等。 max_connections在大多数情况下可以将其设置为500～1000，腾讯云默认3600。</p>
<p><strong>MySQL的锁</strong></p>
<ul>
<li><p>表级锁：开销小，加锁快；不会出现死锁；锁定粒度大，发生锁冲突的概率最高，并发度最低。MyISAM引擎属于这种类型。</p>
</li>
<li><p>行级锁：开销大，加锁慢；会出现死锁；锁定粒度最小，发生锁冲突的概率最低，并发度也最高。InnoDB引擎属于这种类型。</p>
</li>
<li><p>页面锁：开销和加锁时间界于表锁和行锁之间；会出现死锁；锁定粒度界于表锁和行锁之间，并发度一般。NDB属于这种类型。</p>
</li>
</ul>
<p><strong>行锁</strong> InnoDB存储引擎是通过给索引上的索引项加锁来实现的，这就意味着：只有通过索引条件检索数据，InnoDB才会使用行级锁，否则，InnoDB将使用表锁。 在并发访问比较高的情况下，如果大量事务因无法立即获得所需的锁而挂起，会占用大量计算机资源，造成严重的性能问题，甚至拖垮数据库，这时需要通过设置合适的锁等待超时阀值参数innodb_lock_wait_timeout来解决，一般设置为100秒即可，腾讯云默认60秒。</p>
<p><strong>InnoDB引擎与MyISAM引擎的性能对比</strong> MyISAM支持全文索引，这是一种基于分词创建的索引，支持一些比较复杂的查询，但不是事务安全的，而且不支持外键。每张MyISAM表存放在3个文件中：frm文件存放表格定义；数据文件是MYD （MYData）；索引文件是MYI（MYIndex）。对于MyISAM表，可以手工或者自动执行检查或修复操作，这一点要注意跟InnoDB的事物恢复区分开来。 InnoDB是事务型引擎，支持回滚，具有崩溃恢复能力，多版本并发控制（MVCC）、支持ACID事务、支持行级锁定（InnoDB表的行锁不是绝对的，如果执行一个SQL语句没有使用到索引，InnoDB表同样会锁全表）。 InnoDB的工作原理：就是把数据捞到内存中，被用户读写，这样大大增加了性能，因为从内存进行读写比磁盘要快得多。当数据全部加载到内存中，这时的性能是最好的。它的设计理论是充分利用内存，减少磁盘I&#x2F;O使用率。</p>
<p><strong>MyISAM和InnoDB之间的主要区别</strong></p>
<ul>
<li><p>MyISAM是非事务安全型的，而InnoDB是事务安全型的，也就是ACID事务支持；</p>
</li>
<li><p>MyISAM锁是表级锁，锁开销最小，而InnoDB支持行级锁定，锁管理开销大，支持更好的并发写操作；</p>
</li>
<li><p>MyISAM支持全文索引，而InnoDB不支持全文索引，但在最新的5.6版本中已提供支持；</p>
</li>
<li><p>MyISAM相对简单，管理方便，因此在效率上要优于InnoDB，小型应用可以考虑使用MyISAM；</p>
</li>
<li><p>MyISAM表是保存成文件的形式，在跨平台的数据转移中使用MyISAM存储会省去不少的麻烦；</p>
</li>
<li><p>InnoDB表比MyISAM表更安全，可以在保证数据不会丢失的情况下，切换非事务表到事务表。</p>
</li>
</ul>
<p><strong>SQL注意事项</strong></p>
<ul>
<li><p>在生产环境里，应尽量避免使用子查询，可用left join表连接取代之。</p>
</li>
<li><p>字段使用函数，将不能用到索引。</p>
</li>
<li><p>当取出的数据量超过表中数据的20%，优化器就不会使用索引，而是全表扫描。</p>
</li>
</ul>
<p><strong>备份方式</strong></p>
<ul>
<li><p>冷备份，此时数据库处于关闭状态，能够较好地保证数据库的完整性。</p>
</li>
<li><p>热备份，数据库正处于运行状态，这种备份方法依赖于数据库的日志文件。</p>
</li>
<li><p>逻辑备份，使用mysqldump命令从数据库中提取数据，并将结果写到一个文件上，文件内容为纯文本的SQL语句。</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2020/11/23/2020/11/2020-11-23-%E7%BD%91%E7%BB%9C%E6%80%BB%E6%97%B6%E5%BB%B6%E7%AE%97%E6%B3%95/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/23/2020/11/2020-11-23-%E7%BD%91%E7%BB%9C%E6%80%BB%E6%97%B6%E5%BB%B6%E7%AE%97%E6%B3%95/index/" class="post-title-link" itemprop="url">网络总时延算法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-11-23 08:00:00" itemprop="dateCreated datePublished" datetime="2020-11-23T08:00:00+08:00">2020-11-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:34" itemprop="dateModified" datetime="2023-05-26T15:06:34+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/op/" itemprop="url" rel="index"><span itemprop="name">op</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>网络总时延&#x3D;核心网传播时延+核心网转发时延+终端空口时延</strong> <strong>传播时延</strong>：1000千米来回10ms <strong>转发时延</strong>：每隔1个路由器增加1ms，可以根据TTL值算经过了多少路由器 <strong>空口时延</strong>：4G为10ms，5G为1ms，有线为1ms</p>
<p><strong>举个例子</strong> <code>例如500KM距离，经过8个路由器，4G和5G到中心云及用户间数据交互时延如下： 4G网络到云中心总延时为2.5ms+8ms+10ms=20.5ms； 5G网络到云中心总时延为2.5ms+8ms+1ms=11.5ms。 2个4G用户数据交互网络总延时为5ms+16ms+20ms=41ms； 2个5G用户数据交互网络总时延为5ms+16ms+2ms=23ms。</code></p>
<p><strong>PING测试</strong> 北京Ping广州延迟37ms，其中TTL50说明过了14个路由器，距离2200KM，所以网络总延时为：22ms+14ms+1ms&#x3D;37ms。验证算法完全准确。 <img src="/images/ping.png"> <strong>备注</strong>：4G&#x2F;5G客户端误差还是很大的，实际情况很难达到空口状态，4G终端时延误差可能得几十毫秒，5G终端时延误差可能达到十几毫秒。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2020/11/19/2020/11/2020-11-19-%E8%BF%90%E7%BB%B4%E6%98%AF%E6%8C%81%E4%B9%85%E6%88%98/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/19/2020/11/2020-11-19-%E8%BF%90%E7%BB%B4%E6%98%AF%E6%8C%81%E4%B9%85%E6%88%98/index/" class="post-title-link" itemprop="url">运维是持久战</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-11-19 08:00:00" itemprop="dateCreated datePublished" datetime="2020-11-19T08:00:00+08:00">2020-11-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:34" itemprop="dateModified" datetime="2023-05-26T15:06:34+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/op/" itemprop="url" rel="index"><span itemprop="name">op</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>摘自谢朝阳《5G边缘云计算 规划 实施 运维》</strong> <strong>运维是持久战</strong> <code>“三分建设，七分运维”，运维是持久战。</code> <strong>运维的终极目标</strong> <code>好的运维是多要素的融合，包括规范的流程和技术。因此，达到智能化的可靠性（Reliability）、可用性（Availability）、安全性（Security）、可扩展性（Scalability）、易管性（Manageability-Intelligence）—简称RASSM-I—是运维的终极目标（Nirvana）。</code> <strong>运维需要具备的能力</strong></p>
<ul>
<li><p><strong>产品研发能力</strong> <code>由于云计算产品所面对的数据量、计算量极其庞大，需要能快速迭代、收敛问题。这就要求运维人员能通过自身对底层和开发的了解，以及对生产状况的掌控，配合开发团队进行快速迭代部署、发布和Debug 等，从而提升开发人员对工程素质的重视，更好地保证云集群的稳定。更理想的情况是，运维人员不仅对开发流程有深刻的了解，并且在需要的时候，自己也能上阵改进代码。尤其对于快速迭代的互联网企业，部署应用的人必须能够与产品技术团队紧密配合。</code></p>
</li>
<li><p><strong>知识面广泛</strong> <code>我的业务是否需要用NoSQL？ Cassandra 和MongoDB 哪个更适合我？ HDFS、S3对象存储、数据库云，各有什么特点？ CDN 服务选哪家？ 是否需要使用固态硬盘（SSD）？ 缓存需要多少？ 文件系统选哪种？ 操作系统选哪种？ Web 服务器选哪种？ 各种存储方式的特点是什么？ 各种虚拟化系统的特点是什么？ 开展新业务的时候，我如何为未来的横向扩展做好准备？ 现在用OpenStack 可能会遇到哪些问题？ Hadoop 这个东西究竟适不适合我？ MySQL 引擎选哪种？ 搜索引擎选哪种？ 等等。 身为运维人员，需要有比较广泛的知识面。尤其在可以选择的选项越来越多的时候，只有能够进行分辨并给出高质量建议的人，才有更高的价值。企业的CTO、项目经理本身可能专精于某个领域，容易忽略以上这些问题。因而一个思虑周全的运维人员将减少很多潜在的技术成本。</code></p>
</li>
<li><p><strong>业务和数据分析能力</strong> <code>运维人员要学习统计学，读懂数据，了解业务需求，考虑成本控制，甚至考虑商业变现方面的问题。企业雇用每个员工都是为了创造价值。只有贴近企业的核心价值，才能够成为企业中被重视的人。例如，淘宝网“双十一”活动，其核心运维、应用运维团队一定是整个活动团队当中的核心决策者之一。运维人员作为最先接触到用户数据的人群，如果能利用这一优势为企业带来更直接的价值，运维就不会总被当作“浪费钱的替罪羊”了。多跟产品、业务人员、商务经理聊聊，运维人员就会更清楚自己的价值在哪里。</code></p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2020/10/30/2020/10/2020-10-30-nginx-104-connection-reset-by-peer-while-reading-upstream%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/30/2020/10/2020-10-30-nginx-104-connection-reset-by-peer-while-reading-upstream%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/index/" class="post-title-link" itemprop="url">nginx 104 Connection reset by peer while reading upstream错误处理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-30 08:00:00" itemprop="dateCreated datePublished" datetime="2020-10-30T08:00:00+08:00">2020-10-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:34" itemprop="dateModified" datetime="2023-05-26T15:06:34+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/middleware/" itemprop="url" rel="index"><span itemprop="name">middleware</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="故障现象"><a href="#故障现象" class="headerlink" title="故障现象"></a><strong>故障现象</strong></h3><p>1.看日志发现正常日志和错误日志比例几乎1：1 2.错误日志全部是104: Connection reset by peer) while reading upstream 3.看访问日志也没有其他http错误状态码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_0_22_centos logs]# ls -lh</span><br><span class="line">total 389M</span><br><span class="line">-rw-r--r-- 1 work work 191M Oct 30 17:30 ttt.minminmsn.com_access.log</span><br><span class="line">-rw-r--r-- 1 work work 199M Oct 30 17:30 ttt.minminmsn.com_error.log</span><br><span class="line">[root@VM_0_22_centos logs]# tail -n 1  ttt.minminmsn.com_error.log</span><br><span class="line">2020/10/30 17:30:27 [error] 14063#0: *807476828 readv() failed (104: Connection reset by peer) while reading upstream, client: 117.61.242.104, server: ttt.minminmsn.com, request: &quot;POST /yycp-launcherSnapshot/launcherSnapshot/querySnapshotSync HTTP/1.1&quot;, upstream: &quot;http://192.168.8831:8081/ttt&quot;, host: &quot;ttt.minminmsn.com&quot;</span><br><span class="line">[root@VM_0_22_centos logs]# cat ttt.minminmsn.com_access.log |awk &#x27;&#123;print $9&#125;&#x27;|sort |uniq -dc</span><br><span class="line">1081274 200</span><br><span class="line">      6 304</span><br><span class="line">    125 400</span><br><span class="line">  27482 404</span><br><span class="line">    145 429</span><br><span class="line">    106 499</span><br><span class="line">      8 500</span><br></pre></td></tr></table></figure>

<h3 id="分析问题"><a href="#分析问题" class="headerlink" title="分析问题"></a><strong>分析问题</strong></h3><p>1.连续责任人咨询业务场景发现客户端请求基本上都是POST请求，开始以为是上传大文件连接超时了，后来开发确认为了安全使用POST请求，所以并没有大文件上传 2.由于upstream重置连接了，就是说后端主动断开了连接，然后发现连接里有很多TIME-WAIT，应该是qps比较大的情况下，连接处理比较快还在断开连接中就显得比较多了 3.nginx作为反向代理既然是客户端又是服务端，当和后端服务建立连接时并没有默认开启长连接，开启长连接后性能应该会提升很多 4.默认开启长连接不需要keeplive参数，如下是nginx官网查寻的keepalive参数，看的不是很明白，不过有个链接讲的很清楚，他可以激活连接缓存，应该属于长连接性能优化类 5.keepalive参数值应该与qps有关，默认不需要设置太大，如果访问日志里面有5XX错误还得根据实际情况调整，以达到最优效果</p>
<p>下面是官网keeplaive参数解释 Syntax: keepalive connections; Default: — Context: upstream This directive appeared in version 1.1.4.</p>
<p>Activates the cache for connections to upstream servers.</p>
<p>The connections parameter sets the maximum number of idle keepalive connections to upstream servers that are preserved in the cache of each worker process. When this number is exceeded, the least recently used connections are closed.</p>
<p>It should be particularly noted that the keepalive directive does not limit the total number of connections to upstream servers that an nginx worker process can open. The connections parameter should be set to a number small enough to let upstream servers process new incoming connections as well. When using load balancing methods other than the default round-robin method, it is necessary to activate them before the keepalive directive.</p>
<h3 id="处理方案"><a href="#处理方案" class="headerlink" title="处理方案"></a><strong>处理方案</strong></h3><p>1.修改nginx配置开启长连接及结合连接缓存 2.重启nginx服务 主要配置如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">upstream gateway&#123;</span><br><span class="line">    server 192.168.88.31:8081;</span><br><span class="line">    server 192.168.88.44:8081;</span><br><span class="line">    server 192.168.88.115:8081;</span><br><span class="line">    server 192.168.88.80:8081;</span><br><span class="line">    #以下是新增配置</span><br><span class="line">    keepalive 100;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">location / &#123;</span><br><span class="line">   proxy_pass http://gateway;</span><br><span class="line">   proxy_set_header   Host             $host;</span><br><span class="line">   proxy_set_header   X-Real-IP        $remote_addr;</span><br><span class="line">   proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;</span><br><span class="line">   #以下是新增配置</span><br><span class="line">   proxy_connect_timeout      120;   </span><br><span class="line">   proxy_send_timeout         300;    </span><br><span class="line">   proxy_read_timeout         300; </span><br><span class="line">   proxy_http_version 1.1;    </span><br><span class="line">   proxy_set_header Connection &quot;&quot;; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="检查效果"><a href="#检查效果" class="headerlink" title="检查效果"></a><strong>检查效果</strong></h3><p>1.查看错误日志 错误日志清空后没有增长过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_0_22_centos logs]# ls -lh</span><br><span class="line">total 389M</span><br><span class="line">-rw-r--r-- 1 work work 389M Oct 30 18:50 ttt.minminmsn.com_access.log</span><br><span class="line">-rw-r--r-- 1 work work  446 Oct 30 18:10 ttt.minminmsn.com_error.log</span><br></pre></td></tr></table></figure>

<p>2.查看连接数状态 长连接前TIME-WAIT比较多</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_0_22_centos logs]# ss -an |awk &#x27;&#123;print $2&#125;&#x27;|sort |uniq -dc |sort -rn</span><br><span class="line">   5045 TIME-WAIT</span><br><span class="line">    156 ESTAB</span><br><span class="line">     62 UNCONN</span><br><span class="line">     21 LISTE</span><br></pre></td></tr></table></figure>

<p>长连接后TSTAB比较多</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_0_22_centos ~]# ss -an |awk &#x27;&#123;print $2&#125;&#x27;|sort |uniq -dc |sort -rn</span><br><span class="line">    511 ESTAB</span><br><span class="line">     62 UNCONN</span><br><span class="line">     52 TIME-WAIT</span><br><span class="line">     21 LISTEN</span><br></pre></td></tr></table></figure>

<h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a><strong>参考文档</strong></h3><p><a target="_blank" rel="noopener" href="http://nginx.org/en/docs/http/ngx/_http/_upstream/_module.html#keepalive">http://nginx.org/en/docs/http/ngx\_http\_upstream\_module.html#keepalive</a> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/sunsky303/p/10648861.html">https://www.cnblogs.com/sunsky303/p/10648861.html</a> <a target="_blank" rel="noopener" href="http://blog.51yip.com/apachenginx/2203.html">http://blog.51yip.com/apachenginx/2203.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Jerry Min</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">260</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">34</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">61</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jerry Min</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
