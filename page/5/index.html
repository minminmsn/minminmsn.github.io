<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"minminmsn.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="MinMinMsn">
<meta property="og:url" content="https://minminmsn.github.io/page/5/index.html">
<meta property="og:site_name" content="MinMinMsn">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Jerry Min">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://minminmsn.github.io/page/5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>MinMinMsn</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">MinMinMsn</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2020/09/27/2020/09/2020-09-27-%E4%BD%BF%E7%94%A8elasticsearch-dump%E8%BF%81%E7%A7%BBelasticsearch%E9%9B%86%E7%BE%A4%E6%95%B0%E6%8D%AE/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/27/2020/09/2020-09-27-%E4%BD%BF%E7%94%A8elasticsearch-dump%E8%BF%81%E7%A7%BBelasticsearch%E9%9B%86%E7%BE%A4%E6%95%B0%E6%8D%AE/index/" class="post-title-link" itemprop="url">使用elasticsearch-dump迁移elasticsearch集群数据</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-27 08:00:00" itemprop="dateCreated datePublished" datetime="2020-09-27T08:00:00+08:00">2020-09-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:34" itemprop="dateModified" datetime="2023-05-26T15:06:34+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bigdata/" itemprop="url" rel="index"><span itemprop="name">bigdata</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="缘起"><a href="#缘起" class="headerlink" title="缘起"></a><strong>缘起</strong></h3><p>最近某个5节点es集群发现其中1个主节点（被选中master）cpu负载很高，其中3节点master角色，所有节点默认data角色，初步操作重启这个主节点，使其角色变更减少压力，发现不起作用。 后来使用Cerebro分析发现其中有个geo_infomation信息索引只有一个分片，且大小超过20G，默认单分片在SSD盘中大小最好不超过20G，HDD盘中大小最好不超过10G时性能最佳，这里分片不均衡导致集群压力分配不均。 所以现在需要改变geo_information的索引分片信息，由于不可变更已经生成索引的分片信息，所以只能新建一个索引（默认5分片），然后迁移索引mapping和data数据，这里使用elasticsearch-dump实现。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-88-87-centos bin]# curl 192.168.88.87:9200/_cat/nodes</span><br><span class="line">192.168.88.39  27 88  4  0.33  0.30  0.26 dim - es-39</span><br><span class="line">192.168.88.135 72 99 99 18.33 18.52 18.45 di  - es-135</span><br><span class="line">192.168.88.40  32 99 98 21.67 21.03 20.73 dim - es-40</span><br><span class="line">192.168.88.33  49 94  3  0.41  0.34  0.27 dim * es-33</span><br><span class="line">192.168.88.87  35 95  0  0.01  0.04  0.08 di  - es-87</span><br></pre></td></tr></table></figure>

<h3 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a><strong>操作步骤</strong></h3><p><strong>1、安装node环境</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-88-87-centos ~]# wget https://cdn.npm.taobao.org/dist/node/v14.12.0/node-v14.12.0-linux-x64.tar.xz</span><br><span class="line">[root@VM-88-87-centos ~]# xz -d node-v14.12.0-linux-x64.tar.xz </span><br><span class="line">[root@VM-88-87-centos ~]# tar -xvf node-v14.12.0-linux-x64.tar -C /usr/local/</span><br><span class="line">[root@VM-88-87-centos ~]# cd /usr/local/</span><br><span class="line">[root@VM-88-87-centos local]# ln -s node-v14.12.0-linux-x64 node</span><br><span class="line">[root@VM-88-87-centos local]# vim /etc/profile</span><br><span class="line">export JAVA_HOME=/usr/local/jdk</span><br><span class="line">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/jre/lib/rt.jar:$&#123;JAVA_HOME&#125;/lib/dt.jar:$&#123;JAVA_HOME&#125;/lib/tools.jar</span><br><span class="line">export NODE_HOME=/usr/local/node</span><br><span class="line">export NODE_PATH=$NODE_HOME/lib/node_modules</span><br><span class="line">export PATH=$PATH:$&#123;JAVA_HOME&#125;/bin:$NODE_HOME/bin</span><br><span class="line">[root@VM-88-87-centos local]# source /etc/profile</span><br><span class="line">[root@VM-88-87-centos local]# node -v</span><br><span class="line">v14.12.0</span><br><span class="line">[root@VM-88-87-centos local]# npm -v</span><br><span class="line">6.14.8</span><br></pre></td></tr></table></figure>

<p><strong>2、安装elasticsearch-dump</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-88-87-centos ~]# wget https://codeload.github.com/elasticsearch-dump/elasticsearch-dump/tar.gz/v6.33.4</span><br><span class="line">[root@VM-88-87-centos ~]# tar zxvf v6.33.4</span><br><span class="line">[root@VM-88-87-centos ~]# cd elasticsearch-dump-6.33.4/</span><br><span class="line">[root@VM-88-87-centos elasticsearch-dump-6.33.4]# ls</span><br><span class="line">bin                             Dockerfile       LICENSE.txt   test</span><br><span class="line">docker-compose-test-helper.yml  elasticdump.jpg  node_modules  transforms</span><br><span class="line">docker-compose.yml              elasticdump.js   package.json</span><br><span class="line">docker-entrypoint.sh            lib              README.md</span><br><span class="line">[root@VM-88-87-centos elasticsearch-dump-6.33.4]# cd bin/</span><br></pre></td></tr></table></figure>

<p>依次安装依赖 p-queue delay ini s3urls lodash requestretry request lossless-json big.js aws4 aws-sdk async socks5-http-client socks5-https-client bytes JSONStream s3-stream-upload http-status</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-88-87-centos bin]# ./elasticdump --input=http://192.168.88.87:9200/geo_information --output=http://192.168.88.87:9200/geo_information_new --type=mapping</span><br><span class="line">internal/modules/cjs/loader.js:896</span><br><span class="line">  throw err;</span><br><span class="line">  ^</span><br><span class="line"></span><br><span class="line">Error: Cannot find module &#x27;p-queue&#x27;</span><br><span class="line">Require stack:</span><br><span class="line">- /root/elasticsearch-dump-6.33.4/lib/processor.js</span><br><span class="line">- /root/elasticsearch-dump-6.33.4/elasticdump.js</span><br><span class="line">- /root/elasticsearch-dump-6.33.4/bin/elasticdump</span><br><span class="line">    at Function.Module._resolveFilename (internal/modules/cjs/loader.js:893:15)</span><br><span class="line">    at Function.Module._load (internal/modules/cjs/loader.js:743:27)</span><br><span class="line">    at Module.require (internal/modules/cjs/loader.js:965:19)</span><br><span class="line">    at require (internal/modules/cjs/helpers.js:88:18)</span><br><span class="line">    at Object.&lt;anonymous&gt; (/root/elasticsearch-dump-6.33.4/lib/processor.js:2:29)</span><br><span class="line">    at Module._compile (internal/modules/cjs/loader.js:1076:30)</span><br><span class="line">    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1097:10)</span><br><span class="line">    at Module.load (internal/modules/cjs/loader.js:941:32)</span><br><span class="line">    at Function.Module._load (internal/modules/cjs/loader.js:782:14)</span><br><span class="line">    at Module.require (internal/modules/cjs/loader.js:965:19) &#123;</span><br><span class="line">  code: &#x27;MODULE_NOT_FOUND&#x27;,</span><br><span class="line">  requireStack: [</span><br><span class="line">    &#x27;/root/elasticsearch-dump-6.33.4/lib/processor.js&#x27;,</span><br><span class="line">    &#x27;/root/elasticsearch-dump-6.33.4/elasticdump.js&#x27;,</span><br><span class="line">    &#x27;/root/elasticsearch-dump-6.33.4/bin/elasticdump&#x27;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@VM-88-87-centos bin]# npm install p-queue</span><br><span class="line">npm notice created a lockfile as package-lock.json. You should commit this file.</span><br><span class="line">+ p-queue@6.6.1</span><br><span class="line">added 4 packages from 2 contributors and audited 5 packages in 5.154s</span><br><span class="line"></span><br><span class="line">1 package is looking for funding</span><br><span class="line">  run `npm fund` for details</span><br><span class="line"></span><br><span class="line">found 0 vulnerabilities</span><br></pre></td></tr></table></figure>

<p>最终npm模块依赖如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-88-87-centos bin]# npm list</span><br><span class="line">elasticdump@6.33.4 /root/elasticsearch-dump-6.33.4</span><br><span class="line">├─┬ async@2.6.3</span><br><span class="line">│ └── lodash@4.17.20 deduped</span><br><span class="line">├─┬ aws-sdk@2.761.0</span><br><span class="line">│ ├─┬ buffer@4.9.2</span><br><span class="line">│ │ ├── base64-js@1.3.1</span><br><span class="line">│ │ ├── ieee754@1.1.13 deduped</span><br><span class="line">│ │ └── isarray@1.0.0</span><br><span class="line">│ ├── events@1.1.1</span><br><span class="line">│ ├── ieee754@1.1.13</span><br><span class="line">│ ├── jmespath@0.15.0</span><br><span class="line">│ ├── querystring@0.2.0</span><br><span class="line">│ ├── sax@1.2.1</span><br><span class="line">│ ├─┬ url@0.10.3</span><br><span class="line">│ │ ├── punycode@1.3.2</span><br><span class="line">│ │ └── querystring@0.2.0 deduped</span><br><span class="line">│ ├── uuid@3.3.2</span><br><span class="line">│ └─┬ xml2js@0.4.19</span><br><span class="line">│   ├── sax@1.2.1 deduped</span><br><span class="line">│   └── xmlbuilder@9.0.7</span><br><span class="line">├── aws4@1.10.1</span><br><span class="line">├── big.js@5.2.2</span><br><span class="line">├── bytes@3.1.0</span><br><span class="line">├── delay@4.4.0</span><br><span class="line">├── http-status@1.4.2</span><br><span class="line">├── ini@1.3.5</span><br><span class="line">├─┬ JSONStream@1.3.5</span><br><span class="line">│ ├── jsonparse@1.3.1</span><br><span class="line">│ └── through@2.3.8</span><br><span class="line">├── lodash@4.17.20</span><br><span class="line">├── lossless-json@1.0.4</span><br><span class="line">├── minimist@1.2.5</span><br><span class="line">├─┬ p-queue@6.6.1</span><br><span class="line">│ ├── eventemitter3@4.0.7</span><br><span class="line">│ └─┬ p-timeout@3.2.0</span><br><span class="line">│   └── p-finally@1.0.0</span><br><span class="line">├─┬ request@2.88.2</span><br><span class="line">│ ├── aws-sign2@0.7.0</span><br><span class="line">│ ├── aws4@1.10.1</span><br><span class="line">│ ├── caseless@0.12.0</span><br><span class="line">│ ├─┬ combined-stream@1.0.8</span><br><span class="line">│ │ └── delayed-stream@1.0.0</span><br><span class="line">│ ├── extend@3.0.2</span><br><span class="line">│ ├── forever-agent@0.6.1</span><br><span class="line">│ ├─┬ form-data@2.3.3</span><br><span class="line">│ │ ├── asynckit@0.4.0</span><br><span class="line">│ │ ├── combined-stream@1.0.8 deduped</span><br><span class="line">│ │ └── mime-types@2.1.27 deduped</span><br><span class="line">│ ├─┬ har-validator@5.1.5</span><br><span class="line">│ │ ├─┬ ajv@6.12.5</span><br><span class="line">│ │ │ ├── fast-deep-equal@3.1.3</span><br><span class="line">│ │ │ ├── fast-json-stable-stringify@2.1.0</span><br><span class="line">│ │ │ ├── json-schema-traverse@0.4.1</span><br><span class="line">│ │ │ └─┬ uri-js@4.4.0</span><br><span class="line">│ │ │   └── punycode@2.1.1</span><br><span class="line">│ │ └── har-schema@2.0.0</span><br><span class="line">│ ├─┬ http-signature@1.2.0</span><br><span class="line">│ │ ├── assert-plus@1.0.0</span><br><span class="line">│ │ ├─┬ jsprim@1.4.1</span><br><span class="line">│ │ │ ├── assert-plus@1.0.0 deduped</span><br><span class="line">│ │ │ ├── extsprintf@1.3.0</span><br><span class="line">│ │ │ ├── json-schema@0.2.3</span><br><span class="line">│ │ │ └─┬ verror@1.10.0</span><br><span class="line">│ │ │   ├── assert-plus@1.0.0 deduped</span><br><span class="line">│ │ │   ├── core-util-is@1.0.2 deduped</span><br><span class="line">│ │ │   └── extsprintf@1.3.0 deduped</span><br><span class="line">│ │ └─┬ sshpk@1.16.1</span><br><span class="line">│ │   ├─┬ asn1@0.2.4</span><br><span class="line">│ │   │ └── safer-buffer@2.1.2 deduped</span><br><span class="line">│ │   ├── assert-plus@1.0.0 deduped</span><br><span class="line">│ │   ├─┬ bcrypt-pbkdf@1.0.2</span><br><span class="line">│ │   │ └── tweetnacl@0.14.5 deduped</span><br><span class="line">│ │   ├─┬ dashdash@1.14.1</span><br><span class="line">│ │   │ └── assert-plus@1.0.0 deduped</span><br><span class="line">│ │   ├─┬ ecc-jsbn@0.1.2</span><br><span class="line">│ │   │ ├── jsbn@0.1.1 deduped</span><br><span class="line">│ │   │ └── safer-buffer@2.1.2 deduped</span><br><span class="line">│ │   ├─┬ getpass@0.1.7</span><br><span class="line">│ │   │ └── assert-plus@1.0.0 deduped</span><br><span class="line">│ │   ├── jsbn@0.1.1</span><br><span class="line">│ │   ├── safer-buffer@2.1.2</span><br><span class="line">│ │   └── tweetnacl@0.14.5</span><br><span class="line">│ ├── is-typedarray@1.0.0</span><br><span class="line">│ ├── isstream@0.1.2</span><br><span class="line">│ ├── json-stringify-safe@5.0.1</span><br><span class="line">│ ├─┬ mime-types@2.1.27</span><br><span class="line">│ │ └── mime-db@1.44.0</span><br><span class="line">│ ├── oauth-sign@0.9.0</span><br><span class="line">│ ├── performance-now@2.1.0</span><br><span class="line">│ ├── qs@6.5.2</span><br><span class="line">│ ├── safe-buffer@5.2.1</span><br><span class="line">│ ├─┬ tough-cookie@2.5.0</span><br><span class="line">│ │ ├── psl@1.8.0</span><br><span class="line">│ │ └── punycode@2.1.1</span><br><span class="line">│ ├─┬ tunnel-agent@0.6.0</span><br><span class="line">│ │ └── safe-buffer@5.2.1 deduped</span><br><span class="line">│ └── uuid@3.3.2 deduped</span><br><span class="line">├─┬ requestretry@4.1.1</span><br><span class="line">│ ├── extend@3.0.2 deduped</span><br><span class="line">│ ├── lodash@4.17.20 deduped</span><br><span class="line">│ └── when@3.7.8</span><br><span class="line">├─┬ s3-stream-upload@2.0.2</span><br><span class="line">│ ├── buffer-queue@1.0.0</span><br><span class="line">│ └─┬ readable-stream@2.3.7</span><br><span class="line">│   ├── core-util-is@1.0.2</span><br><span class="line">│   ├── inherits@2.0.4</span><br><span class="line">│   ├── isarray@1.0.0 deduped</span><br><span class="line">│   ├── process-nextick-args@2.0.1</span><br><span class="line">│   ├── safe-buffer@5.1.2</span><br><span class="line">│   ├─┬ string_decoder@1.1.1</span><br><span class="line">│   │ └── safe-buffer@5.1.2</span><br><span class="line">│   └── util-deprecate@1.0.2</span><br><span class="line">├─┬ s3urls@1.5.2</span><br><span class="line">│ ├── minimist@1.2.5 deduped</span><br><span class="line">│ └─┬ s3signed@0.1.0</span><br><span class="line">│   └─┬ aws-sdk@2.761.0</span><br><span class="line">│     ├── buffer@4.9.2 deduped</span><br><span class="line">│     ├── events@1.1.1 deduped</span><br><span class="line">│     ├── ieee754@1.1.13 deduped</span><br><span class="line">│     ├── jmespath@0.15.0 deduped</span><br><span class="line">│     ├── querystring@0.2.0 deduped</span><br><span class="line">│     ├── sax@1.2.1 deduped</span><br><span class="line">│     ├── url@0.10.3 deduped</span><br><span class="line">│     ├── uuid@3.3.2 deduped</span><br><span class="line">│     └── xml2js@0.4.19 deduped</span><br><span class="line">├─┬ socks5-http-client@1.0.4</span><br><span class="line">│ └─┬ socks5-client@1.2.8</span><br><span class="line">│   └─┬ ip-address@6.1.0</span><br><span class="line">│     ├── jsbn@1.1.0</span><br><span class="line">│     ├── lodash@4.17.20 deduped</span><br><span class="line">│     └── sprintf-js@1.1.2</span><br><span class="line">└─┬ socks5-https-client@1.2.1</span><br><span class="line">  └── socks5-client@1.2.8 deduped</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>3、数据迁移</strong> 由于setting里面的index分片信息是不同的，所以新index默认创建即可，不需要迁移setting配置 mapping迁移</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-88-87-centos bin]# ./elasticdump --input=http://192.168.88.87:9200/geo_information --output=http://192.168.88.87:9200/geo_information_new --type=mapping</span><br><span class="line">Sun, 27 Sep 2020 02:45:24 GMT | starting dump</span><br><span class="line">Sun, 27 Sep 2020 02:45:24 GMT | got 1 objects from source elasticsearch (offset: 0)</span><br><span class="line">Sun, 27 Sep 2020 02:45:25 GMT | sent 1 objects to destination elasticsearch, wrote 1</span><br><span class="line">Sun, 27 Sep 2020 02:45:25 GMT | got 0 objects from source elasticsearch (offset: 1)</span><br><span class="line">Sun, 27 Sep 2020 02:45:25 GMT | Total Writes: 1</span><br><span class="line">Sun, 27 Sep 2020 02:45:25 GMT | dump complete</span><br></pre></td></tr></table></figure>

<p>data迁移 20G数据大概用了1小时</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-88-87-centos bin]#  ./elasticdump --input=http://192.168.88.87:9200/geo_information --output=http://192.168.88.87:9200/geo_information_new --limit 10000  --type=data</span><br><span class="line">Sun, 27 Sep 2020 06:19:22 GMT | starting dump</span><br><span class="line">Sun, 27 Sep 2020 06:19:22 GMT | got 10000 objects from source elasticsearch (offset: 0)</span><br><span class="line">Sun, 27 Sep 2020 06:19:24 GMT | sent 10000 objects to destination elasticsearch, wrote 10000</span><br><span class="line">Sun, 27 Sep 2020 06:19:25 GMT | got 10000 objects from source elasticsearch (offset: 10000)</span><br><span class="line">Sun, 27 Sep 2020 06:19:26 GMT | sent 10000 objects to destination elasticsearch, wrote 10000</span><br><span class="line">Sun, 27 Sep 2020 06:19:27 GMT | got 10000 objects from source elasticsearch (offset: 20000)</span><br><span class="line">Sun, 27 Sep 2020 06:19:28 GMT | sent 10000 objects to destination elasticsearch, wrote 10000</span><br><span class="line">Sun, 27 Sep 2020 06:19:28 GMT | got 10000 objects from source elasticsearch (offset: 30000)</span><br><span class="line">Sun, 27 Sep 2020 06:19:30 GMT | sent 10000 objects to destination elasticsearch, wrote 10000</span><br><span class="line">Sun, 27 Sep 2020 06:19:30 GMT | got 10000 objects from source elasticsearch (offset: 40000)</span><br><span class="line">Sun, 27 Sep 2020 06:19:32 GMT | sent 10000 objects to destination elasticsearch, wrote 10000</span><br><span class="line">Sun, 27 Sep 2020 06:19:32 GMT | got 10000 objects from source elasticsearch (offset: 50000)</span><br><span class="line">Sun, 27 Sep 2020 06:19:33 GMT | sent 10000 objects to destination elasticsearch, wrote 10000</span><br><span class="line">Sun, 27 Sep 2020 06:19:34 GMT | got 10000 objects from source elasticsearch (offset: 60000)</span><br><span class="line">Sun, 27 Sep 2020 06:19:35 GMT | sent 10000 objects to destination elasticsearch, wrote 10000</span><br><span class="line">Sun, 27 Sep 2020 06:19:36 GMT | got 10000 objects from source elasticsearch (offset: 70000)</span><br><span class="line">Sun, 27 Sep 2020 06:19:37 GMT | sent 10000 objects to destination elasticsearch, wrote 10000</span><br><span class="line">Sun, 27 Sep 2020 06:19:38 GMT | got 10000 objects from source elasticsearch (offset: 80000)</span><br><span class="line">Sun, 27 Sep 2020 06:19:39 GMT | sent 10000 objects to destination elasticsearch, wrote 10000</span><br><span class="line">.....</span><br><span class="line">Sun, 27 Sep 2020 07:21:47 GMT | sent 10000 objects to destination elasticsearch, wrote 10000</span><br><span class="line">Sun, 27 Sep 2020 07:21:48 GMT | got 10000 objects from source elasticsearch (offset: 19980000)</span><br><span class="line">Sun, 27 Sep 2020 07:21:49 GMT | sent 10000 objects to destination elasticsearch, wrote 10000</span><br><span class="line">Sun, 27 Sep 2020 07:21:50 GMT | got 6094 objects from source elasticsearch (offset: 19990000)</span><br><span class="line">Sun, 27 Sep 2020 07:21:50 GMT | sent 6094 objects to destination elasticsearch, wrote 6094</span><br><span class="line">Sun, 27 Sep 2020 07:21:50 GMT | got 0 objects from source elasticsearch (offset: 19996094)</span><br><span class="line">Sun, 27 Sep 2020 07:21:50 GMT | Total Writes: 19996094</span><br><span class="line">Sun, 27 Sep 2020 07:21:50 GMT | dump complete</span><br></pre></td></tr></table></figure>

<h3 id="后续"><a href="#后续" class="headerlink" title="后续"></a><strong>后续</strong></h3><p>es虽然支持横向扩容缩容及配置纵向扩减配，但是有些信息还是需要开始设计时安排合理，比如mapping、index分片、主节点信息、冷热、集群规模等。否则后续变更起来很麻烦。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2020/09/18/2020/09/2020-09-18-emoji%E8%A1%A8%E6%83%85%E5%8C%85%E5%AF%BC%E8%87%B4wiki%E6%97%A0%E6%B3%95%E4%BF%9D%E5%AD%98/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/18/2020/09/2020-09-18-emoji%E8%A1%A8%E6%83%85%E5%8C%85%E5%AF%BC%E8%87%B4wiki%E6%97%A0%E6%B3%95%E4%BF%9D%E5%AD%98/index/" class="post-title-link" itemprop="url">emoji表情包导致wiki无法保存</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-18 08:00:00" itemprop="dateCreated datePublished" datetime="2020-09-18T08:00:00+08:00">2020-09-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:34" itemprop="dateModified" datetime="2023-05-26T15:06:34+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/op/" itemprop="url" rel="index"><span itemprop="name">op</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="故障现象"><a href="#故障现象" class="headerlink" title="故障现象"></a><strong>故障现象</strong></h3><p>接到使用者反馈编辑后保存不了</p>
<p>对应的url为 <a target="_blank" rel="noopener" href="http://wiki.minminmsn.com/pages/viewpage.action?pageId=42319234">http://wiki.minminmsn.com/pages/viewpage.action?pageId=42319234</a></p>
<h3 id="处理过程"><a href="#处理过程" class="headerlink" title="处理过程"></a><strong>处理过程</strong></h3><p><strong>查看前端日志</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@wiki confluence]# grep &quot;viewpage.action?pageId=42319234&quot; access.log |grep -Ev &quot;200 &quot;|grep POST</span><br><span class="line">172.30.30.12 - - [18/Sep/2020:11:37:43 +0800] &quot;POST /rest/tinymce/1/drafts HTTP/1.1&quot; 500 4013 &quot;http://wiki.minminmsn.com/pages/viewpage.action?pageId=42319234&quot; &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.102 Safari/537.36&quot; &quot;-&quot;</span><br></pre></td></tr></table></figure>

<p><strong>查看后端日志</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@wiki logs]# grep 11:37:43 ./* |grep ERROR</span><br><span class="line">./atlassian-confluence.log.1:2020-09-18 11:37:43,004 ERROR [http-nio-8090-exec-262] [engine.jdbc.spi.SqlExceptionHelper] logExceptions Incorrect string value: &#x27;\xF0\x9F\x91\x86\xE6\x98...&#x27; for column &#x27;BODY&#x27; at row 1</span><br><span class="line">./atlassian-confluence.log.1:2020-09-18 11:37:43,005 ERROR [http-nio-8090-exec-262] [org.hibernate.internal.ExceptionMapperStandardImpl] mapManagedFlushFailure HHH000346: Error during managed flush [org.hibernate.exception.GenericJDBCException: could not execute statement]</span><br><span class="line">./atlassian-confluence.log.1:2020-09-18 11:37:43,009 ERROR [http-nio-8090-exec-262] [common.error.jersey.ThrowableExceptionMapper] toResponse Uncaught exception thrown by REST service: Hibernate operation: could not execute statement; uncategorized SQLException for SQL []; SQL state [HY000]; error code [1366]; Incorrect string value: &#x27;\xF0\x9F\x91\x86\xE6\x98...&#x27; for column &#x27;BODY&#x27; at row 1; nested exception is java.sql.SQLException: Incorrect string value: &#x27;\xF0\x9F\x91\x86\xE6\x98...&#x27; for column &#x27;BODY&#x27; at row 1</span><br></pre></td></tr></table></figure>

<h3 id="总结汇总"><a href="#总结汇总" class="headerlink" title="总结汇总"></a><strong>总结汇总</strong></h3><p><strong>收集问题相关信息</strong> 1.问题现象 2.出现时间 3.问题的url</p>
<p><strong>根据相关信息查日志</strong> 1.前端日志 2.后端日志</p>
<p><strong>根据报错日志推理结论</strong> 1.前端日志只有一个http 500错误，这个错误代表内部错误也就是说后端出现了问题，同时也比较笼统 2.后端日志反馈信息就比较明确了，sql插入数据时识别不了字符串（Incorrect string value），所有不执行sql语句（could not execute statement） 3.询问问题人员是否输入了特殊字符等，后来发现是因为emoji是4字节，触发了的utf8编码的问题导致的</p>
<p><strong>最后推理解决问题</strong> 1.先使用自带表情包 2.下次升级时修改数据默认字符集由UTF8编码改为为UTF8MB4（需要重启数据库生效）</p>
<h3 id="总结结论"><a href="#总结结论" class="headerlink" title="总结结论"></a><strong>总结结论</strong></h3><p>初步模糊判断可能为： 1.nginx反向代理读写超时等，导致连接失败 2.可能是长时间没有操作，用户退出，需要重新认证等 可见上面常用的思维和思路是错误的，虽然很多时候能帮助到我们，但是这次没有。看来遇到问题还是得看事实数据，特别是日志来根据实际情况去解决，因为大多时候现象与结论中间相差太远</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2020/09/18/2020/09/2020-09-18-%E4%BD%BF%E7%94%A8goaccess%E5%88%86%E6%9E%90nginx%E6%97%A5%E5%BF%97/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/18/2020/09/2020-09-18-%E4%BD%BF%E7%94%A8goaccess%E5%88%86%E6%9E%90nginx%E6%97%A5%E5%BF%97/index/" class="post-title-link" itemprop="url">使用goaccess分析nginx日志</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-18 08:00:00" itemprop="dateCreated datePublished" datetime="2020-09-18T08:00:00+08:00">2020-09-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:34" itemprop="dateModified" datetime="2023-05-26T15:06:34+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/middleware/" itemprop="url" rel="index"><span itemprop="name">middleware</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="GoAccess简介"><a href="#GoAccess简介" class="headerlink" title="GoAccess简介"></a><strong>GoAccess简介</strong></h3><p>GoAccess 是一款开源(MIT许可证)的且具有交互视图界面的实时 Web 日志分析工具，通过你的 Web 浏览器或者 *nix 系统下的终端程序即可访问。</p>
<p>能为系统管理员提供快速且有价值的 HTTP 统计，并以在线可视化服务器的方式呈现。 GoAccess 解析指定的 Web 日志文件并将统计结果输出到 X 终端。功能如下：</p>
<ul>
<li><strong>通用统计</strong>: 此面板展示了几个主要指标，比如：有效和无效请求的数量，分析这些数据所花费的时间，独立访客的情况，请求的文件，静态文件(CSS, ICO, JPG 等)的完整URL，404错误，被解析的日志文件的大小以及消耗的带宽。</li>
<li><strong>独立访客</strong>: 此面板按照日期展示了访问次数，独立访客数，以及累计消耗的带宽等指标。具有相同IP，相同访问时间，相同的 UserAgent 的 HTTP 请求将会被识别为独立访客。默认情况下包含了网络爬虫。 您也可以选择使用 –date-spec&#x3D;hr 参数将按照日期分析修改为按照小时，例如：05&#x2F;Jun&#x2F;2016:16 。这对于希望在小时级别去跟踪每日流量非常有帮助。</li>
<li><strong>请求的文件</strong>: 此面板展示您服务器上被请求次数最多的文件。包含访问次数，独立访客数，百分比，累计消耗带宽，使用的协议，请求方式。</li>
<li><strong>请求的静态文件</strong>: 列出请求频率最高的静态文件类型，例如： JPG, CSS, SWF, JS, GIF, 和 PNG , 以及和上一个面板一样的其他指标。 另外静态文件可以被添加到配置文件中。</li>
<li><strong>404 或者文件未找到</strong>: 展示内容与之前的面板类似，但是其数据包含了所有未找到的页面，以及俗称的 404 状态码。</li>
<li><strong>主机</strong>: 此面板展示主机自身的详细信息。能够很好的发现不怀好意的爬虫以及识别出是谁吃掉了你的带宽。 扩展面板将向您展示更多信息，比如主机的反向DNS解析结果，主机所在国家和城市。如果开启了 参数，选择想查看的 IP 地址并按回车，将会显示 UserAgent 列表。</li>
<li><strong>操作系统</strong>: 此面板将显示主机使用的操作系统的信息。GoAccess 将尽可能尝试为每一款操作系统提供详细的信息。</li>
<li><strong>浏览器</strong>: 此面板将显示来访主机使用的浏览器信息。GoAccess 将尽可能尝试为每一款浏览器提供详细的信息。</li>
<li><strong>访问次数</strong>: 此面板按小时报告。因此将显示24个数据点，每一个均对应每一天的某一个小时。 使用 –hour-spec&#x3D;min 参数可以设定为按每十分钟报告，并将以 16:4 的格式显示时间。这对发现服务器的峰值访问时段很有帮助。</li>
<li><strong>虚拟主机</strong>: 此面板将显示从访问日志中解析出来的不同的虚拟主机的情况。此面板仅在日志格式中启用了 %v 参数时显示。</li>
<li><strong>来路URL</strong>: 如果问题主机通过其他的资源访问了你的站点，以及通过从其他主机上的链接或者跳转到你的站点，则这些来路URL将会被显示在此面板。可以在配置文件中通过 <code>--ignore-panel</code> 开启此功能。(默认关闭)</li>
<li><strong>来路站点</strong>: 此面板将仅显示主机的部分，而不是完整的URL。</li>
<li><strong>关键字</strong>: 报告支持用在谷歌搜索，谷歌缓存，谷歌翻译上使用关键字。目前仅支持通过 HTTP 使用谷歌搜索。 可以在配置文件中通过 <code>--ignore-panel</code> 开启此功能。(默认关闭)</li>
<li><strong>地理位置</strong>: 根据 IP 地址判断地理位置。统计数据按照大洲和国家分组。需要地理位置模块的支持。</li>
<li><strong>HTTP 状态码</strong>: 以数字表示的 HTTP 请求的状态编码。</li>
<li>**远程用户(HTTP验证) **通过 HTTP 验证来确定访问文档的权限。如果文档没有被密码保护起来，这部分将会显示为 “-”。此面板默认为开启，除非在日志格式变量中设置了参数 %e 。</li>
</ul>
<h3 id="GoAccess使用"><a href="#GoAccess使用" class="headerlink" title="GoAccess使用"></a><strong>GoAccess使用</strong></h3><p><strong>安装goaccess</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_0_26_centos logs]# yum install goaccess</span><br><span class="line">Loaded plugins: fastestmirror, langpacks</span><br><span class="line">Repository epel is listed more than once in the configuration</span><br><span class="line">epel                                                                | 4.7 kB  00:00:00     </span><br><span class="line">extras                                                              | 2.9 kB  00:00:00     </span><br><span class="line">nux-dextop                                                          | 2.9 kB  00:00:00     </span><br><span class="line">os                                                                  | 3.6 kB  00:00:00     </span><br><span class="line">rpmfusion-free-updates                                              | 3.7 kB  00:00:00     </span><br><span class="line">rpmfusion-nonfree-updates                                           | 3.7 kB  00:00:00     </span><br><span class="line">updates                                                             | 2.9 kB  00:00:00     </span><br><span class="line">zabbix                                                              | 2.9 kB  00:00:00     </span><br><span class="line">zabbix-non-supported                                                |  951 B  00:00:00     </span><br><span class="line">(1/2): epel/7/x86_64/updateinfo                                     | 1.0 MB  00:00:00     </span><br><span class="line">(2/2): epel/7/x86_64/primary_db                                     | 6.9 MB  00:00:02     </span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * nux-dextop: mirror.li.nux.ro</span><br><span class="line"> * rpmfusion-free-updates: mirrors.ustc.edu.cn</span><br><span class="line"> * rpmfusion-nonfree-updates: mirrors.ustc.edu.cn</span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package goaccess.x86_64 0:1.3-1.el7 will be installed</span><br><span class="line">--&gt; Processing Dependency: libtokyocabinet.so.9()(64bit) for package: goaccess-1.3-1.el7.x86_64</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package tokyocabinet.x86_64 0:1.4.48-3.el7 will be installed</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">===========================================================================================</span><br><span class="line"> Package                 Arch              Version                   Repository       Size</span><br><span class="line">===========================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> goaccess                x86_64            1.3-1.el7                 epel            240 k</span><br><span class="line">Installing for dependencies:</span><br><span class="line"> tokyocabinet            x86_64            1.4.48-3.el7              os              459 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">===========================================================================================</span><br><span class="line">Install  1 Package (+1 Dependent package)</span><br><span class="line"></span><br><span class="line">Total download size: 699 k</span><br><span class="line">Installed size: 2.0 M</span><br><span class="line">Is this ok [y/d/N]: y</span><br><span class="line">Downloading packages:</span><br><span class="line">(1/2): goaccess-1.3-1.el7.x86_64.rpm                                | 240 kB  00:00:00     </span><br><span class="line">(2/2): tokyocabinet-1.4.48-3.el7.x86_64.rpm                         | 459 kB  00:00:00     </span><br><span class="line">-------------------------------------------------------------------------------------------</span><br><span class="line">Total                                                      1.3 MB/s | 699 kB  00:00:00     </span><br><span class="line">Running transaction check</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded</span><br><span class="line">Running transaction</span><br><span class="line">  Installing : tokyocabinet-1.4.48-3.el7.x86_64                                        1/2 </span><br><span class="line">  Installing : goaccess-1.3-1.el7.x86_64                                               2/2 </span><br><span class="line">  Verifying  : tokyocabinet-1.4.48-3.el7.x86_64                                        1/2 </span><br><span class="line">  Verifying  : goaccess-1.3-1.el7.x86_64                                               2/2 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  goaccess.x86_64 0:1.3-1.el7                                                              </span><br><span class="line"></span><br><span class="line">Dependency Installed:</span><br><span class="line">  tokyocabinet.x86_64 0:1.4.48-3.el7 </span><br></pre></td></tr></table></figure>

<p><strong>查看使用方式</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_0_26_centos logs]# goaccess -help</span><br><span class="line"></span><br><span class="line">GoAccess - 1.3</span><br><span class="line"></span><br><span class="line">Usage: goaccess [filename] [ options ... ] [-c][-M][-H][-S][-q][-d][...]</span><br><span class="line">The following options can also be supplied to the command:</span><br><span class="line"></span><br><span class="line">Log &amp; Date Format Options</span><br><span class="line"></span><br><span class="line">  --date-format=&lt;dateformat&gt;      - Specify log date format. e.g., %d/%b/%Y</span><br><span class="line">  --log-format=&lt;logformat&gt;        - Specify log format. Inner quotes need to be</span><br><span class="line">                                    escaped, or use single quotes.</span><br><span class="line">  --time-format=&lt;timeformat&gt;      - Specify log time format. e.g., %H:%M:%S</span><br><span class="line"></span><br><span class="line">User Interface Options</span><br><span class="line"></span><br><span class="line">  -c --config-dialog              - Prompt log/date/time configuration window.</span><br><span class="line">  -i --hl-header                  - Color highlight active panel.</span><br><span class="line">  -m --with-mouse                 - Enable mouse support on main dashboard.</span><br><span class="line">  --color=&lt;fg:bg[attrs, PANEL]&gt;   - Specify custom colors. See manpage for more</span><br><span class="line">                                    details and options.</span><br><span class="line">  --color-scheme=&lt;1|2|3&gt;          - Schemes: 1 =&gt; Grey, 2 =&gt; Green, 3 =&gt; Monokai.</span><br><span class="line">  --html-custom-css=&lt;path.css&gt;    - Specify a custom CSS file in the HTML report.</span><br><span class="line">  --html-custom-js=&lt;path.js&gt;      - Specify a custom JS file in the HTML report.</span><br><span class="line">  --html-prefs=&lt;json_obj&gt;         - Set default HTML report preferences.</span><br><span class="line">  --html-report-title=&lt;title&gt;     - Set HTML report page title and header.</span><br><span class="line">  --json-pretty-print             - Format JSON output w/ tabs &amp; newlines.</span><br><span class="line">  --max-items                     - Maximum number of items to show per panel.</span><br><span class="line">                                    See man page for limits.</span><br><span class="line">  --no-color                      - Disable colored output.</span><br><span class="line">  --no-column-names               - Don&#x27;t write column names in term output.</span><br><span class="line">  --no-csv-summary                - Disable summary metrics on the CSV output.</span><br><span class="line">  --no-html-last-updated          - Hide HTML last updated field.</span><br><span class="line">  --no-parsing-spinner            - Disable progress metrics and parsing spinner.</span><br><span class="line">  --no-progress                   - Disable progress metrics.</span><br><span class="line">  --no-tab-scroll                 - Disable scrolling through panels on TAB.</span><br><span class="line"></span><br><span class="line">Server Options</span><br><span class="line"></span><br><span class="line">  --addr=&lt;addr&gt;                   - Specify IP address to bind server to.</span><br><span class="line">  --daemonize                     - Run as daemon (if --real-time-html enabled).</span><br><span class="line">  --fifo-in=&lt;path&gt;                - Path to read named pipe (FIFO).</span><br><span class="line">  --fifo-out=&lt;path&gt;               - Path to write named pipe (FIFO).</span><br><span class="line">  --origin=&lt;addr&gt;                 - Ensure clients send the specified origin header</span><br><span class="line">                                    upon the WebSocket handshake.</span><br><span class="line">  --pid-file=&lt;path&gt;               - Write PID to a file when --daemonize is used.</span><br><span class="line">  --port=&lt;port&gt;                   - Specify the port to use.</span><br><span class="line">  --real-time-html                - Enable real-time HTML output.</span><br><span class="line">  --ssl-cert=&lt;cert.crt&gt;           - Path to TLS/SSL certificate.</span><br><span class="line">  --ssl-key=&lt;priv.key&gt;            - Path to TLS/SSL private key.</span><br><span class="line">  --ws-url=&lt;url&gt;                  - URL to which the WebSocket server responds.</span><br><span class="line"></span><br><span class="line">File Options</span><br><span class="line"></span><br><span class="line">  - - The log file to parse is read from stdin.</span><br><span class="line">  -f --log-file=&lt;filename&gt;        - Path to input log file.</span><br><span class="line">  -S --log-size=&lt;number&gt;          - Specify the log size, useful when piping in logs.</span><br><span class="line">  -l --debug-file=&lt;filename&gt;      - Send all debug messages to the specified</span><br><span class="line">                                    file.</span><br><span class="line">  -p --config-file=&lt;filename&gt;     - Custom configuration file.</span><br><span class="line">  --invalid-requests=&lt;filename&gt;   - Log invalid requests to the specified file.</span><br><span class="line">  --no-global-config              - Don&#x27;t load global configuration file.</span><br><span class="line"></span><br><span class="line">Parse Options</span><br><span class="line"></span><br><span class="line">  -a --agent-list                 - Enable a list of user-agents by host.</span><br><span class="line">  -b --browsers-file=&lt;path&gt;       - Use additional custom list of browsers.</span><br><span class="line">  -d --with-output-resolver       - Enable IP resolver on HTML|JSON output.</span><br><span class="line">  -e --exclude-ip=&lt;IP&gt;            - Exclude one or multiple IPv4/6. Allows IP</span><br><span class="line">                                    ranges e.g. 192.168.0.1-192.168.0.10</span><br><span class="line">  -H --http-protocol=&lt;yes|no&gt;     - Set/unset HTTP request protocol if found.</span><br><span class="line">  -M --http-method=&lt;yes|no&gt;       - Set/unset HTTP request method if found.</span><br><span class="line">  -o --output=file.html|json|csv  - Output either an HTML, JSON or a CSV file.</span><br><span class="line">  -q --no-query-string            - Ignore request&#x27;s query string. Removing the</span><br><span class="line">                                    query string can greatly decrease memory</span><br><span class="line">                                    consumption.</span><br><span class="line">  -r --no-term-resolver           - Disable IP resolver on terminal output.</span><br><span class="line">  --444-as-404                    - Treat non-standard status code 444 as 404.</span><br><span class="line">  --4xx-to-unique-count           - Add 4xx client errors to the unique visitors</span><br><span class="line">                                    count.</span><br><span class="line">  --anonymize-ip                  - Anonymize IP addresses before outputting to report.</span><br><span class="line">  --all-static-files              - Include static files with a query string.</span><br><span class="line">  --crawlers-only                 - Parse and display only crawlers.</span><br><span class="line">  --date-spec=&lt;date|hr&gt;           - Date specificity. Possible values: `date`</span><br><span class="line">                                    (default), or `hr`.</span><br><span class="line">  --double-decode                 - Decode double-encoded values.</span><br><span class="line">  --enable-panel=&lt;PANEL&gt;          - Enable parsing/displaying the given panel.</span><br><span class="line">  --hide-referer=&lt;NEEDLE&gt;         - Hide a referer but still count it. Wild cards</span><br><span class="line">                                    are allowed. i.e., *.bing.com</span><br><span class="line">  --hour-spec=&lt;hr|min&gt;            - Hour specificity. Possible values: `hr`</span><br><span class="line">                                    (default), or `min` (tenth of a min).</span><br><span class="line">  --ignore-crawlers               - Ignore crawlers.</span><br><span class="line">  --ignore-panel=&lt;PANEL&gt;          - Ignore parsing/displaying the given panel.</span><br><span class="line">  --ignore-referer=&lt;NEEDLE&gt;       - Ignore a referer from being counted. Wild cards</span><br><span class="line">                                    are allowed. i.e., *.bing.com</span><br><span class="line">  --ignore-statics=&lt;req|panel&gt;    - Ignore static requests.</span><br><span class="line">                                    req =&gt; Ignore from valid requests.</span><br><span class="line">                                    panel =&gt; Ignore from valid requests and panels.</span><br><span class="line">  --ignore-status=&lt;CODE&gt;          - Ignore parsing the given status code.</span><br><span class="line">  --num-tests=&lt;number&gt;            - Number of lines to test. &gt;= 0 (10 default)</span><br><span class="line">  --process-and-exit              - Parse log and exit without outputting data.</span><br><span class="line">  --real-os                       - Display real OS names. e.g, Windows XP, Snow</span><br><span class="line">                                    Leopard.</span><br><span class="line">  --sort-panel=PANEL,METRIC,ORDER - Sort panel on initial load. For example:</span><br><span class="line">                                    --sort-panel=VISITORS,BY_HITS,ASC. See</span><br><span class="line">                                    manpage for a list of panels/fields.</span><br><span class="line">  --static-file=&lt;extension&gt;       - Add static file extension. e.g.: .mp3.</span><br><span class="line">                                    Extensions are case sensitive.</span><br><span class="line"></span><br><span class="line">GeoIP Options</span><br><span class="line"></span><br><span class="line">  -g --std-geoip                  - Standard GeoIP database for less memory</span><br><span class="line">                                    consumption.</span><br><span class="line">  --geoip-database=&lt;path&gt;         - Specify path to GeoIP database file. i.e.,</span><br><span class="line">                                    GeoLiteCity.dat, GeoIPv6.dat ...</span><br><span class="line"></span><br><span class="line">Other Options</span><br><span class="line"></span><br><span class="line">  -h --help                       - This help.</span><br><span class="line">  -V --version                    - Display version information and exit.</span><br><span class="line">  -s --storage                    - Display current storage method. e.g., B+</span><br><span class="line">                                    Tree, Hash.</span><br><span class="line">  --dcf                           - Display the path of the default config</span><br><span class="line">                                    file when `-p` is not used.</span><br><span class="line"></span><br><span class="line">Examples can be found by running `man goaccess`.</span><br><span class="line"></span><br><span class="line">For more details visit: http://goaccess.io</span><br><span class="line">GoAccess Copyright (C) 2009-2017 by Gerardo Orellana</span><br></pre></td></tr></table></figure>

<p><strong>获取Nginx日志格式</strong> 格式转换脚本在<a target="_blank" rel="noopener" href="https://github.com/stockrt/nginx2goaccess/blob/master/nginx2goaccess.sh%EF%BC%8C%E5%85%B7%E4%BD%93%E5%86%85%E5%AE%B9%E5%A6%82%E4%B8%8B">https://github.com/stockrt/nginx2goaccess/blob/master/nginx2goaccess.sh，具体内容如下</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_0_26_centos logs]# cat nginx2goaccess.sh </span><br><span class="line">#!/bin/bash</span><br><span class="line">#</span><br><span class="line"># Convert from this:</span><br><span class="line">#   http://nginx.org/en/docs/http/ngx_http_log_module.html</span><br><span class="line"># To this:</span><br><span class="line">#   https://goaccess.io/man</span><br><span class="line">#</span><br><span class="line"># Conversion table:</span><br><span class="line">#   $time_local         %d:%t %^</span><br><span class="line">#   $host               %v</span><br><span class="line">#   $http_host          %v</span><br><span class="line">#   $remote_addr        %h</span><br><span class="line">#   $request_time       %T</span><br><span class="line">#   $request_method     %m</span><br><span class="line">#   $request_uri        %U</span><br><span class="line">#   $server_protocol    %H</span><br><span class="line">#   $request            %r</span><br><span class="line">#   $status             %s</span><br><span class="line">#   $body_bytes_sent    %b</span><br><span class="line">#   $bytes_sent         %b</span><br><span class="line">#   $http_referer       %R</span><br><span class="line">#   $http_user_agent    %u</span><br><span class="line">#</span><br><span class="line"># Samples:</span><br><span class="line">#</span><br><span class="line"># log_format combined &#x27;$remote_addr - $remote_user [$time_local] &#x27;</span><br><span class="line"># &#x27;&quot;$request&quot; $status $body_bytes_sent &#x27;</span><br><span class="line"># &#x27;&quot;$http_referer&quot; &quot;$http_user_agent&quot;&#x27;;</span><br><span class="line">#   ./nginx2goaccess.sh &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; $status $body_bytes_sent &quot;$http_referer&quot; &quot;$http_user_agent&quot;&#x27;</span><br><span class="line">#</span><br><span class="line"># log_format compression &#x27;$remote_addr - $remote_user [$time_local] &#x27;</span><br><span class="line"># &#x27;&quot;$request&quot; $status $bytes_sent &#x27;</span><br><span class="line"># &#x27;&quot;$http_referer&quot; &quot;$http_user_agent&quot; &quot;$gzip_ratio&quot;&#x27;;</span><br><span class="line">#   ./nginx2goaccess.sh &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; $status $bytes_sent &quot;$http_referer&quot; &quot;$http_user_agent&quot; &quot;$gzip_ratio&quot;&#x27;</span><br><span class="line">#</span><br><span class="line"># log_format main</span><br><span class="line"># &#x27;$remote_addr\t$time_local\t$host\t$request\t$http_referer\t$http_x_mobile_group\t&#x27;</span><br><span class="line"># &#x27;Local:\t$status\t$body_bytes_sent\t$request_time\t&#x27;</span><br><span class="line"># &#x27;Proxy:\t$upstream_cache_status\t$upstream_status\t$upstream_response_length\t$upstream_response_time\t&#x27;</span><br><span class="line"># &#x27;Agent:\t$http_user_agent\t&#x27;</span><br><span class="line"># &#x27;Fwd:\t$http_x_forwarded_for&#x27;;</span><br><span class="line">#   ./nginx2goaccess.sh &#x27;$remote_addr\t$time_local\t$host\t$request\t$http_referer\t$http_x_mobile_group\tLocal:\t$status\t$body_bytes_sent\t$request_time\tProxy:\t$upstream_cache_status\t$upstream_status\t$upstream_response_length\t$upstream_response_time\tAgent:\t$http_user_agent\tFwd:\t$http_x_forwarded_for&#x27;</span><br><span class="line">#</span><br><span class="line"># log_format main</span><br><span class="line"># &#x27;$&#123;time_local&#125;\t$&#123;remote_addr&#125;\t$&#123;host&#125;\t$&#123;request_method&#125;\t$&#123;request_uri&#125;\t$&#123;server_protocol&#125;\t&#x27;</span><br><span class="line"># &#x27;$&#123;http_referer&#125;\t$&#123;http_x_mobile_group&#125;\t&#x27;</span><br><span class="line"># &#x27;Local:\t$&#123;status&#125;\t*$&#123;connection&#125;\t$&#123;body_bytes_sent&#125;\t$&#123;request_time&#125;\t&#x27;</span><br><span class="line"># &#x27;Proxy:\t$&#123;upstream_status&#125;\t$&#123;upstream_cache_status&#125;\t&#x27;</span><br><span class="line"># &#x27;$&#123;upstream_response_length&#125;\t$&#123;upstream_response_time&#125;\t$&#123;uri&#125;$&#123;log_args&#125;\t&#x27;</span><br><span class="line"># &#x27;Agent:\t$&#123;http_user_agent&#125;\t&#x27;</span><br><span class="line"># &#x27;Fwd:\t$&#123;http_x_forwarded_for&#125;&#x27;;</span><br><span class="line">#   ./nginx2goaccess.sh &#x27;$&#123;time_local&#125;\t$&#123;remote_addr&#125;\t$&#123;host&#125;\t$&#123;request_method&#125;\t$&#123;request_uri&#125;\t$&#123;server_protocol&#125;\t$&#123;http_referer&#125;\t$&#123;http_x_mobile_group&#125;\tLocal:\t$&#123;status&#125;\t*$&#123;connection&#125;\t$&#123;body_bytes_sent&#125;\t$&#123;request_time&#125;\tProxy:\t$&#123;upstream_status&#125;\t$&#123;upstream_cache_status&#125;\t$&#123;upstream_response_length&#125;\t$&#123;upstream_response_time&#125;\t$&#123;uri&#125;$&#123;log_args&#125;\tAgent:\t$&#123;http_user_agent&#125;\tFwd:\t$&#123;http_x_forwarded_for&#125;&#x27;</span><br><span class="line">#</span><br><span class="line"># Author: Rogério Carvalho Schneider &lt;stockrt@gmail.com&gt;</span><br><span class="line"></span><br><span class="line"># Params</span><br><span class="line">log_format=&quot;$1&quot;</span><br><span class="line"></span><br><span class="line"># Usage</span><br><span class="line">if [[ -z &quot;$log_format&quot; ]]; then</span><br><span class="line">    echo &quot;Usage: $0 &#x27;&lt;log_format&gt;&#x27;&quot;</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># Variables map</span><br><span class="line">conversion_table=&quot;time_local,%d:%t_%^</span><br><span class="line">host,%v</span><br><span class="line">http_host,%v</span><br><span class="line">remote_addr,%h</span><br><span class="line">request_time,%T</span><br><span class="line">request_method,%m</span><br><span class="line">request_uri,%U</span><br><span class="line">server_protocol,%H</span><br><span class="line">request,%r</span><br><span class="line">status,%s</span><br><span class="line">body_bytes_sent,%b</span><br><span class="line">bytes_sent,%b</span><br><span class="line">http_referer,%R</span><br><span class="line">http_user_agent,%u&quot;</span><br><span class="line"></span><br><span class="line"># Conversion</span><br><span class="line">for item in $conversion_table; do</span><br><span class="line">    nginx_var=$&#123;item%%,*&#125;</span><br><span class="line">    goaccess_var=$&#123;item##*,&#125;</span><br><span class="line">    goaccess_var=$&#123;goaccess_var//_/ &#125;</span><br><span class="line">    log_format=$&#123;log_format//\$\&#123;$nginx_var\&#125;/$goaccess_var&#125;</span><br><span class="line">    log_format=$&#123;log_format//\$$nginx_var/$goaccess_var&#125;</span><br><span class="line">done</span><br><span class="line">log_format=$(echo &quot;$log_format&quot; | sed &#x27;s/$&#123;[a-z_]*&#125;/%^/g&#x27;)</span><br><span class="line">log_format=$(echo &quot;$log_format&quot; | sed &#x27;s/$[a-z_]*/%^/g&#x27;)</span><br><span class="line"></span><br><span class="line"># Config output</span><br><span class="line">echo &quot;</span><br><span class="line">- Generated goaccess config:</span><br><span class="line">time-format %T</span><br><span class="line">date-format %d/%b/%Y</span><br><span class="line">log_format $log_format</span><br><span class="line">&quot;</span><br><span class="line"></span><br><span class="line"># EOF</span><br></pre></td></tr></table></figure>

<p>注意，其中nginx配置文件的log_format如下，下面转换时需要与实际情况保持一致</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                  &#x27;$status $upstream_addr $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br></pre></td></tr></table></figure>

<p>获取日志格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_0_26_centos logs]# sh nginx2goaccess.sh &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; $status $upstream_addr $body_bytes_sent &quot;$http_referer&quot; &quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;</span><br><span class="line"></span><br><span class="line">- Generated goaccess config:</span><br><span class="line">time-format %T</span><br><span class="line">date-format %d/%b/%Y</span><br><span class="line">log_format %h - %^ [%d:%t %^] &quot;%r&quot; %s %^ %b &quot;%R&quot; &quot;%u&quot; &quot;%^&quot;</span><br></pre></td></tr></table></figure>

<p><strong>设置日志格式</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_0_26_centos logs]# cat /etc/goaccess/goaccess.conf </span><br><span class="line">time-format %T</span><br><span class="line">date-format %d/%b/%Y</span><br><span class="line">log_format %h - %^ [%d:%t %^] &quot;%r&quot; %s %^ %b &quot;%R&quot; &quot;%u&quot; &quot;%^&quot;</span><br></pre></td></tr></table></figure>

<p><strong>生成分析报告</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_0_26_centos logs]# goaccess -f ./nginx_access.log -p ./nginxlog.conf -o day-report.html</span><br><span class="line">[root@VM_0_26_centos logs]# ls</span><br><span class="line">day-report.html      nginx_access.log             nginx2goaccess.sh           nginxlog.conf</span><br></pre></td></tr></table></figure>

<p><strong>查看报告效果</strong> 浏览器打开day-report.html，效果如下 <img src="https://upload-images.jianshu.io/upload_images/7535971-1816cb6f1611eb07.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2020/09/15/2020/09/2020-09-15-%E8%BD%AF%E4%BB%B6%E4%BA%A4%E4%BB%98%E7%9A%84%E5%8E%9F%E5%88%99/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/15/2020/09/2020-09-15-%E8%BD%AF%E4%BB%B6%E4%BA%A4%E4%BB%98%E7%9A%84%E5%8E%9F%E5%88%99/index/" class="post-title-link" itemprop="url">软件交付的原则</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-15 08:00:00" itemprop="dateCreated datePublished" datetime="2020-09-15T08:00:00+08:00">2020-09-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:34" itemprop="dateModified" datetime="2023-05-26T15:06:34+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/op/" itemprop="url" rel="index"><span itemprop="name">op</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="摘自Jez-Humble-David-Farley《持续交付：发布可靠软件的系统方法》"><a href="#摘自Jez-Humble-David-Farley《持续交付：发布可靠软件的系统方法》" class="headerlink" title="摘自Jez Humble David Farley《持续交付：发布可靠软件的系统方法》"></a>摘自Jez Humble David Farley《持续交付：发布可靠软件的系统方法》</h3><p><strong>为软件的发布创建一个可重复且可靠的过程</strong></p>
<p>这个原则是我们写这本书的一个目标：让软件发布成为一件非常容易的事情。事实上，它的确应该是件很容易的事，因为在发布之前，对发布流程中的每一个环节，你都已经测试过数百次了。它就应该像单击一个按钮那么容易。这种可重复性和可靠性来自于以下两个原则：</p>
<ol>
<li>几乎将所有事情自动化；</li>
<li>将构建、部署、测试和发布软件所需的东西全部纳入到版本控制管理之中。</li>
</ol>
<p>归根结底，软件部署包括三件事：</p>
<ul>
<li>提供并管理你的软件所需要的运行环境，这包括硬件配置、所依赖的软件、基础设施以及所需的外部服务；</li>
<li>将你的应用程序的正确版本安装在其之上；</li>
<li>配置你的应用程序，包括它所需要的任何数据以及状态。</li>
</ul>
<p><strong>将几乎所有事情自动化</strong></p>
<p><strong>把所有的东西都纳入版本控制</strong></p>
<p><strong>提前并频繁地做让你感到痛苦的事</strong></p>
<p><strong>内建质量</strong></p>
<p><strong>“DONE”意味着“已发布”</strong></p>
<p><strong>交付过程是每个成员的责任</strong></p>
<p><strong>持续改进</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2020/09/08/2020/09/2020-09-08-rancher%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%90%8E%E9%9C%80%E8%A6%81%E5%81%9A%E7%9A%84%E5%87%A0%E4%BB%B6%E4%BA%8B/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/08/2020/09/2020-09-08-rancher%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E5%90%8E%E9%9C%80%E8%A6%81%E5%81%9A%E7%9A%84%E5%87%A0%E4%BB%B6%E4%BA%8B/index/" class="post-title-link" itemprop="url">Rancher集群部署后需要做的几件事</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-08 08:00:00" itemprop="dateCreated datePublished" datetime="2020-09-08T08:00:00+08:00">2020-09-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:34" itemprop="dateModified" datetime="2023-05-26T15:06:34+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/cloud/" itemprop="url" rel="index"><span itemprop="name">cloud</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>架构图</strong></p>
<blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/7535971-230d6eb34f02d5bc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
</blockquote>
<p><strong>总体流程</strong></p>
<ul>
<li>开发代码提交到Gitlab</li>
<li>Rahcher设置代码库为Gitlab</li>
<li>Rahcher流水线配置编译源码</li>
<li>Rahcher流水线Build Docker镜像</li>
<li>Rancher流水线Push Docker镜像到私有镜像库Harbor</li>
<li>Rancher流水线根据k8s yaml部署文件部署容器</li>
</ul>
<p><strong>重要步骤</strong></p>
<p><strong>1.添加LDAP认证</strong> 全局–安全–认证–编辑–启用OpenLDAP认证 设置仅允许授权的用户和组织，方便账号管理及安全使用</p>
<blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/7535971-6b4a4ed77c78c93e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
</blockquote>
<p><strong>2.添加通知</strong> Local–工具–通知 默认支持Slack、Mail、PagerDuty、Webhook、企业微信、钉钉、Microfoft Teams，这里选择邮件</p>
<blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/7535971-2741cc650d84097d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"> <img src="https://upload-images.jianshu.io/upload_images/7535971-846c1b773b9786c0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
</blockquote>
<p><strong>3.添加日志</strong> Local–工具–日志 有Elasticsearch、Splunk、Kafka、Syslog、Fluentd，这里使用的是Elasticsearch</p>
<blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/7535971-c6936d64e3afcf53.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"> <img src="https://upload-images.jianshu.io/upload_images/7535971-4c493bd1157b3417.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
</blockquote>
<p><strong>4.集成Gitlab</strong> Local–Defalt–工具–流水线 需要先在Gitlab对应项目账号中新建Application，然后在流水线中配置Gitlab应用，设置好id和secret后验证确认授权</p>
<blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/7535971-0034aa0b24ed5812.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"> <img src="https://upload-images.jianshu.io/upload_images/7535971-c9d0189bcdf86fe2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"> <img src="https://upload-images.jianshu.io/upload_images/7535971-5163c228931794c5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"> <img src="https://upload-images.jianshu.io/upload_images/7535971-00a80ee8e16d223b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
</blockquote>
<p><strong>5.配置镜像库凭证</strong> Local–Default–资源–密文–镜像库凭证列表–添加凭证</p>
<blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/7535971-44a6fe71d1ef52b2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"> <img src="https://upload-images.jianshu.io/upload_images/7535971-93f25e25f29484ce.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"> <img src="https://upload-images.jianshu.io/upload_images/7535971-5be1e241c8333a2e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
</blockquote>
<p><strong>6.配置流水线</strong> Local–Default–资源–流水线–设置代码库–启用项目–编辑流水线</p>
<blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/7535971-eb9f3043016ef83a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"> <img src="https://upload-images.jianshu.io/upload_images/7535971-ba1f46af4f7d774f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"> <img src="https://upload-images.jianshu.io/upload_images/7535971-2d2932e64a84c235.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"> <img src="https://upload-images.jianshu.io/upload_images/7535971-55da5aee3fc4d77e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
</blockquote>
<p>查看YAML如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">stages:</span><br><span class="line">- name: Build</span><br><span class="line">  steps:</span><br><span class="line">  - runScriptConfig:</span><br><span class="line">      image: core-harbor.minminmsn.com/public/centos-jdk8-maven</span><br><span class="line">      shellScript: bash ./build.sh</span><br><span class="line">- name: Publish</span><br><span class="line">  steps:</span><br><span class="line">  - publishImageConfig:</span><br><span class="line">      dockerfilePath: ./Dockerfile</span><br><span class="line">      buildContext: .</span><br><span class="line">      tag: core-harbor.minminmsn.com/public/$&#123;CICD_GIT_REPO_NAME&#125;:$&#123;CICD_GIT_COMMIT&#125;</span><br><span class="line">      pushRemote: true</span><br><span class="line">      registry: core-harbor.minminmsn.com</span><br><span class="line">- name: Deploy</span><br><span class="line">  steps:</span><br><span class="line">  - applyYamlConfig:</span><br><span class="line">      path: ./deployment.yaml</span><br><span class="line">notification:</span><br><span class="line">  recipients:</span><br><span class="line">  - recipient: op@minminmsn.com</span><br><span class="line">    notifier: local:n-chlz9</span><br><span class="line">  condition:</span><br><span class="line">  - Success</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>7.运行流水线</strong></p>
<blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/7535971-cffe463751b55870.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"> <img src="https://upload-images.jianshu.io/upload_images/7535971-3b7aa0f8620e3d52.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
</blockquote>
<p>部署成功可以发邮件</p>
<blockquote>
<p><img src="https://upload-images.jianshu.io/upload_images/7535971-b13b003f780e454d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2020/09/03/2020/09/2020-09-03-k8s%E9%9B%86%E7%BE%A4%E4%B8%8A%E4%BD%BF%E7%94%A8helm%E9%83%A8%E7%BD%B22-4-6%E7%89%88%E6%9C%ACrancher%E9%9B%86%E7%BE%A4/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/03/2020/09/2020-09-03-k8s%E9%9B%86%E7%BE%A4%E4%B8%8A%E4%BD%BF%E7%94%A8helm%E9%83%A8%E7%BD%B22-4-6%E7%89%88%E6%9C%ACrancher%E9%9B%86%E7%BE%A4/index/" class="post-title-link" itemprop="url">K8s集群上使用Helm部署2.4.6版本Rancher集群</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-03 08:00:00" itemprop="dateCreated datePublished" datetime="2020-09-03T08:00:00+08:00">2020-09-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:34" itemprop="dateModified" datetime="2023-05-26T15:06:34+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/cloud/" itemprop="url" rel="index"><span itemprop="name">cloud</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>参考文档</strong> <a target="_blank" rel="noopener" href="https://docs.rancher.cn/rancher2x/installation/helm-ha-install/online/tcp-l4/rancher-install.html#_1-%E6%B7%BB%E5%8A%A0chart%E4%BB%93%E5%BA%93%E5%9C%B0%E5%9D%80" title="Helm安装Rancher">Helm安装Rancher</a></p>
<p><strong>Rancher简介</strong> Rancher是一套容器管理平台，它可以帮助组织在生产环境中轻松快捷的部署和管理容器。 Rancher可以轻松地管理各种环境的Kubernetes，满足IT需求并为DevOps团队提供支持。 Kubernetes不仅已经成为的容器编排标准，它也正在迅速成为各类云和虚拟化厂商提供的标准基础架构。Rancher用户可以选择使用Rancher Kubernetes Engine(RKE)创建Kubernetes集群，也可以使用GKE，AKS和EKS等云Kubernetes服务。 Rancher用户还可以导入和管理现有的Kubernetes集群。 Rancher支持各类集中式身份验证系统来管理Kubernetes集群。例如，大型企业的员工可以使用其公司Active Directory凭证访问GKE中的Kubernetes集群。IT管​​理员可以在用户，组，项目，集群和云中设置访问控制和安全策略。 IT管​​理员可以在单个页面对所有Kubernetes集群的健康状况和容量进行监控。 Rancher为DevOps工程师提供了一个直观的用户界面来管理他们的服务容器，用户不需要深入了解Kubernetes概念就可以开始使用Rancher。 Rancher包含应用商店，支持一键式部署Helm和Compose模板。Rancher通过各种云、本地生态系统产品认证，其中包括安全工具，监控系统，容器仓库以及存储和网络驱动程序。下图说明了Rancher在IT和DevOps组织中扮演的角色。每个团队都会在他们选择的公共云或私有云上部署应用程序。</p>
<p><strong>集群环境</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch01 ~]# kubectl get nodes</span><br><span class="line">NAME        STATUS   ROLES    AGE    VERSION</span><br><span class="line">10.2.8.34   Ready    &lt;none&gt;   615d   v1.13.1</span><br><span class="line">10.2.8.65   Ready    &lt;none&gt;   615d   v1.13.1</span><br></pre></td></tr></table></figure>

<p><strong>Helm环境</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch01 yaml]# helm version</span><br><span class="line">Client: &amp;version.Version&#123;SemVer:&quot;v2.12.3&quot;, GitCommit:&quot;eecf22f77df5f65c823aacd2dbd30ae6c65f186e&quot;, GitTreeState:&quot;clean&quot;&#125;</span><br><span class="line">Server: &amp;version.Version&#123;SemVer:&quot;v2.12.3&quot;, GitCommit:&quot;eecf22f77df5f65c823aacd2dbd30ae6c65f186e&quot;, GitTreeState:&quot;clean&quot;&#125;</span><br></pre></td></tr></table></figure>

<p><strong>添加Chart仓库地址</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch01 yaml]# helm repo add rancher-stable https://releases.rancher.com/server-charts/stable</span><br><span class="line">&quot;rancher-stable&quot; has been added to your repositories </span><br></pre></td></tr></table></figure>

<p><strong>通过Helm安装Rancher</strong> 注意：这里指定了hostname&#x3D;rancher.minminmsn.com，必须使用域名访问才行。 注意：rancher默认使用https访问，因此，需要有一个公网的SSL才行，可以使用之前ingress-secret2021。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch01 yaml]# kubectl get secret|grep 2021</span><br><span class="line">ingress-secret2021                                     kubernetes.io/tls                     2      47d</span><br></pre></td></tr></table></figure>

<p>注意：其中有几个参数需要特别注意，如果不注意后续再修改服务配置也可，比如namespace、hostname、ingress等，下面正式helm部署rancher</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch01 yaml]# helm install rancher-stable/rancher   --name rancher     --set hostname=rancher.minminmsn.com   --set ingress.tls.source=ingress-secret2021</span><br><span class="line">NAME:   rancher</span><br><span class="line">LAST DEPLOYED: Mon Aug 31 15:21:33 2020</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: DEPLOYED</span><br><span class="line"></span><br><span class="line">RESOURCES:</span><br><span class="line">==&gt; v1/ServiceAccount</span><br><span class="line">NAME     SECRETS  AGE</span><br><span class="line">rancher  1        0s</span><br><span class="line"></span><br><span class="line">==&gt; v1/ClusterRoleBinding</span><br><span class="line">NAME     AGE</span><br><span class="line">rancher  0s</span><br><span class="line"></span><br><span class="line">==&gt; v1/Service</span><br><span class="line">NAME     TYPE       CLUSTER-IP      EXTERNAL-IP  PORT(S)  AGE</span><br><span class="line">rancher  ClusterIP  10.254.185.214  &lt;none&gt;       80/TCP   0s</span><br><span class="line"></span><br><span class="line">==&gt; v1/Deployment</span><br><span class="line">NAME     DESIRED  CURRENT  UP-TO-DATE  AVAILABLE  AGE</span><br><span class="line">rancher  3        3        3           0          0s</span><br><span class="line"></span><br><span class="line">==&gt; v1beta1/Ingress</span><br><span class="line">NAME     HOSTS                   ADDRESS  PORTS  AGE</span><br><span class="line">rancher  rancher.minminmsn.com  80, 443  0s</span><br><span class="line"></span><br><span class="line">==&gt; v1/Pod(related)</span><br><span class="line">NAME                     READY  STATUS             RESTARTS  AGE</span><br><span class="line">rancher-cf8d8f9dd-2m2pc  0/1    ContainerCreating  0         0s</span><br><span class="line">rancher-cf8d8f9dd-462t6  0/1    ContainerCreating  0         0s</span><br><span class="line">rancher-cf8d8f9dd-twcjf  0/1    ContainerCreating  0         0s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NOTES:</span><br><span class="line">Rancher Server has been installed.</span><br><span class="line"></span><br><span class="line">NOTE: Rancher may take several minutes to fully initialize. Please standby while Certificates are being issued and Ingress comes up.</span><br><span class="line"></span><br><span class="line">Check out our docs at https://rancher.com/docs/rancher/v2.x/en/</span><br><span class="line"></span><br><span class="line">Browse to https://rancher.minminmsn.com</span><br><span class="line"></span><br><span class="line">Happy Containering!</span><br><span class="line"></span><br><span class="line">[root@elasticsearch01 yaml]# helm ls --all rancher</span><br><span class="line">NAME    REVISION    UPDATED                     STATUS      CHART           APP VERSION NAMESPACE</span><br><span class="line">rancher 1           Mon Aug 31 15:21:33 2020    DEPLOYED    rancher-2.4.6   v2.4.6      default  </span><br><span class="line">[root@elasticsearch01 yaml]# kubectl get pods |grep rancher</span><br><span class="line">rancher-cf8d8f9dd-2m2pc                        0/1     ContainerCreating   0          69s</span><br><span class="line">rancher-cf8d8f9dd-462t6                        0/1     ContainerCreating   0          69s</span><br><span class="line">rancher-cf8d8f9dd-twcjf                        0/1     ContainerCreating   0          69s</span><br></pre></td></tr></table></figure>

<p>发现默认是3节点rancher集群，测试k8s集群只有2个节点，所以有1个pod没有启动，这里需要修改deploy中的replicas为2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch01 yaml]# kubectl get pods |grep rancher</span><br><span class="line">rancher-cf8d8f9dd-2m2pc                        1/1     Running             0          5m48s</span><br><span class="line">rancher-cf8d8f9dd-462t6                        1/1     Running             0          5m48s</span><br><span class="line">rancher-cf8d8f9dd-twcjf                        0/1     ContainerCreating   0          5m48s</span><br><span class="line"></span><br><span class="line">[root@elasticsearch01 yaml]# kubectl get deploy</span><br><span class="line">NAME                          READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">rancher                       2/3     3            2           5m48s</span><br></pre></td></tr></table></figure>

<p>修改其中replicas由2变为2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spec:</span><br><span class="line">  progressDeadlineSeconds: 600</span><br><span class="line">  replicas: 3</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>全部内容如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch01 yaml]# kubectl edit  deploy rancher</span><br><span class="line"></span><br><span class="line"># Please edit the object below. Lines beginning with a &#x27;#&#x27; will be ignored,</span><br><span class="line"># and an empty file will abort the edit. If an error occurs while saving this file will be</span><br><span class="line"># reopened with the relevant failures.</span><br><span class="line">#</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  annotations:</span><br><span class="line">    deployment.kubernetes.io/revision: &quot;1&quot;</span><br><span class="line">  creationTimestamp: &quot;2020-08-31T07:21:34Z&quot;</span><br><span class="line">  generation: 1</span><br><span class="line">  labels:</span><br><span class="line">    app: rancher</span><br><span class="line">    chart: rancher-2.4.6</span><br><span class="line">    heritage: Tiller</span><br><span class="line">    release: rancher</span><br><span class="line">  name: rancher</span><br><span class="line">  namespace: default</span><br><span class="line">  resourceVersion: &quot;99595282&quot;</span><br><span class="line">  selfLink: /apis/extensions/v1beta1/namespaces/default/deployments/rancher</span><br><span class="line">  uid: 995f7aaf-eb5a-11ea-9386-52540089b2b6</span><br><span class="line"># Please edit the object below. Lines beginning with a &#x27;#&#x27; will be ignored,</span><br><span class="line"># and an empty file will abort the edit. If an error occurs while saving this file will be</span><br><span class="line"># reopened with the relevant failures.</span><br><span class="line">#</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  annotations:</span><br><span class="line">    deployment.kubernetes.io/revision: &quot;1&quot;</span><br><span class="line">  creationTimestamp: &quot;2020-08-31T07:21:34Z&quot;</span><br><span class="line">  generation: 1</span><br><span class="line">  labels:</span><br><span class="line">    app: rancher</span><br><span class="line">    chart: rancher-2.4.6</span><br><span class="line">    heritage: Tiller</span><br><span class="line">    release: rancher</span><br><span class="line">  name: rancher</span><br><span class="line">  namespace: default</span><br><span class="line">  resourceVersion: &quot;99595282&quot;</span><br><span class="line">  selfLink: /apis/extensions/v1beta1/namespaces/default/deployments/rancher</span><br><span class="line">  uid: 995f7aaf-eb5a-11ea-9386-52540089b2b6</span><br><span class="line">spec:</span><br><span class="line">  progressDeadlineSeconds: 600</span><br><span class="line">  replicas: 3</span><br><span class="line">  revisionHistoryLimit: 10</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: rancher</span><br><span class="line">  strategy:</span><br><span class="line">    rollingUpdate:</span><br><span class="line">      maxSurge: 1</span><br><span class="line">      maxUnavailable: 1</span><br><span class="line">    type: RollingUpdate</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      creationTimestamp: null</span><br><span class="line">      labels:</span><br><span class="line">        app: rancher</span><br><span class="line">        release: rancher</span><br><span class="line">    spec:</span><br><span class="line">      affinity:</span><br><span class="line">        podAntiAffinity:</span><br><span class="line">          preferredDuringSchedulingIgnoredDuringExecution:</span><br><span class="line">          - podAffinityTerm:</span><br><span class="line">              labelSelector:</span><br><span class="line">                matchExpressions:</span><br><span class="line">                - key: app</span><br><span class="line">                  operator: In</span><br><span class="line">                  values:</span><br><span class="line">                  - rancher</span><br><span class="line">              topologyKey: kubernetes.io/hostname</span><br><span class="line">            weight: 100</span><br><span class="line">      containers:</span><br><span class="line">      - args:</span><br><span class="line">        - --no-cacerts</span><br><span class="line">        - --http-listen-port=80</span><br><span class="line">        - --https-listen-port=443</span><br><span class="line">        - --add-local=auto</span><br><span class="line">        env:</span><br><span class="line">        - name: CATTLE_NAMESPACE</span><br><span class="line">          value: default</span><br><span class="line">        - name: CATTLE_PEER_SERVICE</span><br><span class="line">          value: rancher</span><br><span class="line">        image: rancher/rancher:v2.4.6</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        livenessProbe:</span><br><span class="line">          failureThreshold: 3</span><br><span class="line">          httpGet:</span><br><span class="line">            path: /healthz</span><br><span class="line">            port: 80</span><br><span class="line">            scheme: HTTP</span><br><span class="line">          initialDelaySeconds: 60</span><br><span class="line">          periodSeconds: 30</span><br><span class="line">          successThreshold: 1</span><br><span class="line">          timeoutSeconds: 1</span><br><span class="line">        name: rancher</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line">          protocol: TCP</span><br><span class="line">        readinessProbe:</span><br><span class="line">          failureThreshold: 3</span><br><span class="line">          httpGet:</span><br><span class="line">            path: /healthz</span><br><span class="line">            port: 80</span><br><span class="line">            scheme: HTTP</span><br><span class="line">          initialDelaySeconds: 5</span><br><span class="line">          periodSeconds: 30</span><br><span class="line">          successThreshold: 1</span><br><span class="line">          timeoutSeconds: 1</span><br><span class="line">        resources: &#123;&#125;</span><br><span class="line">        terminationMessagePath: /dev/termination-log</span><br><span class="line">        terminationMessagePolicy: File</span><br><span class="line">      dnsPolicy: ClusterFirst</span><br><span class="line">      restartPolicy: Always</span><br><span class="line">      schedulerName: default-scheduler</span><br><span class="line">      securityContext: &#123;&#125;</span><br><span class="line">      serviceAccount: rancher</span><br><span class="line">      serviceAccountName: rancher</span><br><span class="line">      terminationGracePeriodSeconds: 30</span><br><span class="line">status:</span><br><span class="line">  availableReplicas: 2</span><br><span class="line">  conditions:</span><br><span class="line">  - lastTransitionTime: &quot;2020-08-31T07:26:36Z&quot;</span><br><span class="line">    lastUpdateTime: &quot;2020-08-31T07:26:36Z&quot;</span><br><span class="line">    message: Deployment has minimum availability.</span><br><span class="line">    reason: MinimumReplicasAvailable</span><br><span class="line">    status: &quot;True&quot;</span><br><span class="line">    type: Available</span><br><span class="line">  - lastTransitionTime: &quot;2020-08-31T07:21:34Z&quot;</span><br><span class="line">    lastUpdateTime: &quot;2020-08-31T07:26:36Z&quot;</span><br><span class="line">    message: ReplicaSet &quot;rancher-cf8d8f9dd&quot; is progressing.</span><br><span class="line">    reason: ReplicaSetUpdated</span><br><span class="line">    status: &quot;True&quot;</span><br><span class="line">    type: Progressing</span><br><span class="line">  observedGeneration: 1</span><br><span class="line">  readyReplicas: 2</span><br><span class="line">  replicas: 3</span><br><span class="line">  unavailableReplicas: 1</span><br><span class="line">  updatedReplicas: 3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@elasticsearch01 yaml]# kubectl edit  deploy rancher</span><br><span class="line">deployment.extensions/rancher edited</span><br><span class="line">[root@elasticsearch01 yaml]# kubectl get pods|grep rancher</span><br><span class="line">rancher-cf8d8f9dd-2m2pc                        1/1     Running   0          11m</span><br><span class="line">rancher-cf8d8f9dd-462t6                        1/1     Running   0          11m</span><br><span class="line">[root@elasticsearch01 yaml]# kubectl get deploy</span><br><span class="line">NAME                          READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">rancher                       2/2     2            2           11m</span><br></pre></td></tr></table></figure>

<p>修改ingress证书 需要修改rancher默认ingress的secretName由tls-rancher-ingress变更为ingress-secret2021</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[root@elasticsearch01 yaml]# kubectl edit ingress rancher</span><br><span class="line"></span><br><span class="line"># Please edit the object below. Lines beginning with a &#x27;#&#x27; will be ignored,</span><br><span class="line"># and an empty file will abort the edit. If an error occurs while saving this file will be</span><br><span class="line"># reopened with the relevant failures.</span><br><span class="line">#</span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Ingress</span><br><span class="line">metadata:</span><br><span class="line">  annotations:</span><br><span class="line">    certmanager.k8s.io/issuer: rancher</span><br><span class="line">    nginx.ingress.kubernetes.io/proxy-connect-timeout: &quot;30&quot;</span><br><span class="line">    nginx.ingress.kubernetes.io/proxy-read-timeout: &quot;1800&quot;</span><br><span class="line">    nginx.ingress.kubernetes.io/proxy-send-timeout: &quot;1800&quot;</span><br><span class="line">  creationTimestamp: &quot;2020-08-31T07:21:34Z&quot;</span><br><span class="line">  generation: 1</span><br><span class="line">  labels:</span><br><span class="line">    app: rancher</span><br><span class="line">    chart: rancher-2.4.6</span><br><span class="line">    heritage: Tiller</span><br><span class="line">    release: rancher</span><br><span class="line">  name: rancher</span><br><span class="line">  namespace: default</span><br><span class="line">  resourceVersion: &quot;99593839&quot;</span><br><span class="line">  selfLink: /apis/extensions/v1beta1/namespaces/default/ingresses/rancher</span><br><span class="line">  uid: 996153bf-eb5a-11ea-9386-52540089b2b6</span><br><span class="line">spec:</span><br><span class="line">  rules:</span><br><span class="line">  - host: rancher.minminmsn.com</span><br><span class="line">    http:</span><br><span class="line">      paths:</span><br><span class="line">      - backend:</span><br><span class="line">          serviceName: rancher</span><br><span class="line">          servicePort: 80</span><br><span class="line">  tls:</span><br><span class="line">  - hosts:</span><br><span class="line">    - rancher.minminmsn.com</span><br><span class="line">    secretName: tls-rancher-ingress</span><br><span class="line">status:</span><br><span class="line">  loadBalancer: &#123;&#125;</span><br><span class="line">~                                                     </span><br></pre></td></tr></table></figure>

<p><strong>登陆rancher设置环境</strong> 默认密码为admin需要设置复杂密码，默认语言为英文可以改为中文，默认管理本地k8s集群 <img src="https://upload-images.jianshu.io/upload_images/7535971-023c734b1a040f6a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p><strong>添加TKE集群</strong> 创建ptech集群并导入，需要在ptech集群上执行如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_0_65_centos ~]# kubectl apply -f https://rancher.minminmsn.com/v3/import/lvkfcctjfm4w52llbwng5cq7q8wwmzvqt9cm9825w8gzvkkp5748mg.yaml</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/proxy-clusterrole-kubeapiserver unchanged</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/proxy-role-binding-kubernetes-master unchanged</span><br><span class="line">namespace/cattle-system unchanged</span><br><span class="line">serviceaccount/cattle unchanged</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/cattle-admin-binding unchanged</span><br><span class="line">secret/cattle-credentials-943258c created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/cattle-admin unchanged</span><br><span class="line">deployment.apps/cattle-cluster-agent configured</span><br><span class="line">daemonset.apps/cattle-node-agent configured</span><br><span class="line">You have new mail in /var/spool/mail/root</span><br></pre></td></tr></table></figure>

<p>创建enterprise集群并导入，需要在enterprise集群上执行如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@VM_8_15_centos ~]# kubectl apply -f https://rancher.minminmsn.com/v3/import/xv4psldq5jsbxrj2h6pfmf22dfrcj5vzpk2tts9xjvlmnnmtbnd9rl.yaml</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/proxy-clusterrole-kubeapiserver unchanged</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/proxy-role-binding-kubernetes-master unchanged</span><br><span class="line">namespace/cattle-system unchanged</span><br><span class="line">serviceaccount/cattle unchanged</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io/cattle-admin-binding unchanged</span><br><span class="line">secret/cattle-credentials-edbe822 created</span><br><span class="line">clusterrole.rbac.authorization.k8s.io/cattle-admin unchanged</span><br><span class="line">deployment.apps/cattle-cluster-agent configured</span><br><span class="line">daemonset.apps/cattle-node-agent configured</span><br></pre></td></tr></table></figure>

<p><strong>最终效果如下</strong> <img src="https://upload-images.jianshu.io/upload_images/7535971-1abef3314016a471.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2020/08/25/2020/08/2020-08-25-%E5%85%B8%E5%9E%8B%E7%AE%97%E6%B3%95%E7%9A%84python%E5%AE%9E%E7%8E%B0/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/25/2020/08/2020-08-25-%E5%85%B8%E5%9E%8B%E7%AE%97%E6%B3%95%E7%9A%84python%E5%AE%9E%E7%8E%B0/index/" class="post-title-link" itemprop="url">典型算法的Python实现</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-08-25 08:00:00" itemprop="dateCreated datePublished" datetime="2020-08-25T08:00:00+08:00">2020-08-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:34" itemprop="dateModified" datetime="2023-05-26T15:06:34+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/dev/" itemprop="url" rel="index"><span itemprop="name">dev</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>算法</strong> 如果用通俗易懂的语言来说，算法就是“把解决问题的步骤无一遗漏地用文字或图表示出来”。要是把这里的“用文字或图表示”替换为“用编程语言表达”，算法就变成了程序。而且请诸位注意这样一个条件，那就是“步骤必须是明确的并且步骤数必须是有限的”。</p>
<p><strong>典型算法</strong> 计算不能自发地思考。因此计算机所执行的由程序表示的算法必须是由机械的步骤所构成。所谓“机械的步骤”，就是不用动任何脑筋，只要按照这个步骤做就一定能完成的意思。众多的学者和前辈程序员们已经发明创造出了很多机械地解决问题的步骤，这些步骤并不依赖人类的直觉。由此所构成的算法被称为“典型算法”。</p>
<p><strong>辗转相除法</strong> 辗转相除法（又称欧几里得算法）就是一个机械地求解最大公约数问题的算法。 辗转相除法可以求两个数的最大公约数，两个数相乘除以最大公约数可以得两个数的最小公倍数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># minyt 2020.8.25</span><br><span class="line"></span><br><span class="line">a = input(&quot;Please input num a: &quot;) </span><br><span class="line">b = input(&quot;Please input num b: &quot;)</span><br><span class="line">aa = a</span><br><span class="line">bb = b</span><br><span class="line"></span><br><span class="line">while a != b:</span><br><span class="line">    if a &gt; b:</span><br><span class="line">        a = a - b</span><br><span class="line">    else: </span><br><span class="line">        b = b -a</span><br><span class="line">else:</span><br><span class="line">    print &quot;the greatest common divisor  is : &quot; ,a</span><br><span class="line">    print &quot;the least    common multiple is : &quot; ,aa*bb/a</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>埃拉托斯特尼筛法</strong> 判断一个数是不是素数，用这个数分别除以比它小的所有正整数，如果没有找到能够整除的数，那么这个数就是素数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># minyt 2020.8.25</span><br><span class="line"></span><br><span class="line">a = input(&quot;Please input num a: &quot;) </span><br><span class="line"></span><br><span class="line">if a &gt; 1:</span><br><span class="line">   for i in range(2,a-1):</span><br><span class="line">       if (a % i ) == 0:</span><br><span class="line">           print a, &quot; is not primer.&quot;</span><br><span class="line">           break</span><br><span class="line">   else:</span><br><span class="line">       print a, &quot; is primer.&quot;</span><br><span class="line">else:</span><br><span class="line">   print a, &quot; is not primer.&quot;  </span><br></pre></td></tr></table></figure>

<p><strong>石头剪刀布</strong> 0代表石头 1代表剪刀 2代表布</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># minyt 2020.8.25</span><br><span class="line">import random</span><br><span class="line">a = input(&quot;Please input num a: &quot;) </span><br><span class="line">b = random.randint(0,2)</span><br><span class="line"></span><br><span class="line">print &quot;The computer randow num is &quot; ,b</span><br><span class="line"></span><br><span class="line">if a == b:</span><br><span class="line">   print &quot;The two sides draw.&quot;</span><br><span class="line">elif a == (b+1)%3:</span><br><span class="line">   print &quot;You failed.&quot;</span><br><span class="line">else:</span><br><span class="line">   print &quot;You won.&quot;    </span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2020/08/14/2020/08/2020-08-14-centos7-4-%E9%83%A8%E7%BD%B2opencv3-4-1%E7%8E%AF%E5%A2%83/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/14/2020/08/2020-08-14-centos7-4-%E9%83%A8%E7%BD%B2opencv3-4-1%E7%8E%AF%E5%A2%83/index/" class="post-title-link" itemprop="url">CentOS7.4 部署opencv3.4.1环境</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-08-14 08:00:00" itemprop="dateCreated datePublished" datetime="2020-08-14T08:00:00+08:00">2020-08-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:34" itemprop="dateModified" datetime="2023-05-26T15:06:34+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/cloud/" itemprop="url" rel="index"><span itemprop="name">cloud</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>安装依赖</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-143-centos data1]# yum install cmake gcc gcc-c++ gtk+-devel ant java-11-openjdk</span><br><span class="line">[root@VM-0-143-centos data1]# yum groupinstall &quot;Development Tools&quot;</span><br></pre></td></tr></table></figure>

<p><strong>编译安装</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-143-centos data1]# unzip opencv-3.4.1.zip  </span><br><span class="line">[root@VM-0-143-centos data1]# cd opencv-3.4.1/</span><br><span class="line">[root@VM-0-143-centos opencv-3.4.1]# mkdir build</span><br><span class="line">[root@VM-0-143-centos opencv-3.4.1]# cd build/</span><br><span class="line">[root@VM-0-143-centos build]# cmake -D CMAKE_BUILD_TYPE=RELEASE -D CMAKE_INSTALL_PREFIX=/usr/local -DBUILD_TESTS=OFF ..</span><br><span class="line">[root@VM-0-143-centos build]# make -j8</span><br><span class="line">[root@VM-0-143-centos build]# make install</span><br></pre></td></tr></table></figure>

<p><strong>检查确认</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-143-centos build]# ls lib/|grep java</span><br><span class="line">libopencv_java341.so</span><br><span class="line">[root@VM-0-143-centos build]# ls bin/|grep jar</span><br><span class="line">opencv-341.jar</span><br></pre></td></tr></table></figure>

<p><strong>环境变量</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-0-143-centos build]# export PKG_CONFIG_PATH=$PKG_CONFIG_PATH:/usr/local/lib64/pkgconfig/</span><br><span class="line">[root@VM-0-143-centos build]# echo &#x27;/usr/local/lib64/&#x27; &gt;&gt; /etc/ld.so.conf.d/opencv.conf</span><br><span class="line">[root@VM-0-143-centos build]# ldconfig</span><br></pre></td></tr></table></figure>

<p><strong>测试效果</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2020/08/04/2020/08/2020-08-04-%E6%95%8F%E6%8D%B7%E5%AE%A3%E8%A8%80%E5%9B%9B%E5%A4%A7%E4%BB%B7%E5%80%BC%E5%92%8C%E5%8D%81%E4%BA%8C%E5%8E%9F%E5%88%99/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/04/2020/08/2020-08-04-%E6%95%8F%E6%8D%B7%E5%AE%A3%E8%A8%80%E5%9B%9B%E5%A4%A7%E4%BB%B7%E5%80%BC%E5%92%8C%E5%8D%81%E4%BA%8C%E5%8E%9F%E5%88%99/index/" class="post-title-link" itemprop="url">敏捷宣言四大价值和十二原则</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-08-04 08:00:00" itemprop="dateCreated datePublished" datetime="2020-08-04T08:00:00+08:00">2020-08-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:34" itemprop="dateModified" datetime="2023-05-26T15:06:34+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/op/" itemprop="url" rel="index"><span itemprop="name">op</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="四大价值"><a href="#四大价值" class="headerlink" title="四大价值"></a><strong>四大价值</strong></h3><p>　　·<strong>个体以及互动</strong>而不是过程和工具</p>
<p>　　·<strong>可用的软件</strong>而不是完整的文档</p>
<p>　　·<strong>客户合作</strong>而不是合同谈判</p>
<p>　　·<strong>应对变更</strong>而不是遵循计划</p>
<h3 id="十二原则"><a href="#十二原则" class="headerlink" title="十二原则"></a><strong>十二原则</strong></h3><p>　　1.我们的最高目标，通过尽早持续交付有价值的软件来满足客户的要求。</p>
<p>　　2.欢迎对需求提出变更，即使在项目开发后期也不例外。敏捷过程要善于利用需求变更，帮助客户获取竞争优势。</p>
<p>　　3.要经常交付可用的软件，周期从几周到几个月不等，且越短越好。</p>
<p>　　4.项目实施过程中，业务人员与开发人员必须始终通力协作。</p>
<p>　　5.要善于激励项目人员，给予他们所需的环境和支持，并相信他们能够完成任务。</p>
<p>　　6.无论是对开发团队还是团队内部，信息传达最有效的方法都是面对面的交谈。</p>
<p>　　7.可用的软件是衡量进度首要衡量标准。</p>
<p>　　8.敏捷过程提倡可持续的开发。项目发起人、开发人员和用户应该都能够始终保持步调稳定。</p>
<p>　　9.对技术的精益求精以及对设计的不断完善将提高敏捷性。</p>
<p>　　10.简洁，即尽最大可能减少不必要的工作，这是一门艺术。</p>
<p>　　11.最佳的架构、需求和设计将出自于自组织团队。</p>
<p>　　12.团队要定期反省怎样做才能更有效，并相应地调整团队的行为。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://minminmsn.github.io/2020/07/19/2020/07/2020-07-19-%E6%A0%A1%E4%B9%8B%E4%BB%A5%E8%AE%A1%E8%80%8C%E7%B4%A2%E5%85%B6%E6%83%85/index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jerry Min">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MinMinMsn">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/19/2020/07/2020-07-19-%E6%A0%A1%E4%B9%8B%E4%BB%A5%E8%AE%A1%E8%80%8C%E7%B4%A2%E5%85%B6%E6%83%85/index/" class="post-title-link" itemprop="url">校之以计而索其情</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-07-19 08:00:00" itemprop="dateCreated datePublished" datetime="2020-07-19T08:00:00+08:00">2020-07-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-26 15:06:34" itemprop="dateModified" datetime="2023-05-26T15:06:34+08:00">2023-05-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/method/" itemprop="url" rel="index"><span itemprop="name">method</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>从古至今读过《孙子兵法》的不少，大家对其感触最深或者得到的点肯定是不一样的。有人强调“兵者，诡道也。”，有人强调“知彼知己，百战不殆”，然而我却对“校之以计，而索其情”这句情有独钟。</p>
<p>“校之以计，而索其情”出自于《孙子兵法》计篇。原文是这样的：</p>
<blockquote>
<p>孙子曰:兵者，国之大事，死生之地，存亡之道，不可不察也。 故经之以五事，校之以计，而索其情:一曰道，二曰天，三曰地，四曰将，五曰法。 道者，令民与上同意，可与之死，可与之生，而不危也；天者，阴阳、寒暑、时制也；地者，远近、险易、广狭、死生也；将者，智、信、仁、勇、严也；法者，曲制、官道、主用也。 凡此五者，将莫不闻，知之者胜，不知之者不胜。 故校之以计，而索其情，曰:主孰有道？ 将孰有能？ 天地孰得？ 法令孰行？ 兵众孰强？ 士卒孰练？ 赏罚孰明？ 吾以此知胜负矣。 将听吾计，用之必胜，留之；将不听吾计，用之必败，去之。 计利以听，乃为之势，以佐其外。 势者，因利而制权也。 兵者，诡道也。 故能而示之不能，用而示之不用，近而示之远，远而示之近。 利而诱之，乱而取之，实而备之，强而避之，怒而挠之，卑而骄之，佚而劳之，亲而离之，攻其无备，出其不意。 此兵家之胜，不可先传也。 夫未战而庙算胜者，得算多也；未战而庙算不胜者，得算少也。 多算胜少算，而况于无算乎! 吾以此观之，胜负见矣。</p>
</blockquote>
<p>阳明先生评注说“其中校量计划，有多少神明妙用在，所谓‘因利制权’，‘不可先传’者也”。</p>
<p>下面我来细分下这句话的含义，逐步来探讨下有四点，如下</p>
<p><strong>有通识</strong> 孙子这里强掉要知道、天、地、将、法，他认为这是行军打仗的统帅必须要掌握的基本知识。如果从专业上讲将与法足矣，但是这里还是强调了了道、天、地。说明除了本专业的知识外，通识也是很重要的。如果学科太过专门、知识会被严重割裂，不利于培养跨学科知识的融会贯通，最终难以完整，所知不足以支撑独立思考。</p>
<p><strong>有计划</strong> 这里的计、诡道、庙算等都可以理解为计划规划等，我不赞成阴谋诡计说。“兵者，国之大事，死生之地，存亡之道，不可不察也。”翻译为现在的话讲就是不打无准备之仗，打仗不是儿戏，要打就打胜仗，否则还不如不打。简单讲就是庙算胜者才可战，这里庙算就是计划，做不好计划做不好准备就不要行动。比如你去炒股，当你下手的时候肯定是要赢钱的，否则你怎么会掏钱下注。至于最后你为啥当了韭菜被收割了，就得看下一步了。</p>
<p><strong>有修正</strong> 有计划只是起点，说明可以做下一步行动了，至于计划做得对不对好不好，只能在实践中去验证了。其中校量计划，更进修正最是考验人，只能说考察，考察中发现问题缺失要有勇气提出来，必要时还得修正计划最终使得算多乃至终止计划也未尝不行。</p>
<p><strong>有反馈</strong> 由于“兵家之胜不可先传”，特别是在实施计划的时候会遇到各种各样的突发情况，这个时候要做好反馈，因时因事而异而变通方法，依据利害得失而采取相应的行动。最终如果按照计划实践了却没有得到预期的结果，还得做好反思、复盘，这也算反馈的一种。</p>
<p>以上四点可以组成一个循环：学习获取知识，做计划去实践，修正错误缺漏，形成正向反馈。这也是一套方法论，而且是决定生死存亡的方法论，所以一定得理解透彻。</p>
<p>虽然在当今社会个人遭遇战争的可能性比较小，但是我们每个人都会经历考场、职场、商场、乃至婚姻家庭、生活人生、投资理财，当我们投身其中时，没有一些原则、方法，真的寸步难行。</p>
<p>综上我把“校之以计，而索其情”作为我的第一方法论，简单讲就是遇事搞清楚，然后做好规划，最后知行合一。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Jerry Min</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">260</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">34</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">61</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jerry Min</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
